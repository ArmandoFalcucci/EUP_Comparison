---
title: "Gennai, Falcucci, Niochet et al. EUP Comparison"
author: "Jacopo Gennai"
date: "05-01-2024"
output: html_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(eval = FALSE)
```

# Introduction

This is an R Markdown document containing the Rcode and workflow for the "reference_article".

# Datasets

the datasets contain raw data about technological analysis of four Early Upper Palaeolithic assemblages:

-   Ansab AH1 (Jordan)
-   Romanesti-Dumbravita GH3 (Romania)
-   Fumane A1-A2 (Italy)
-   Les Cottés 04inf (France)

the assemblages are stratified and radiometrically dated to the period 41-38 ka cal BP.

Datasets are available singularly at the Zenodo repository "insert link or reference". Datasets are divided in "Blanks", debitage products, and "Cores", exhausted blocks of raw material from which debitage products have been struck. The division is due to the different attributes recorded for the two categories.

Blanks

```{r}

library(readxl)
Gennai_Rom_Ansab_Blanks <- read_excel(file.choose()) #Get the Gennai_Rom&Ansab_Blanks.xlsx
View(Gennai_Rom_Ansab_Blanks)

Falcucci_Fumane_Blanks <- read_excel(file.choose()) #Get the Falcucci_Fumane_Blanks.xlsx
View(Falcucci_Fumane_Blanks)

Niochet_CTS_US04inf_Blanks <- read_excel(file.choose()) #Get the Niochet_CTS-US04inf_Blanks.xlsx
View(Niochet_CTS_US04inf_Blanks)

#listing the attributes
str(Gennai_Rom_Ansab_Blanks)
knitr::kable(t(data.frame(names(Gennai_Rom_Ansab_Blanks))), col.names = NULL, row.names = FALSE)
str(Falcucci_Fumane_Blanks)
knitr::kable(t(data.frame(names(Falcucci_Fumane_Blanks))), col.names = NULL, row.names = FALSE)
str(Niochet_CTS_US04inf_Blanks)
knitr::kable(t(data.frame(names(Niochet_CTS_US04inf_Blanks))), col.names = NULL, row.names = FALSE)
```

Cores

```{r}
Gennai_Rom_Ansab_Cores <- read_excel(file.choose()) #get the Gennai_Rom&Ansab_Cores.xlsx
View(Gennai_Rom_Ansab_Cores)

Niochet_CTS_US04inf_Cores <- read_excel(file.choose()) #get the Niochet_CTSUS04inf_Cores.xlsx
View(Niochet_CTS_US04inf_Cores)

#listing the attributes
str(Gennai_Rom_Ansab_Cores)
knitr::kable(t(data.frame(names(Gennai_Rom_Ansab_Cores))), col.names = NULL, row.names = FALSE)
str(Niochet_CTS_US04inf_Cores)
knitr::kable(t(data.frame(names(Niochet_CTS_US04inf_Cores))), col.names = NULL, row.names = FALSE)


```

# Comparing the attributes

Blanks (bold are comparable attributes across databases)

Gennai : **Site** **Layer** Square **Piece Original ID** **Entirety** **CxSimpl** **CxPosition** **Length** **Width** **Thick** **El** **ButtType** **BulbMorph** **Lipp** **OvAb** **Axiality** **Out** **Symmetry** **CrossSectMorph** **Pro** **DEndMorph** **StructureCat** **TechCat** Cat **NegN** NegType **NegOSimpl** **NegO** R **RLoc** **RPos** RDis RDel RExt RAng RMorph Description

Falcucci : **ID** **Layer** **square** sub.square raw.material **class** **blank** **technology** **technology.ext** **Cortex** Cortex.y.n **Cortex.position** preservation **Preservation** **Length** **Width** **Thickness** **Elongation** robustness platform.width platform.thickness platformW.T. **platform.type** platform.shape **platform.angle** **dorsal.thinning** bulb **bulb.type** bulbar.scar **lip** lip.type **curvature** **torsion** **cross.section** **cross.section.symmetry** **scar.count** **axiality** **scar.pattern** distal.end **distal.end.profile** **blank.shape** bladelet.neg.blade blade.neg.flake typology typology.reduced **retouch.position** **dorsal.retouch.localization** **ventral.retouch.localization** retouch.length **Site**

Niochet: **Site** **Layer** **Piece Original ID** **Entirety** **CxSimpl** **CxPosition** **Length** **Width** **Thick** **El** **ButtType** **BulbMorph** **Lipp** **OvAb** **Axiality** **Out Symmetry** **CrossSectMorph** **Pro** **DEndMorph** **StructureCat** **TechCat** **Cat** **NegN** NegType **NegOSimpl** **NegO** **R** **RLoc** **RPos** **RDis** RDel RExt RAng RMorph Description , Entretien antéro-latéral ? percu organique bulbe marqué-court talon plusieurs points de percussion Bipolaire / sur appui ? TALON DÉCALÉ (déb oblique?) PHOTO Classe Sous-classe Type technique Sous-type technique MP Largeur talon Épaisseur talon Type de lèvre Symétrie section DendMorph full CTS !!! NEW : Type de cassure Terminaison Axe retouche

Cores

Gennai: Site Layer Square Piece Original ID Entirety Length Width Thickness CO CxP NSP SPtype SPR SP-FS angle Ab NFS FSR FSS 2FSS NegType NegN BladeNegN BladeletsNegN NegO SNegN SNegO SNegType CoreCat Length LCN Width LCN Elongation LCN Description LCN Description

Falcucci:

Niochet: Site Layer Piece Original ID Entirety Length Width Thickness CO CxP NSP SPtype SPR SP-FS angle Ab NFS FSR FSS 2FSS NegType NegN BladeNegN BladeletsNegN NegO SNegN SNegO SNegType CoreCat Length LCN Width LCN Elongation LCN Description LCN Description

# Selecting attributes to merge the datasets

Blanks

-   Site
-   Layer
-   ID (Gennai and Niochet Piece Original ID)
-   Entirety (Falcucci Preservation)
-   CxSimpl (Falcucci Cortex)
-   CxPosition (Falcucci Cortex.position)
-   Length
-   Width
-   Thickness (Gennai and Niochet Thick)
-   El (Falcucci Elongation)
-   ButtType (Falcucci platform.type)
-   BulbMorph (Falcucci Bulb)
-   Lipp (Falcucci Lip)
-   OvAb (Falcucci dorsal.thinning)
-   Axiality (Falcucci axiality)
-   Out (Falcucci blank.shape)
-   Symmetry (Falcucci cross.section.symmetry)
-   CrossSectMorph (Falcucci cross.section)
-   Pro (Falcucci curvature, complement with Curvature Gennai values to accomodate loss of twisted)
-   Torsion (split the Gennai and Niochet Pro, if Twisted yes)
-   DEndMorph (Falcucci distal.end.profile)
-   StructureCat (Falcucci blank)
-   TechCat (Falcucci technology)
-   Cat (Falcucci technology.ext)
-   NegN (Falcucci scar.count)
-   NegType = Negatives.type?
-   NegOSimpl = Dorsal.scar.1
-   NegO (Falcucci scar.pattern)
-   R (Falcucci Class, replace Tool with "yes" and the rest with "no")
-   RPos (Falcucci retouch.position)
-   RLoc & RDis (split Falcucci dorsal.retouch.localization and Falcucci ventral.retouch.localization)

# Final lists of attributes

Blank

-   Site
-   Layer
-   ID
-   Preservation
-   Cortex.y.n (NEW)
-   Cortex
-   Cortex.position
-   Length
-   Width
-   Thickness
-   Elongation
-   Platform
-   Bulb
-   Lip
-   Abrasion
-   Axiality
-   Outline.morphology
-   Symmetry
-   Cross.section
-   Profile
-   Torsion
-   Distal.end.morpho
-   Blank.type
-   Technology.Phase
-   Technology.Ext
-   Number.negatives
-   Negatives.type
-   Dorsal.scar.1
-   Dorsal.scar.2
-   Tool
-   Retouch.Position
-   Retouch.Location
-   Retouch.Distribution

Cores

-   Site\
-   Layer
-   ID (Gennai and Niochet Piece Original ID)
-   Preservation (Gennai and Niochet Entirety)\
-   Length\
-   Width
-   Thickness
-   Elongation (NEW to calculate)
-   Cortex.y.n (NEW)
-   Cortex.position (Gennai and Niochet CxP)
-   Number.Platforms (Gennai & Niochet NSP)
-   Platform (Gennai & Niochet SPtype)
-   Platform.Relationship (Gennai & Niochet SPR, ex. single platform, opposed etc..)
-   Angle.de.Chasse (Gennai & Niochet SP-FS angle)
-   Abrasion (Gennai & Niochet Ab)
-   Number.Flaking.Surfaces (Gennai & Niochet NFS)
-   Flaking.Surface.Relationship (Gennai & Niochet FSR)
-   Flaking.Surface.Type (Gennai & Niochet FSS, ex. convergent)
-   2Flaking.Surface.Type (if more than one)
-   Number.negatives
-   Negatives.type\
-   Blade.Negatives.Number (applicable?)
-   Bladelets.Negatives.Number (applicable?)\
-   Dorsal.scar.1 (Gennai & Niochet NegO)
-   Supporting.negatives.number (i.e. shaping, SNegN)
-   Supporting.Dorsal.scar.(SNegO)
-   Supporting.Negatives.type (SNegType)\
-   Technology (CoreCat)\
-   Length LCN (last complete negative, applicable to you?)
-   Width LCN
-   Elongation LCN\
-   Description LCN

# Reshaping datasets according to new attributes

Blanks

```{r}
library(dplyr)

Gennai_Blanks_reshaped <- Gennai_Rom_Ansab_Blanks %>%
  rename(ID2 = "Piece Original ID", Preservation = "Entirety", Cortex="Cx", Cortex.position = "CxPosition", Thickness = "Thick", Elongation = "El", Platform = "ButtType", Bulb = "BulbMorph", Lip = "Lipp", Abrasion = "OvAb", Outline.morphology = "Out", Cross.section = "CrossSectMorph", Profile = "Pro", Distal.end.morpho = "DEndMorph",Blank.type = "StructureCat", Technology.Phase = "TechCat", Technology.Extended = "Cat", Number.negatives = "NegN", Negatives.type = "NegType", Dorsal.scar.2 = "NegO", Tool = "R", Retouch.Position ="RPos", Retouch.Location ="RLoc", Retouch.Distribution="RDis") %>%
  mutate(Cortex= case_when(Cortex == "0" ~ "No Cortex",
    Cortex %in% c("1-24%", "24-49%","25-49%", "50%") ~ "Semi",
    Cortex %in% c("51-74%", "75-99%") ~ "Extensive",
    Cortex == "100%" ~ "Full"))%>%
  mutate(Cortex.y.n = Cortex, .after = Cortex.position) %>% #INSERT CORTEX.Y.N
  mutate(Cortex.y.n = recode(Cortex.y.n, Extensive = "Yes", Full = "Yes", Semi ="Yes"))%>%
  mutate(Torsion = Profile, .after = Profile) %>% #INSERT Torsion
  mutate(Torsion = recode(Torsion, Twisted = "Yes", Straight= "No", Curved= "No", "Very Curved"="No", "Slightly Curved"="No"))%>%
mutate(Profile = case_when(
    Profile == "Twisted" & Curv >= 0 & Curv <= 2.9 ~ "Straight", #using Bon 2002 values
    Profile == "Twisted" & Distal.end.morpho =="Feathered" ~ "Straight", #assuming that if feathered it's straight
    Profile == "Twisted" & Curv > 2.9 & Curv <= 5.9 ~ "Slightly Curved", #using Bon 2002 values
    Profile == "Twisted" & Distal.end.morpho =="Plunging" ~ "Slightly Curved", #assuming that if it's plunging then it's at least slightly curved
    Profile == "Twisted" & Curv > 5.9 & Curv <= 8.9 ~ "Curved", #using Bon 2002 values
    Profile == "Twisted" & Curv > 8.9 ~ "Very Curved",
    TRUE ~ Profile  # Keep the original Profile if not Twisted
  ))%>%
mutate(Technology.Extended= case_when(Technology.Extended == "1" ~ "Ordinary flake",
 Technology.Extended == "2" ~ "Cortical flake",  
 Technology.Extended %in% c("3", "3a") ~ "Core tablet",
 Technology.Extended == "4" ~ "Maintenance flake",
 Technology.Extended %in% c("4a", "4b") ~ "Flaking surface maintenance flake",
 Technology.Extended == "5" ~ "Maintenance laminar",
 Technology.Extended %in% c("5a", "5a1") ~ "Crested laminar",
 Technology.Extended %in% c("5b", "5b1") ~ "Lateral asymmetrical laminar",
 Technology.Extended %in% c("5c", "5c1") ~ "Overshot laminar",
 Technology.Extended %in% c("5d", "5d1") ~ "Flaking surface maintenance laminar",
 Technology.Extended %in% c("6", "6a", "6a1", "6b", "6B", "6b1") ~ "Ordinary blade",
 Technology.Extended %in% c("7", "7a", "7a1", "7b", "7b1") ~ "Ordinary bladelet",
 Technology.Extended == "7c" ~ "Burin spall"
 ))%>%
  mutate(Dorsal.scar.1 = Dorsal.scar.2, .after = Dorsal.scar.2) %>%
  mutate(Dorsal.scar.1 = case_when(
    Dorsal.scar.1 %in% c("Unidirectional+Convergent", 
                         "Unidirectional+Orthogonal", 
                         "Unidirectional+Crossed",
                         "Convergent",
                         "Convergent+Orthogonal",
                         "Unidirectional+Convergent+Crossed", 
                         "Unidirectional+Convergent+Orthogonal", "
                         Unidirectional+Crossed+Orthogonal") ~ "Unidirectional",
    Dorsal.scar.1 == "Crossed+Orthogonal" ~ "Crossed",
    Dorsal.scar.1 %in% c("Bidirectional+Crossed", 
                         "Bidirectional+Convergent", 
                         "Bidirectional+Orthogonal") ~ "Bidirectional",
    TRUE ~ Dorsal.scar.1
  ))
View(Gennai_Blanks_reshaped)
str(Gennai_Blanks_reshaped)  # CHECK THE NEW DATASET
unique(Gennai_Blanks_reshaped$Technology.Extended)
unique(Gennai_Blanks_reshaped$Dorsal.scar.1)
  
```

```{r}
Niochet_Blanks_reshaped <- Niochet_CTS_US04inf_Blanks %>%
  rename(ID2 = "Piece Original ID", Preservation = "Entirety", Cortex="CxSimpl", Cortex.position = "CxPosition", Thickness = "Thick", Elongation = "El", Platform = "ButtType", Bulb = "BulbMorph", Lip = "Lipp", Abrasion = "OvAb", Outline.morphology = "Out", Cross.section = "CrossSectMorph", Profile = "Pro", Distal.end.morpho = "DEndMorph",Blank.type = "StructureCat", Technology.Phase = "TechCat", Technology.Extended = "Cat", Number.negatives = "NegN", Negatives.type = "NegType", Dorsal.scar.1= "NegOSimpl", Dorsal.scar.2 = "NegO", Tool = "R", Retouch.Position ="RPos", Retouch.Location ="RLoc", Retouch.Distribution="RDis") %>%
  mutate(Cortex.y.n = Cortex, .after = Cortex.position) %>% #INSERT CORTEX.Y.N
  mutate(Cortex.y.n = recode(Cortex.y.n, Extensive = "Yes", Full = "Yes", Semi ="Yes"))%>%
  mutate(Torsion = Profile, .after = Profile) %>% #INSERT Torsion
  mutate(Torsion = recode(Torsion, Twisted = "Yes", Straight= "No", Curved= "No", "Very Curved"="No", "Slightly Curved"="No"))%>%
mutate(Profile = case_when(
    Profile == "Twisted" & Distal.end.morpho =="Feathered" ~ "Straight", #assuming that if feathered it's straight
    Profile == "Twisted" & Distal.end.morpho =="Plunging" ~ "Slightly Curved", #assuming that if it's plunging then it's at least slightly curved
    TRUE ~ Profile  # Keep the original Profile if not Twisted
  ))%>%
mutate(Technology.Extended= case_when(Technology.Extended == "1" ~ "Ordinary flake",
 Technology.Extended == "2" ~ "Cortical flake",  
 Technology.Extended %in% c("3", "3a") ~ "Core tablet",
 Technology.Extended == "4" ~ "Maintenance flake",
 Technology.Extended %in% c("4a", "4b") ~ "Flaking surface maintenance flake",
 Technology.Extended == "5" ~ "Maintenance laminar",
 Technology.Extended %in% c("5a", "5a1") ~ "Crested laminar",
 Technology.Extended %in% c("5b", "5b1") ~ "Lateral asymmetrical laminar",
 Technology.Extended %in% c("5c", "5c1") ~ "Overshot laminar",
 Technology.Extended %in% c("5d", "5d1") ~ "Flaking surface maintenance laminar",
 Technology.Extended %in% c("6", "6a", "6a1", "6b", "6B", "6b1") ~ "Ordinary blade",
 Technology.Extended %in% c("7", "7a", "7a1", "7b", "7b1") ~ "Ordinary bladelet",
 Technology.Extended == "7c" ~ "Burin spall"
 )) %>%
mutate(Dorsal.scar.1 = case_when(
    Dorsal.scar.1 %in% c("Unidirectional+Convergent", 
                         "Unidirectional+Orthogonal", 
                         "Unidirectional+Crossed",
                         "Convergent",
                         "Convergent+Orthogonal",
                         "Unidirectional+Convergent+Crossed", 
                         "Unidirectional+Convergent+Orthogonal", "
                         Unidirectional+Crossed+Orthogonal") ~ "Unidirectional",
    Dorsal.scar.1 == "Crossed+Orthogonal" ~ "Crossed",
    Dorsal.scar.1 %in% c("Bidirectional+Crossed", 
                         "Bidirectional+Convergent", 
                         "Bidirectional+Orthogonal") ~ "Bidirectional",
    TRUE ~ Dorsal.scar.1
  ))
View(Niochet_Blanks_reshaped)
str(Niochet_Blanks_reshaped)  # CHECK THE NEW DATASET
```

```{r}
Falcucci_Blanks_reshaped <- Falcucci_Fumane_Blanks %>%
  rename(ID2="ID", Bulb = "bulb.type", Platform = "platform.type", Bulb = "bulb.type", Lip = "lip.type", Abrasion = "dorsal.thinning", Outline.morphology = "blank.shape", Cross.section = "cross.section", Symmetry = "cross.section.symmetry", Profile = "curvature", Torsion = "torsion", Distal.end.morpho = "distal.end", Blank.type = "blank", Technology.Phase = "technology",Technology.Extended ="technology.ext", Axiality = "axiality", Number.negatives = "scar.count", Negatives.type = "bladelet.neg.blade", Dorsal.scar.1 = "scar.pattern", Tool = "class", Retouch.Position="retouch.position") %>%
  mutate(Tool = recode(Tool, Blank = "No", Tool = "Yes")) %>%
  mutate(Cortex = case_when(
    Cortex == "0%"~ "No",
    Cortex == "1-33%"~ "Semi",
    Cortex == "33-66%"~ "Semi",
    Cortex == "66-99%"~ "Extensive",
    Cortex == "100%"~ "Full")) %>%
  mutate(Negatives.type = case_when(
    Negatives.type == TRUE ~ "Blades & Bladelets",
    Negatives.type == FALSE ~ "ND")) %>%
  mutate(Dorsal.scar.2 = Dorsal.scar.1)%>%
  mutate(Technology.Extended = case_when(
  Technology.Extended == "Blade correction surface" ~ "Flaking surface maintenance laminar",
  
  Technology.Extended == "Crested blade" ~ "Crested laminar",
  Technology.Extended == "Crested secondary blade" ~ "Crested laminar",
  Technology.Extended == "Dihedral" ~ "Crested laminar",
  Technology.Extended == "Croisée" ~ "Crested laminar",
  Technology.Extended == "Manteinance blade" ~ "Maintenance laminar",
  
  Technology.Extended == "debordant blade" ~ "Lateral asymmetrical laminar",
  Technology.Extended == "Lateral" ~ "Lateral asymmetrical laminar",
  Technology.Extended == "Lateral blade" ~ "Lateral asymmetrical laminar",
  
  Technology.Extended == "Bladelet" ~ "Ordinary bladelet",
  Technology.Extended == "Blade" ~ "Ordinary blade",
  Technology.Extended == "Flake" ~ "Ordinary flake",
  
  Blank.type == "Flake" & Technology.Extended == "Optimal" ~ "Ordinary flake",
  Blank.type == "Blade" & Technology.Extended == "Optimal" ~ "Ordinary blade",
  Blank.type == "Bladelet" & Technology.Extended == "Optimal" ~ "Ordinary bladelet",
  
  Blank.type == "Flake" & Technology.Extended == "Maintenance" ~ "Maintenance flake",
  Blank.type == "Blade" & Technology.Extended == "Maintenance" ~ "Maintenance laminar",
  Blank.type == "Bladelet" & Technology.Extended == "Maintenance" ~ "Maintenance laminar",
  
  Blank.type == "Blade" & Technology.Extended == "Semi-cortical" ~ "Semi-cortical blade",
  Blank.type == "Bladelet" & Technology.Extended == "Semi-cortical" ~ "Semi-cortical bladelet",
  Blank.type == "Flake" & Technology.Extended == "Semi-cortical" ~ "Semi-cortical flake",
  
  Blank.type == "Blade" & Technology.Extended == "Cortical" ~ "Cortical blade",
  Blank.type == "Bladelet" & Technology.Extended == "Cortical" ~ "Cortical bladelet",
  Blank.type == "Flake" & Technology.Extended == "Cortical" ~ "Cortical flake",
  
  Blank.type == "Blade" & Technology.Extended == "Crest" ~ "Crested laminar",
  Blank.type == "Bladelet" & Technology.Extended == "Crest" ~ "Crested laminar",
  Blank.type == "Flake" & Technology.Extended == "Crest" ~ "Crested flake",
  
  Blank.type == "Flake" & Technology.Extended == "Second-crest" ~ "Neo-crest flake",
  Blank.type == "Blade" & Technology.Extended == "Second-crest" ~ "Crested blade",
  Blank.type == "Bladelet" & Technology.Extended == "Second-crest" ~ "Crested laminar",
  
  Blank.type == "Flake" & Technology.Extended == "Neo-crest" ~ "Neo-crest flake",
  Blank.type == "Blade" & Technology.Extended == "Neo-crest" ~ "Crested blade",
  Blank.type == "Bladelet" & Technology.Extended == "Neo-crest" ~ "Crested laminar",
  
  TRUE ~ as.character(Technology.Extended)
))

Falcucci_Blanks_reshaped$Symmetry <- as.factor(Falcucci_Blanks_reshaped$Symmetry)

Falcucci_Blanks_reshaped<- Falcucci_Blanks_reshaped %>%
  mutate(Symmetry = recode(Symmetry, `TRUE` = "symmetric", `FALSE` = "asymmetric"))

View(Falcucci_Blanks_reshaped)
str(Falcucci_Blanks_reshaped)
```

# Merge the datasets in one

```{r}
Gennai_Blanks_reshaped <- Gennai_Blanks_reshaped %>%
  select(Site, Layer, ID2, Preservation, Cortex.y.n, Cortex, Cortex.position, Length, Width, Thickness, Elongation, Platform, Bulb, Lip, Abrasion, Axiality, Outline.morphology, Symmetry, Cross.section, Profile, Torsion, Distal.end.morpho, Blank.type, Technology.Phase, Technology.Extended, Number.negatives, Negatives.type, Dorsal.scar.1, Dorsal.scar.2, Tool, Retouch.Position)

# Niochet
Niochet_Blanks_reshaped <- Niochet_Blanks_reshaped %>%
  select(Site, Layer, ID2, Preservation, Cortex.y.n, Cortex, Cortex.position, Length, Width, Thickness, Elongation, Platform, Bulb, Lip, Abrasion, Axiality, Outline.morphology, Symmetry, Cross.section, Profile, Torsion, Distal.end.morpho, Blank.type, Technology.Phase, Technology.Extended, Number.negatives, Negatives.type, Dorsal.scar.1, Dorsal.scar.2, Tool, Retouch.Position)

# Falcucci
Falcucci_Blanks_reshaped <- Falcucci_Blanks_reshaped %>%
  select(Site, Layer, ID2, Preservation, Cortex.y.n, Cortex, Cortex.position, Length, Width, Thickness, Elongation, Platform, Bulb, Lip, Abrasion, Axiality, Outline.morphology, Symmetry, Cross.section, Profile, Torsion, Distal.end.morpho, Blank.type, Technology.Phase, Technology.Extended, Number.negatives, Negatives.type, Dorsal.scar.1, Dorsal.scar.2, Tool, Retouch.Position)

# Merging datasets ####

Blank_Main <- rbind(Gennai_Blanks_reshaped, Niochet_Blanks_reshaped, Falcucci_Blanks_reshaped)

Blank_Main <- Blank_Main %>%
  rename(ID="ID2")
str(Blank_Main)

# Exporting the merged datasets ####

library(writexl)
writexl::write_xlsx(Blank_Main, "Ans_Rom_Fum_CTS_Blanks_merged.xlsx")

```

```{r}
library(readxl)
library(dplyr)
Blank_Main <- read_excel(file.choose()) # get the Ans_Rom_Fum_CTS_Blanks_merged.xlsx



Blank_Main_reshaped <- Blank_Main %>%
  mutate(Preservation = case_when(
    Preservation == "Almost-complete" ~ "Complete",
    Preservation %in% c("Mes+Prox" , Preservation == "Mesio-proximal")~ "Prox+Mes",
    Preservation == "Mesio-distal" ~ "Mes+Dist",
    TRUE ~ Preservation  # CTS is OK
  )) %>%
  filter(Preservation %in% c("Complete", "Prox+Mes", "Mes+Dist")) %>%
  filter(Blank.type %in% c("Blade", "Bladelet", "Flake")) #keep only complete and semi and determined blanks

str(Blank_Main_reshaped)
View(Blank_Main_reshaped)


#check unique values to reshape them

unique(Blank_Main_reshaped$Site)
unique(Blank_Main_reshaped$Preservation)
unique(Blank_Main_reshaped$Cortex.y.n)
unique(Blank_Main_reshaped$Cortex)
unique(Blank_Main_reshaped$Cortex.position)
unique(Blank_Main_reshaped$Bulb)
unique(Blank_Main_reshaped$Lip)
unique(Blank_Main_reshaped$Abrasion)
unique(Blank_Main_reshaped$Axiality)
unique(Blank_Main_reshaped$Outline.morphology)
unique(Blank_Main_reshaped$Symmetry)
unique(Blank_Main_reshaped$Cross.section)
unique(Blank_Main_reshaped$Profile)
unique(Blank_Main_reshaped$Torsion)
unique(Blank_Main_reshaped$Distal.end.morpho)
unique(Blank_Main_reshaped$Blank.type)
unique(Blank_Main_reshaped$Technology.Phase)
unique(Blank_Main_reshaped$Technology.Extended)
unique(Blank_Main_reshaped$Negatives.type)
unique(Blank_Main_reshaped$Dorsal.scar.2)
unique(Blank_Main_reshaped$Retouch.Position)


Blank_Main_reshaped1 <- Blank_Main_reshaped %>%
  mutate(Site = case_when(
    Site == "Ansab"~ "AN",
    Site == "Romanesti-Dumbravita I"~ "ROM",
    Site == "Fumane"~ "FUM",
    TRUE ~ Site  # CTS is OK
    )) %>%
mutate(Cortex.y.n = case_when(
    Cortex.y.n %in% c("No Cortex", 
                      "no")~ "No",
    Cortex.y.n == "yes"~ "Yes",
    TRUE ~ Cortex.y.n  # keep the others
    )) %>%
mutate(Cortex = case_when(
    Cortex == "No Cortex"~ "No",
    TRUE ~ Cortex  # keep the others
    )) %>%
mutate(Cortex.position.simpl = Cortex.position, .after = Cortex.position) %>% #INSERT CORTEX.position.simpl
mutate(Cortex.position.simpl = case_when(
  Cortex == "No" ~ "No Cortex",
  Cortex.position.simpl %in% c(
    "Lateral left", 
    "Lateral right", 
    "Right", 
    "Left lateral complete",
    "Right lateral partial",
    "Left lateral partial",
    "Right lateral complete"
  ) ~ "Lateral",
  Cortex.position.simpl %in% c(
    "Left lateral complete;Right lateral partial", 
    "Left lateral complete;Right lateral complete",
    "Left lateral partial;Right lateral partial"
  ) ~ "Bilateral",
  Cortex.position.simpl %in% c(
    "Lateral left+Proximal", 
    "Lateral right + Proximal", 
    "Lateral left + Proximal",
    "Left lateral partial;Proximal",
    "Proximal;Right lateral partial",
    "Proximal;Right lateral complete",
    "Left lateral complete;Proximal"
  ) ~ "Lateral+Proximal",
  Cortex.position.simpl %in% c(
    "Dorsal+Lateral left", 
    "Lateral right + Dorsal", 
    "Lateral left + Dorsal", 
    "Lateral right + Dorsal"
  ) ~ "Lateral+Dorsal",
  Cortex.position.simpl %in% c(
    "Distal+Lateral left", 
    "Lateral right + Distal", 
    "Lateral left + Distal",
    "Distal;Left lateral complete", 
    "Distal;Right lateral partial",
    "Distal;Left lateral partial"
  ) ~ "Lateral+Distal",
  Cortex.position.simpl %in% c("Distal right", "Distal left") ~ "Distal",
  Cortex.position.simpl %in% c(
    "Bilateral + Distal", 
    "Dorsal distal", 
    "Dorsal + Distal" ,
    "Distal;Right lateral complete",
    "Distal;Middle/centre;Proximal", 
    "Middle/centre",
    "Middle/centre;Proximal",
    "Distal;Middle/centre",
    "Middle/centre;Right lateral complete",
    "100%", 
    "Middle/centre;Proximal", 
    "Dorsal + Distal",
    "Proximal + Dorsal",
    "Distal;Middle/centre",
    "Distal;Left lateral complete;Proximal",
    "Left lateral partial;Middle/centre", 
    "Left lateral complete;Middle/centre",
    "Distal;Middle/centre;Right lateral complete",
    "Distal;Left lateral partial;Middle/centre;Right lateral partial",
    "Distal;Left lateral complete;Middle/centre;Right lateral complete",
    "Distal;Left lateral partial;Proximal",
    "Distal;Proximal;Right lateral complete"
  ) ~ "Dorsal",
  Cortex.position.simpl %in% c("Distal;Proximal", "Proximal+Distal") ~ "Distal+Proximal",
  TRUE ~ Cortex.position.simpl
)) %>%
  mutate(Platform = case_when(
  Platform %in% c( "Facetted"
                    ) ~ "Faceted",
  Platform %in% c( "Cortical"
                    ) ~ "Natural",
  Platform %in% c("Dihedral flat"
                    )~ "Dihedral",
  Platform %in% c("Undetermined",
                  "Retouched",
                  "Abraded",
                  "Double"
                    )~ "ND",
  Platform %in% c("crushed"
                    )~ "Crushed",
  TRUE ~ Platform  # keep the others
    )) %>%
  mutate(Platform.simpl = Platform, .after = Platform) %>% #INSERT Platform.simpl
  mutate(Platform.simpl = case_when(
  Platform.simpl %in% c( "Linear", 
                         "Concave",
                         "Punctiform"
                    ) ~ "Plain",
  Platform.simpl %in% c( "Dihedral" 
                    ) ~ "Faceted",
  TRUE ~ Platform.simpl  # keep the others
    )) %>%
mutate(Bulb.simpl = Bulb, .after = Bulb) %>% #INSERT Bulb.simpl
mutate(Bulb.simpl = case_when(
  Bulb.simpl %in% c("No Prox Part",
                    "No bulb",
                    "Crushed") ~ NA,
  Bulb.simpl %in% c("Moderate",
                    "Diffused") ~ "Diffuse",
  Bulb.simpl %in% c("Bulbar scar",
                    "Pronounced")~ "Marked",
  TRUE ~ Bulb.simpl  # keep the others
    )) %>%
mutate(Lip.simpl = Lip, .after = Lip) %>% #INSERT Lip.simpl
mutate(Lip.simpl = case_when(
  Lip.simpl %in% c("No Prox Part" , 
                   "No Prox part" , 
                   "No prox part") ~ "No Prox Part",
  Lip.simpl == "NA" ~ NA,
  Lip.simpl %in%c("Moderate" , 
                  "Pronunced") ~ "Yes",
  is.na(Lip.simpl) | Bulb.simpl %in% c("Marked", "Diffuse")~ "No",
  TRUE ~ Lip.simpl  # keep the others
    )) %>%
  mutate(Abrasion.simpl = Abrasion, .after = Abrasion) %>% #INSERT Abrasion.simpl
  mutate(Abrasion.simpl = case_when(
  Abrasion.simpl %in% c("No Prox Part" , 
                        "No Prox part", 
                        "No prox part") ~ "No Prox Part",
  Abrasion.simpl %in% c("Abrasion" , 
                        "Hinged scars" , 
                        "Abrasion;Hinged scars" , 
                        "Abrasion;Pointed scars" , 
                        "Pointed scars", 
                        "Abrasion;Laminar scars", 
                        "Hinged scars;Pointed scars", 
                        "Laminar scars" , 
                        "Abrasion;Hinged scars;Laminar scars" , 
                        "Hinged scars;Laminar scars") ~ "Yes",
  TRUE ~ Abrasion.simpl  # keep the others
    )) %>%
  mutate(Axiality.simpl = Axiality, .after = Axiality) %>% #INSERT Axiality.simpl
  mutate(Axiality.simpl = case_when(
  Axiality.simpl %in% c("On-axis", 
                        "Axial", 
                        "on-axis") ~ "On axis",
  Axiality.simpl %in% c("Off-axis", 
                        "off-axis", 
                        "Off-axis to the right", 
                        "Off-axis to the left",
                        "Off-axis right",
                        "Off-axis left") ~ "Off axis",
  Axiality.simpl == "und" ~ "ND",
  Axiality.simpl == "NA" ~ NA,
  TRUE ~ Axiality.simpl  # keep the others
))  %>%
  mutate(Outline.morphology = case_when(
  Outline.morphology %in% c("(sub)Parellel Edges",
                            "(sub)Parellel edges" , 
                            "Sub-parallel" , 
                            "(sub)Parallel Edges" ) ~ "Subparallel edges",
  Outline.morphology == "Off-axis" | Axiality.simpl == "Off axis" ~ "Déjète",
  Outline.morphology == "Undetermined" ~ "ND",
  Outline.morphology == "Irregular" ~ "Other",
  Outline.morphology == "Convex" ~ "Convergent",
  Outline.morphology == "NA" ~ NA,
  TRUE ~ Outline.morphology  # keep the others
    )) %>%
  mutate(Symmetry = case_when(
  Symmetry == "NA" ~ NA,
  TRUE ~ Symmetry  # keep the others
    )) %>%
  mutate(Cross.section = case_when(
  Cross.section %in% c("NA", "Undetermined") ~ "ND",
  Cross.section== "NA" & Blank.type == "Flake" ~ NA,
  Cross.section %in% c("Polyhedral","Trapezoidal") ~ "Polyhedric",
  Cross.section == "Lateral steep" ~ "Triangular",
  
  TRUE ~ Cross.section  # keep the others
    )) %>%
  mutate(Profile = case_when(
  Profile == "NA" & Blank.type == "Flake" ~ NA,
  Profile %in% c("Slightly curved", 
                 "Curved slightly", 
                 "Curved sligthly") ~ "Slightly Curved",
  Profile == "Very curved" ~ "Very Curved",
  Profile %in% c("NA", 
                 "undetermined", 
                 "Curved inverse") ~ "ND",
  TRUE ~ Profile  # keep the others
)) %>%
  mutate(Torsion = case_when(
  Torsion %in% c("NA",
                 "Slightly curved", 
                 "Curved slightly", 
                 "Curved sligthly",
                 "0",
                 "Very curved", 
                 "Slightly curved") ~ "No",
  Torsion %in% c("1L", 
                 "2R", 
                 "1R", 
                 "2L") ~ "Yes",
  Torsion %in% c("Undetermined",
                 "undetermined", 
                 "Curved inverse") ~ "ND",
  TRUE ~ Torsion  # keep the others
)) %>%
  mutate(Distal.end.morpho = case_when(
  Distal.end.morpho %in% c("No Dist Part", 
                           "NA") ~ "No Dist Part",
  Distal.end.morpho %in% c("feathered", 
                           "Convex", 
                           "Straight") ~ "Feathered",
  Distal.end.morpho %in% c("Retouched", 
                           "Pointed", 
                           "Irregular", 
                           "Undetermined") ~ "ND",
  Distal.end.morpho == "Cortical" ~ "Stepped",
  TRUE ~ Distal.end.morpho  # keep the others
)) %>%
mutate(Technology.Phase = case_when(
    Technology.Phase %in% c("Simple", 
                            "Optimal") ~ "Ordinary",
    Technology.Phase %in% c("Mgmt", 
                            "Mngt", 
                            "Maintenance",
                            "Semi-cortical") ~ "MGMT", #semicortical from FUMANE are assumed to be MGTM
    Technology.Phase == "Initialization" ~ "Init",
    TRUE ~ Technology.Phase  # keep the others
)) %>%
mutate(Dorsal.scar.1 = case_when(
    Dorsal.scar.1 %in% c("Orthogonal", 
                         "Unidirectional transverse",
                         "Unidirectional+Crossed+Orthogonal") ~ "Crossed",
    Dorsal.scar.1 %in% c("Unidirectional convergent", 
                         "Unidirectional parallel" ) ~ "Unidirectional",
    Dorsal.scar.1 %in% c("Multidirectional", 
                         "Centripedal") ~ "Centripetal",
    Dorsal.scar.1 %in% c("Undetermined") ~ "ND",
    Dorsal.scar.1 %in% c("NA") | Number.negatives %in% c("No negatives", "0") ~ "No negatives",
    TRUE ~ Dorsal.scar.1  # keep the others
)) %>%
mutate(Retouch.Position = case_when(
    Retouch.Position %in% c("-"
                         ) ~ NA,
    TRUE ~ Retouch.Position  # keep the others
))
library(writexl)
writexl::write_xlsx(Blank_Main_reshaped1, "Ans_Rom_Fum_CTS_Blanksmerged_reshaped.xlsx")

#checking
View(Blank_Main_reshaped1)
unique(Blank_Main_reshaped1$Site)
unique(Blank_Main_reshaped1$Preservation)
unique(Blank_Main_reshaped1$Cortex.y.n)
unique(Blank_Main_reshaped1$Cortex)
unique(Blank_Main_reshaped1$Cortex.position.simpl)
unique(Blank_Main_reshaped1$Bulb.simpl)
unique(Blank_Main_reshaped1$Lip.simpl)
unique(Blank_Main_reshaped1$Abrasion.simpl)
unique(Blank_Main_reshaped1$Axiality.simpl)
unique(Blank_Main_reshaped1$Outline.morphology)
unique(Blank_Main_reshaped1$Symmetry)
unique(Blank_Main_reshaped1$Cross.section)
unique(Blank_Main_reshaped1$Profile)
unique(Blank_Main_reshaped1$Torsion)
unique(Blank_Main_reshaped1$Distal.end.morpho)
unique(Blank_Main_reshaped1$Blank.type)
unique(Blank_Main_reshaped1$Technology.Phase)
unique(Blank_Main_reshaped1$Technology.Extended)
unique(Blank_Main_reshaped1$Negatives.type)
unique(Blank_Main_reshaped1$Dorsal.scar.1)
unique(Blank_Main_reshaped1$Retouch.Position)
  
```

# Analysis

```{r}
library(readxl)
library(dplyr)
Blank_Main_reshaped1 <- read_excel(file.choose()) #get the Ans_Rom_Fum_CTS_Blanksmerged_reshaped.xlsx
View(Blank_Main_reshaped1)
str(Blank_Main_reshaped1)
Blank_Main_reshaped1 <- Blank_Main_reshaped1 %>% 
  filter(!Technology.Extended %in% c("Levallois")) %>% #removing the Levallois flakes
  mutate(Number.negatives = case_when(
    Number.negatives > 4 ~ "4+",  # substitute with "4+" when greater than 4
    TRUE ~ as.character(Number.negatives)  # keep the original value otherwise
  ))
```

##Reducing variability changing categories that are accounting less than 5% in groups as Other

```{r}


library(dplyr)

ANCxPosBld <- Blank_Main_reshaped1 %>%
  filter(Site == "AN", Blank.type == "Blade") %>%
  mutate(Cortex.position.simpl_lump = Cortex.position.simpl, .after = Cortex.position.simpl)

# Check the proportions table
proportions_table <- table(ANCxPosBld$Cortex.position.simpl_lump, useNA = "no") / sum(!is.na(ANCxPosBld$Cortex.position.simpl_lump)) * 100
print(proportions_table)

# Modify levels based on proportions and create "Other" category
ANCxPosBld <- ANCxPosBld %>%
  mutate(Cortex.position.simpl_lump = case_when(
    Cortex.position.simpl_lump %in% c("Proximal") ~ "Other", #less than 5% categories
    TRUE ~ as.character(Cortex.position.simpl_lump)
  ))

ANCxPosBldl <- Blank_Main_reshaped1 %>% 
  filter(Site == "AN", Blank.type == "Bladelet") %>%
mutate(Cortex.position.simpl_lump = Cortex.position.simpl, .after = Cortex.position.simpl)

proportions_table <- table(ANCxPosBldl$Cortex.position.simpl_lump, useNA = "no") / sum(!is.na(ANCxPosBldl$Cortex.position.simpl_lump)) * 100
print(proportions_table)
# Modify levels based on proportions and create "Other" category
ANCxPosBldl <- ANCxPosBldl %>%
  mutate(Cortex.position.simpl_lump = case_when(
    Cortex.position.simpl_lump %in% c("Distal+Proximal", "Proximal") ~ "Other", #less than 5% categories
    TRUE ~ as.character(Cortex.position.simpl_lump)
  ))

ANCxPosFl <- Blank_Main_reshaped1 %>% 
  filter(Site == "AN", Blank.type == "Flake")%>%
mutate(Cortex.position.simpl_lump = Cortex.position.simpl, .after = Cortex.position.simpl)

proportions_table <- table(ANCxPosFl$Cortex.position.simpl_lump, useNA = "no") / sum(!is.na(ANCxPosFl$Cortex.position.simpl_lump)) * 100
print(proportions_table)

ANCxPosFl <- ANCxPosFl %>%
  mutate(Cortex.position.simpl_lump = case_when(
    Cortex.position.simpl_lump %in% c("Bilateral") ~ "Other", #less than 5% categories
    TRUE ~ as.character(Cortex.position.simpl_lump)
  ))


CTSCxPosBldl <- Blank_Main_reshaped1 %>% 
  filter(Site == "CTS", Blank.type == "Bladelet")%>%
mutate(Cortex.position.simpl_lump = Cortex.position.simpl, .after = Cortex.position.simpl)

proportions_table <- table(CTSCxPosBldl$Cortex.position.simpl_lump, useNA = "no") / sum(!is.na(CTSCxPosBldl$Cortex.position.simpl_lump)) * 100
print(proportions_table)

CTSCxPosBldl <- CTSCxPosBldl %>%
  mutate(Cortex.position.simpl_lump = case_when(
    Cortex.position.simpl_lump %in% c("Bilateral", "Lateral+Distal", "Lateral+Dorsal", "Lateral+Proximal", "Proximal") ~ "Other", #less than 5% categories
    TRUE ~ as.character(Cortex.position.simpl_lump)  
  ))

CTSCxPosBld <- Blank_Main_reshaped1 %>% 
  filter(Site == "CTS", Blank.type == "Blade") %>%
mutate(Cortex.position.simpl_lump = Cortex.position.simpl, .after = Cortex.position.simpl) 

proportions_table <- table(CTSCxPosBld$Cortex.position.simpl_lump, useNA = "no") / sum(!is.na(CTSCxPosBld$Cortex.position.simpl_lump)) * 100
print(proportions_table)

CTSCxPosBld <- CTSCxPosBld %>%
  mutate(Cortex.position.simpl_lump = case_when(
    Cortex.position.simpl_lump %in% c("Bilateral", "Lateral+Dorsal", "Lateral+Proximal") ~ "Other", #less than 5% categories
    TRUE ~ as.character(Cortex.position.simpl_lump)  
  ))

CTSCxPosFl <- Blank_Main_reshaped1 %>% 
  filter(Site == "CTS", Blank.type == "Flake")%>%
mutate(Cortex.position.simpl_lump = Cortex.position.simpl, .after = Cortex.position.simpl) 

proportions_table <- table(CTSCxPosFl$Cortex.position.simpl_lump, useNA = "no") / sum(!is.na(CTSCxPosFl$Cortex.position.simpl_lump)) * 100
print(proportions_table)

CTSCxPosFl <- CTSCxPosFl %>%
  mutate(Cortex.position.simpl_lump = case_when(
    Cortex.position.simpl_lump %in% c("Bilateral", "Lateral+Dorsal", "Lateral+Proximal") ~ "Other", #less than 5% categories
    TRUE ~ as.character(Cortex.position.simpl_lump)  
  ))

FUMCxPosBldl <- Blank_Main_reshaped1 %>% 
  filter(Site == "FUM", Blank.type == "Bladelet") %>%
mutate(Cortex.position.simpl_lump = Cortex.position.simpl, .after = Cortex.position.simpl) 

proportions_table <- table(FUMCxPosBldl$Cortex.position.simpl_lump, useNA = "no") / sum(!is.na(FUMCxPosBldl$Cortex.position.simpl_lump)) * 100
print(proportions_table)

FUMCxPosBldl <- FUMCxPosBldl %>%
  mutate(Cortex.position.simpl_lump = case_when(
    Cortex.position.simpl_lump %in% c("Distal+Proximal", "Proximal") ~ "Other", #less than 5% categories
    TRUE ~ as.character(Cortex.position.simpl_lump)  
  ))

FUMCxPosBld <- Blank_Main_reshaped1 %>% 
  filter(Site == "FUM", Blank.type == "Blade") %>%
mutate(Cortex.position.simpl_lump = Cortex.position.simpl, .after = Cortex.position.simpl) 

proportions_table <- table(FUMCxPosBld$Cortex.position.simpl_lump, useNA = "no") / sum(!is.na(FUMCxPosBld$Cortex.position.simpl_lump)) * 100
print(proportions_table)

FUMCxPosBld <- FUMCxPosBld %>%
  mutate(Cortex.position.simpl_lump = case_when(
    Cortex.position.simpl_lump %in% c("Distal+Proximal", "Lateral+Proximal", "Proximal") ~ "Other", #less than 5% categories
    TRUE ~ as.character(Cortex.position.simpl_lump)  
  ))

FUMCxPosFl <- Blank_Main_reshaped1 %>% 
  filter(Site == "FUM", Blank.type == "Flake") %>%
mutate(Cortex.position.simpl_lump = Cortex.position.simpl, .after = Cortex.position.simpl)  

proportions_table <- table(FUMCxPosFl$Cortex.position.simpl_lump, useNA = "no") / sum(!is.na(FUMCxPosFl$Cortex.position.simpl_lump)) * 100
print(proportions_table)

FUMCxPosFl <- FUMCxPosFl %>%
  mutate(Cortex.position.simpl_lump = case_when(
    Cortex.position.simpl_lump %in% c("Bilateral", "Distal+Proximal", "Lateral+Distal", "Lateral+Proximal", "Proximal") ~ "Other", #less than 5% categories
    TRUE ~ as.character(Cortex.position.simpl_lump)  
  ))

ROMCxPosBldl <- Blank_Main_reshaped1 %>% 
  filter(Site == "ROM", Blank.type == "Bladelet") %>%
mutate(Cortex.position.simpl_lump = Cortex.position.simpl, .after = Cortex.position.simpl)

proportions_table <- table(ROMCxPosBldl$Cortex.position.simpl_lump, useNA = "no") / sum(!is.na(ROMCxPosBldl$Cortex.position.simpl_lump)) * 100
print(proportions_table)

#no categories less than 5%

ROMCxPosBld <- Blank_Main_reshaped1 %>% 
  filter(Site == "ROM", Blank.type == "Blade")%>%
mutate(Cortex.position.simpl_lump = Cortex.position.simpl, .after = Cortex.position.simpl) 

proportions_table <- table(ROMCxPosBld$Cortex.position.simpl_lump, useNA = "no") / sum(!is.na(ROMCxPosBld$Cortex.position.simpl_lump)) * 100
print(proportions_table)

ROMCxPosBld <- ROMCxPosBld %>%
  mutate(Cortex.position.simpl_lump = case_when(
    Cortex.position.simpl_lump %in% c("Distal+Proximal", "Lateral+Proximal") ~ "Other", #less than 5% categories
    TRUE ~ as.character(Cortex.position.simpl_lump)  
  ))

ROMCxPosFl <- Blank_Main_reshaped1 %>% 
  filter(Site == "ROM", Blank.type == "Flake")%>%
mutate(Cortex.position.simpl_lump = Cortex.position.simpl, .after = Cortex.position.simpl) 

proportions_table <- table(ROMCxPosFl$Cortex.position.simpl_lump, useNA = "no") / sum(!is.na(ROMCxPosFl$Cortex.position.simpl_lump)) * 100
print(proportions_table)

ROMCxPosFl <- ROMCxPosFl %>%
  mutate(Cortex.position.simpl_lump = case_when(
    Cortex.position.simpl_lump %in% c("Lateral+Distal", "Lateral+Dorsal") ~ "Other", #less than 5% categories
    TRUE ~ as.character(Cortex.position.simpl_lump)  
  ))


# Combine the results into a single data frame
Blanks_Main_lumped <- rbind(ANCxPosBld,
  ANCxPosBldl,
  ANCxPosFl,
  CTSCxPosBldl,
  CTSCxPosBld,
  CTSCxPosFl,
  FUMCxPosBldl,
  FUMCxPosBld,
  FUMCxPosFl,
  ROMCxPosBldl,
  ROMCxPosBld,
  ROMCxPosFl
)


```


##Exploratory plots



```{r}
#reordering for more intuitive display
Blanks_Main_lumped$Site_F <- factor(Blanks_Main_lumped$Site, levels= c("AN", "ROM", "FUM", "CTS")) #geographical South East to NorthWest
```

```{r}


Blanks_Main_lumped$Blank.type_F <- factor(Blanks_Main_lumped$Blank.type, levels= c("Flake", "Blade", "Bladelet")) #reorder bigger to smaller

library(RColorBrewer)
Blank_values <- unique(Blanks_Main_lumped$Blank.type_F)

# Use the ColorBrewer Set3 palette
color_palette <- brewer.pal(n = length(Blank_values), name = "Set3")

# Create a color dictionary mapping each unique value to a color
Blank_pal <- setNames(color_palette, Blank_values)
library(dplyr)
library(ggplot2)
library(ggstatsplot)

Blank <- ggbarstats(
  data = Blanks_Main_lumped,
  x = Blank.type_F,  
  y = Site_F,  
  results.subtitle = FALSE,
  ggplot.component = list(
    scale_fill_manual(values =  Blank_pal),  # Assign colors to values and set a single legend
    theme(
      plot.subtitle = element_text(size = 8, color = "black"),
      plot.caption = element_text(size = 8, color = "black"),
      axis.text = element_text(face = "bold", size = 8, color = "black", family = "Arial"),
      axis.text.y = element_text(face = "bold", size = 8, family = "Arial"),
      legend.title = element_blank(),  
      axis.ticks.x = element_blank(),
      strip.text = element_text(face = "bold", size = 8, family = "Arial"),
      axis.title.x =element_blank()
      ))
    )
  Blank
  
  ggsave("Blank.tiff", plot = Blank, width = 13.20271, height = 20.13479, units = "cm", dpi = 300) #set your working directory with setwd() 
```

Observed blank types frequencies vary markedly between sites. Romanesti shows the highest percentage of flakes, dwarfing the other three assemblages. Ansab and Les Cottés shows a similar pattern, blades are more represented than bladelets in general. Blades and bladelets are equal in Romanesti, consisting in the other half of the assemblage. In Fumane bladelets are accounting for over half of the assemblage. 
###technological phases
```{r}
Blanks_Main_lumped$Technology.Phase_F <- factor(Blanks_Main_lumped$Technology.Phase, levels= c("Init", "MGMT", "Tablet", "Ordinary", "Spall")) #reorder earlier to later
library(RColorBrewer)
# Get unique values in the Technology.Phase_F column
Tech_values <- unique(Blanks_Main_lumped$Technology.Phase_F)

# Use the ColorBrewer Set3 palette
color_palette <- brewer.pal(n = length(Tech_values), name = "Set3")

# Create a color dictionary mapping each unique value to a color
Tech_pal <- setNames(color_palette, Tech_values)
library(dplyr)
library(ggplot2)
library(ggstatsplot)
# Create grouped bar plot
Tech.Phase <- ggbarstats(
  data = Blanks_Main_lumped,
  x = Technology.Phase_F,  
  y = Site_F,  
  results.subtitle = FALSE,
  ggplot.component = list(
    scale_fill_manual(values =  Tech_pal),  # Assign colors to values and set a single legend
    theme(
      plot.subtitle = element_text(size = 8, color = "black"),
      plot.caption = element_text(size = 8, color = "black"),
      axis.text = element_text(face = "bold", size = 8, color = "black", family = "Arial"),
      axis.text.y = element_text(face = "bold", size = 8, family = "Arial"),
      legend.title = element_blank(),  
      axis.ticks.x = element_blank(),
      strip.text = element_text(face = "bold", size = 8, family = "Arial"),
      axis.title.x =element_blank()
    )))
 Tech.Phase
 
ggsave("TechPhase.tiff", plot = Tech.Phase, width = 27.49021, height = 20.13479, units = "cm", dpi = 300) #set your working directory with setwd() 
```

Observed technological phases frequencies are largely overlapping in Ansab, Fumane and Les Cottés. Romanesti shows a higher percentage of Management artefacts, while Les Cottés an higher percentage of Initialisation (cortical) ones. 

```{r}

library(dplyr)
library(ggplot2)
library(ggstatsplot)
# Create grouped bar plot
Blank.Tech.Phase <- grouped_ggbarstats(
  data = Blanks_Main_lumped, 
  x = Technology.Phase_F,  
  y = Site_F, 
  grouping.var = Blank.type_F,
  results.subtitle = FALSE,
  counts = NULL,
  ggplot.component = list(
    scale_fill_manual(values = Tech_pal),  # Specify guide argument to merge legends
    theme(
      axis.text = element_text(face = "bold", size = 6, color = "black", family = "Arial"),
      axis.text.y = element_text(face = "bold", size = 6, family = "Arial"),
      axis.ticks.x = element_blank(),
      legend.title = element_blank(), 
      strip.text = element_text(face = "bold", size = 6, family = "Arial"),
      axis.title.x = element_blank()
    ))
)
Blank.Tech.Phase

ggsave("BlankTechPhase.tiff", plot = Blank.Tech.Phase, width = 27.49021, height = 20.13479, units = "cm", dpi = 300) #set your working directory with setwd()
```

The percentage of Ordinary blanks it's prevalent in bladelets with similar percentages in Ansab, Fumane and Les Cottés. Ordinary blades are accounting for nearly half the total blades in Ansab, Romanesti and Fumane, while in Les Cottès they are much more frequent. Flakes are largely used for management purposes in all assemblages; uncortical, ordinary flakes are present in equal percentages in Romanesti and Fumane.

###cortex
```{r}
Blanks_Main_lumped$Cortex_F <- factor(Blanks_Main_lumped$Cortex, levels= c("No", "Semi", "Extensive", "Full")) #less to fully covered
library(RColorBrewer)
# Get unique values in the Platform.Simpl column
Cx_values <- unique(Blanks_Main_lumped$Cortex_F)

# Use the ColorBrewer Set3 palette
color_palette <- brewer.pal(n = length(Cx_values), name = "Set3")

# Create a color dictionary mapping each unique value to a color
Cortex_pal <- setNames(color_palette, Cx_values)

library(dplyr)
library(ggplot2)
library(ggstatsplot)
# Create grouped bar plot
Gen.Cortex <- grouped_ggbarstats(
  data = Blanks_Main_lumped,
  x = Cortex_F,  
  y = Site_F,
  xlab = "Site",
  grouping.var = Blank.type_F,
  results.subtitle = FALSE,
  ggplot.component = list(
    scale_fill_manual(values =  Cortex_pal),  # Assign colors to values and set a single legend
    theme(
      plot.subtitle = element_text(size = 8, color = "black"),
      plot.caption = element_text(size = 8, color = "black"),
      axis.text = element_text(face = "bold", size = 8, color = "black", family = "Arial"),
      axis.text.y = element_text(face = "bold", size = 8, family = "Arial"),
      legend.title = element_blank(),  
      axis.ticks.x = element_blank(),
      strip.text = element_text(face = "bold", size = 8, family = "Arial")
    )))
Gen.Cortex

ggsave("Gen.Cortex.tiff", plot = Gen.Cortex, width = 27.49021, height = 20.13479, units = "cm", dpi = 300) #set your working directory with setwd()
```

```{r}
Init.Cortex <- grouped_ggbarstats(
  data = filter(Blanks_Main_lumped, Technology.Phase_F == "Init"),
  x = Cortex_F,  
  y = Site_F, 
  grouping.var = Blank.type_F,
  results.subtitle = FALSE,
  xlab = "Site",
  ggplot.component = list(
    scale_fill_manual(values =  Cortex_pal),  # Assign colors to values and set a single legend
    theme(
      plot.subtitle = element_text(size = 8, color = "black"),
      plot.caption = element_text(size = 8, color = "black"),
      axis.text = element_text(face = "bold", size = 8, color = "black", family = "Arial"),
      axis.text.y = element_text(face = "bold", size = 8, family = "Arial"),
      legend.title = element_blank(),  
      axis.ticks.x = element_blank(),
      strip.text = element_text(face = "bold", size = 8, family = "Arial")
    )))
Init.Cortex

ggsave("Init.Cortex.tiff", plot = Init.Cortex, width = 27.49021, height = 20.13479, units = "cm", dpi = 300) #set your working directory with setwd()
```

```{r}
MGMT.Cortex <- grouped_ggbarstats(
  data = filter(Blanks_Main_lumped, Technology.Phase_F == "MGMT"),
  x = Cortex_F,  
  y = Site_F, 
  grouping.var = Blank.type_F,
   xlab = "Site",
  results.subtitle = FALSE,
  ggplot.component = list(
    scale_fill_manual(values =  Cortex_pal),  # Assign colors to values and set a single legend
    theme(
      plot.subtitle = element_text(size = 8, color = "black"),
      plot.caption = element_text(size = 8, color = "black"),
      axis.text = element_text(face = "bold", size = 8, color = "black", family = "Arial"),
      axis.text.y = element_text(face = "bold", size = 8, family = "Arial"),
      legend.title = element_blank(),  
      axis.ticks.x = element_blank(),
      strip.text = element_text(face = "bold", size = 8, family = "Arial")
    )))
MGMT.Cortex

ggsave("MGMT.Cortex.tiff", plot = MGMT.Cortex, width = 27.49021, height = 20.13479, units = "cm", dpi = 300) #set your working directory with setwd()
```

```{r}
Ordinary.Cortex <- grouped_ggbarstats(
  data = filter(Blanks_Main_lumped,  Technology.Phase_F == "Ordinary"),
  x = Cortex_F,  
  y = Site_F, 
  xlab = "Site",
  grouping.var = Blank.type_F,
  results.subtitle = FALSE,
  ggplot.component = list(
    scale_fill_manual(values =  Cortex_pal),  # Assign colors to values and set a single legend
    theme(
      plot.subtitle = element_text(size = 8, color = "black"),
      plot.caption = element_text(size = 8, color = "black"),
      axis.text = element_text(face = "bold", size = 8, color = "black", family = "Arial"),
      axis.text.y = element_text(face = "bold", size = 8, family = "Arial"),
      legend.title = element_blank(),  
      axis.ticks.x = element_blank(),
      strip.text = element_text(face = "bold", size = 8, family = "Arial")
    )))
Ordinary.Cortex

ggsave("Ordinary.Cortex.tiff", plot = Ordinary.Cortex, width = 27.49021, height = 20.13479, units = "cm", dpi = 300) #set your working directory with setwd()
```

Trends about cortical artefacts are largely similar across sites. Cortical artefacts, especially the extensively cortical ones, are much more present in Flakes. Semicortical artefacts are still present in blades. Bladelets are largely uncortical, Les Cottés is showing the larger frequency of semi-cortical bladelets

###cortical position
```{r}
Blanks_Main_lumped$Cortex.position.simpl_lump_F <- factor(Blanks_Main_lumped$Cortex.position.simpl_lump, levels= c( "Proximal", "Lateral", "Lateral+Distal", "Distal", "Dorsal","Other")) #proximal to distal

library(RColorBrewer)
# Get unique values in the Platform.Simpl column
position_values <- unique(Blanks_Main_lumped$Cortex.position.simpl_lump_F)

# Use the ColorBrewer Set3 palette
color_palette <- brewer.pal(n = length(position_values), name = "Set3")

# Create a color dictionary mapping each unique value to a color
Cortex.Pos_pal <- setNames(color_palette, position_values)


library(ggstatsplot)
library(ggplot2)
# Create grouped bar plot
Gen.Cortex.Pos <- grouped_ggbarstats(
  data = filter(Blanks_Main_lumped, Cortex.y.n == "Yes", Cortex.position.simpl_lump_F != "Other"), 
  x = Cortex.position.simpl_lump_F,  
  y = Site_F, 
  grouping.var = Blank.type_F,
  xlab = "Site",
  results.subtitle = FALSE,
  ggplot.component = list(scale_fill_manual(values =  Cortex.Pos_pal),
     # Assign colors to values and set a single legend
    theme(
      plot.subtitle = element_text(size = 8, color = "black"),
      plot.caption = element_text(size = 8, color = "black"),
      axis.text = element_text(face = "bold", size = 8, color = "black", family = "Arial"),
      axis.text.y = element_text(face = "bold", size = 8, family = "Arial"),
      legend.title = element_blank(),  
      axis.ticks.x = element_blank(),
      strip.text = element_text(face = "bold", size = 8, family = "Arial")
    )))
Gen.Cortex.Pos

ggsave("Gen.Cortex.Pos.tiff", plot = Gen.Cortex.Pos, width = 27.49021, height = 20.13479, units = "cm", dpi = 300) #set your working directory with setwd()
```

```{r}
Init.Cortex.Pos <- grouped_ggbarstats(
  data = filter(Blanks_Main_lumped, Cortex.y.n == "Yes", Cortex.position.simpl_lump_F != "Other", Technology.Phase_F == "Init" ), 
  x = Cortex.position.simpl_lump_F,  
  y = Site_F, 
  grouping.var = Blank.type_F,
  results.subtitle = FALSE,
  xlab = "Site",
  ggplot.component = list(
    scale_fill_manual(values =  Cortex.Pos_pal),  # Assign colors to values and set a single legend
    theme(
      plot.subtitle = element_text(size = 8, color = "black"),
      plot.caption = element_text(size = 8, color = "black"),
      axis.text = element_text(face = "bold", size = 8, color = "black", family = "Arial"),
      axis.text.y = element_text(face = "bold", size = 8, family = "Arial"),
      legend.title = element_blank(),  
      axis.ticks.x = element_blank(),
      strip.text = element_text(face = "bold", size = 8, family = "Arial")
    )))
Init.Cortex.Pos

ggsave("Init.Cortex.Pos.tiff", plot = Init.Cortex.Pos, width = 27.49021, height = 20.13479, units = "cm", dpi = 300) #set your working directory with setwd()
```

```{r}
MGMT.Cortex.Pos <- grouped_ggbarstats(
  data = filter(Blanks_Main_lumped, Cortex.y.n == "Yes", Cortex.position.simpl_lump_F != "Other", Technology.Phase_F == "MGMT" ), 
  x = Cortex.position.simpl_lump_F,  
  y = Site_F, 
  grouping.var = Blank.type_F,
  xlab="Site",
  results.subtitle = FALSE,
  ggplot.component = list(
    scale_fill_manual(values =  Cortex.Pos_pal),  # Assign colors to values and set a single legend
    theme(
      plot.subtitle = element_text(size = 8, color = "black"),
      plot.caption = element_text(size = 8, color = "black"),
      axis.text = element_text(face = "bold", size = 8, color = "black", family = "Arial"),
      axis.text.y = element_text(face = "bold", size = 8, family = "Arial"),
      legend.title = element_blank(),  
      axis.ticks.x = element_blank(),
      strip.text = element_text(face = "bold", size = 8, family = "Arial")
    )))
MGMT.Cortex.Pos

ggsave("MGMT.Cortex.Pos.tiff", plot = MGMT.Cortex.Pos, width = 27.49021, height = 20.13479, units = "cm", dpi = 300) #set your working directory with setwd()
```

```{r}
Ordinary.Cortex.Pos <- grouped_ggbarstats(
  data = filter(Blanks_Main_lumped, Cortex.y.n == "Yes", Cortex.position.simpl_lump_F != "Other", Technology.Phase_F == "Ordinary" ), 
  x = Cortex.position.simpl_lump_F,  
  y = Site_F, 
  grouping.var = Blank.type_F,
  xlab="Site",
  results.subtitle = FALSE,
  ggplot.component = list(
    scale_fill_manual(values =  Cortex.Pos_pal),  # Assign colors to values and set a single legend
    theme(
      plot.subtitle = element_text(size = 8, color = "black"),
      plot.caption = element_text(size = 8, color = "black"),
      axis.text = element_text(face = "bold", size = 8, color = "black", family = "Arial"),
      axis.text.y = element_text(face = "bold", size = 8, family = "Arial"),
      legend.title = element_blank(),  
      axis.ticks.x = element_blank(),
      strip.text = element_text(face = "bold", size = 8, family = "Arial")
    )))
Ordinary.Cortex.Pos

ggsave("Ordinary.Cortex.Pos.tiff", plot = Ordinary.Cortex.Pos, width = 27.49021, height = 20.13479, units = "cm", dpi = 300) #set your working directory with setwd()
```

###platform

```{r}

Blanks_Main_lumped$Platform.simpl_F <- factor(Blanks_Main_lumped$Platform.simpl, levels= c("Natural","Plain", "Faceted",  "Crushed", "ND")) #unprepared to prepared

library(RColorBrewer)
# Get unique values in the Platform.Simpl column
platform_values <- unique(Blanks_Main_lumped$Platform.simpl_F)

# Use the ColorBrewer Set3 palette
color_palette <- brewer.pal(n = length(platform_values), name = "Set3")

# Create a color dictionary mapping each unique value to a color
Platform_pal <- setNames(color_palette, platform_values)


library(dplyr)
library(ggplot2)
library(ggstatsplot)
# Create grouped bar plot
Gen.Platform.simpl <- grouped_ggbarstats(
  data = filter(Blanks_Main_lumped, Preservation !="Mes+Dist", Platform.simpl %in% c("Plain","Natural", "Faceted" ,"Crushed")), #only blanks with a platform
  x = Platform.simpl_F,  
  y = Site_F, 
  grouping.var = Blank.type_F,
  xlab="Site",
  results.subtitle = FALSE,
  ggplot.component = list(
    scale_fill_manual(values = Platform_pal),
    theme(
      plot.subtitle = element_text(size = 8, color = "black"),
      plot.caption = element_text(size = 8, color = "black"),
      axis.text = element_text(face = "bold", size = 8, color = "black", family = "Arial"),
      axis.text.y = element_text(face = "bold", size = 8, family = "Arial"),
      legend.title = element_blank(),  
      axis.ticks.x = element_blank(),
      strip.text = element_text(face = "bold", size = 8, family = "Arial")
    )))
Gen.Platform.simpl

ggsave("Gen.Platform.simpl.tiff", plot = Gen.Platform.simpl, width = 27.49021, height = 20.13479, units = "cm", dpi = 300) #set your working directory with setwd()
```

```{r}
library(dplyr)

Blanks_Main_lumped$Platform_F <- factor(Blanks_Main_lumped$Platform, levels= c("Natural","Plain", "Linear", "Punctiform" , "Concave", "Faceted", "Dihedral", "Crushed", "ND")) #unprepared to prepared


library(RColorBrewer)
# Get unique values in the Platform.Simpl column
platform_values <- unique(Blanks_Main_lumped$Platform_F)

# Use the ColorBrewer Set3 palette
color_palette <- brewer.pal(n = length(platform_values), name = "Set3")

# Create a color dictionary mapping each unique value to a color
Platform_pal <- setNames(color_palette, platform_values)


library(dplyr)
library(ggplot2)
library(ggstatsplot)
# Create grouped bar plot
Gen.Platform <- grouped_ggbarstats(
  data = filter(Blanks_Main_lumped, Preservation !="Mes+Dist", Platform %in% c("Linear","Plain","Natural","Punctiform","Dihedral", "Crushed","Concave","Faceted")), 
  x = Platform_F,  
  y = Site_F, 
  xlab="Site",
  grouping.var = Blank.type_F,
  results.subtitle = FALSE,
  ggplot.component = list(
    scale_fill_manual(values = Platform_pal),
    theme(
      plot.subtitle = element_text(size = 8, color = "black"),
      plot.caption = element_text(size = 8, color = "black"),
      axis.text = element_text(face = "bold", size = 8, color = "black", family = "Arial"),
      axis.text.y = element_text(face = "bold", size = 8, family = "Arial"),
      legend.title = element_blank(),  
      axis.ticks.x = element_blank(),
      strip.text = element_text(face = "bold", size = 8, family = "Arial")
    )))
Gen.Platform

ggsave("Gen.Platform.tiff", plot = Gen.Platform, width = 27.49021, height = 20.13479, units = "cm", dpi = 300) #set your working directory with setwd()
```


```{r}
Init.Platform <- grouped_ggbarstats(
  data = filter(Blanks_Main_lumped, Preservation !="Mes+Dist", Platform %in% c("Linear","Plain","Natural","Punctiform","Dihedral", "Crushed","Concave","Faceted"), Technology.Phase_F == "Init"), 
  x = Platform_F,  
  y = Site_F, 
  grouping.var = Blank.type_F,
  xlab="Site",
  results.subtitle = FALSE,
  ggplot.component = list(
    scale_fill_manual(values = Platform_pal),
    theme(
      plot.subtitle = element_text(size = 8, color = "black"),
      plot.caption = element_text(size = 8, color = "black"),
      axis.text = element_text(face = "bold", size = 8, color = "black", family = "Arial"),
      axis.text.y = element_text(face = "bold", size = 8, family = "Arial"),
      legend.title = element_blank(),  
      axis.ticks.x = element_blank(),
      strip.text = element_text(face = "bold", size = 8, family = "Arial")
    )))
Init.Platform

ggsave("Init.Platform.tiff", plot = Init.Platform, width = 27.49021, height = 20.13479, units = "cm", dpi = 300) #set your working directory with setwd()
```

```{r}
MGMT.Platform <- grouped_ggbarstats(
  data = filter(Blanks_Main_lumped, Preservation !="Mes+Dist", Platform %in% c("Linear","Plain","Natural","Punctiform","Dihedral", "Crushed","Concave","Faceted"), Technology.Phase_F == "MGMT"), 
  x = Platform_F,  
  y = Site_F, 
  xlab="Site",
  grouping.var = Blank.type_F,
  results.subtitle = FALSE,
  ggplot.component = list(
    scale_fill_manual(values =  Platform_pal),  # Assign colors to values and set a single legend
    theme(
      plot.subtitle = element_text(size = 8, color = "black"),
      plot.caption = element_text(size = 8, color = "black"),
      axis.text = element_text(face = "bold", size = 8, color = "black", family = "Arial"),
      axis.text.y = element_text(face = "bold", size = 8, family = "Arial"),
      legend.title = element_blank(),  
      axis.ticks.x = element_blank(),
      strip.text = element_text(face = "bold", size = 8, family = "Arial")
    )))
MGMT.Platform

ggsave("MGMT.Platform.tiff", plot = MGMT.Platform, width = 27.49021, height = 20.13479, units = "cm", dpi = 300) #set your working directory with setwd()
```

```{r}
Ordinary.Platform <- grouped_ggbarstats(
  data = filter(Blanks_Main_lumped, Preservation !="Mes+Dist", Platform %in% c("Linear","Plain","Natural","Punctiform","Dihedral", "Crushed","Concave","Faceted"), Technology.Phase_F == "Ordinary"), 
  x = Platform_F,  
  y = Site_F, 
  grouping.var = Blank.type_F,
  xlab="Site",
  results.subtitle = FALSE,
  ggplot.component = list(
    scale_fill_manual(values =  Platform_pal),  # Assign colors to values and set a single legend
    theme(
      plot.subtitle = element_text(size = 8, color = "black"),
      plot.caption = element_text(size = 8, color = "black"),
      axis.text = element_text(face = "bold", size = 8, color = "black", family = "Arial"),
      axis.text.y = element_text(face = "bold", size = 8, family = "Arial"),
      legend.title = element_blank(),  
      axis.ticks.x = element_blank(),
      strip.text = element_text(face = "bold", size = 8, family = "Arial")
    )))
Ordinary.Platform

ggsave("ordinary.Platform.tiff", plot = Ordinary.Platform, width = 27.49021, height = 20.13479, units = "cm", dpi = 300) #set your working directory with setwd()
```

Unprepared platforms are the norm in all blank types across sites. Les Cottés flakes show a higher platform preparation, but also, in general, a higher frequency of Crushed platforms.

###bulb
```{r}
unique(Blanks_Main_lumped$Bulb.simpl)
Blanks_Main_lumped$Bulb.simpl_F <- factor(Blanks_Main_lumped$Bulb.simpl, levels= c("Diffuse","Not perceived", "Marked", "ND")) #small to big

library(RColorBrewer)
# Get unique values in the Platform.Simpl column
Bulb_values <- unique(Blanks_Main_lumped$Bulb.simpl_F)

# Use the ColorBrewer Set3 palette
color_palette <- brewer.pal(n = length(Bulb_values), name = "Set3")

# Create a color dictionary mapping each unique value to a color
Bulb_pal <- setNames(color_palette, Bulb_values)
library(dplyr)
library(ggplot2)
library(ggstatsplot)
# Create grouped bar plot
Gen.Bulb <- grouped_ggbarstats(
  data = filter(Blanks_Main_lumped, Preservation !="Mes+Dist", Bulb.simpl_F %in% c("Diffuse","Not perceived", "Marked")), 
  x = Bulb.simpl_F,  
  y = Site_F,
  xlab="Site",
  grouping.var = Blank.type_F,
  results.subtitle = FALSE,
  ggplot.component = list(
    scale_fill_manual(values =  Bulb_pal),  # Assign colors to values and set a single legend
    theme(
      plot.subtitle = element_text(size = 8, color = "black"),
      plot.caption = element_text(size = 8, color = "black"),
      axis.text = element_text(face = "bold", size = 8, color = "black", family = "Arial"),
      axis.text.y = element_text(face = "bold", size = 8, family = "Arial"),
      legend.title = element_blank(),  
      axis.ticks.x = element_blank(),
      strip.text = element_text(face = "bold", size = 8, family = "Arial")
    )))
Gen.Bulb

ggsave("Gen.Bulb.tiff", plot = Gen.Bulb, width = 27.49021, height = 20.13479, units = "cm", dpi = 300) #set your working directory with setwd()
```

```{r}
Init.Bulb <- grouped_ggbarstats(
  data = filter(Blanks_Main_lumped, Preservation !="Mes+Dist", Bulb.simpl_F %in% c("Diffuse","Not perceived", "Marked"),Technology.Phase_F == "Init" ), 
  x = Bulb.simpl_F,  
  y = Site_F, 
  grouping.var = Blank.type_F,
  xlab="Site",
  results.subtitle = FALSE,
  ggplot.component = list(
    scale_fill_manual(values =  Bulb_pal),  # Assign colors to values and set a single legend
    theme(
      plot.subtitle = element_text(size = 8, color = "black"),
      plot.caption = element_text(size = 8, color = "black"),
      axis.text = element_text(face = "bold", size = 8, color = "black", family = "Arial"),
      axis.text.y = element_text(face = "bold", size = 8, family = "Arial"),
      legend.title = element_blank(),  
      axis.ticks.x = element_blank(),
      strip.text = element_text(face = "bold", size = 8, family = "Arial")
    )))
Init.Bulb

ggsave("Init.Bulb.tiff", plot = Init.Bulb, width = 27.49021, height = 20.13479, units = "cm", dpi = 300) #set your working directory with setwd()
```

```{r}
MGMT.Bulb <- grouped_ggbarstats(
  data = filter(Blanks_Main_lumped, Preservation !="Mes+Dist", Bulb.simpl_F %in% c("Diffuse","Not perceived", "Marked"),Technology.Phase_F == "MGMT" ), 
  x = Bulb.simpl_F,  
  y = Site_F, 
  grouping.var = Blank.type_F,
  xlab="Site",
  results.subtitle = FALSE,
  ggplot.component = list(
    scale_fill_manual(values =  Bulb_pal),  # Assign colors to values and set a single legend
    theme(
      plot.subtitle = element_text(size = 8, color = "black"),
      plot.caption = element_text(size = 8, color = "black"),
      axis.text = element_text(face = "bold", size = 8, color = "black", family = "Arial"),
      axis.text.y = element_text(face = "bold", size = 8, family = "Arial"),
      legend.title = element_blank(),  
      axis.ticks.x = element_blank(),
      strip.text = element_text(face = "bold", size = 8, family = "Arial")
    )))
MGMT.Bulb

ggsave("MGMT.Bulb.tiff", plot = MGMT.Bulb, width = 27.49021, height = 20.13479, units = "cm", dpi = 300) #set your working directory with setwd()
```

```{r}
Ordinary.Bulb <- grouped_ggbarstats(
  data = filter(Blanks_Main_lumped, Preservation !="Mes+Dist", Bulb.simpl_F %in% c("Diffuse","Not perceived", "Marked"), Technology.Phase_F == "Ordinary" ), 
  x = Bulb.simpl_F,  
  y = Site_F, 
  grouping.var = Blank.type_F,
  xlab="Site",
  results.subtitle = FALSE,
  ggplot.component = list(
    scale_fill_manual(values =  Bulb_pal),  # Assign colors to values and set a single legend
    theme(
      plot.subtitle = element_text(size = 8, color = "black"),
      plot.caption = element_text(size = 8, color = "black"),
      axis.text = element_text(face = "bold", size = 8, color = "black", family = "Arial"),
      axis.text.y = element_text(face = "bold", size = 8, family = "Arial"),
      legend.title = element_blank(),  
      axis.ticks.x = element_blank(),
      strip.text = element_text(face = "bold", size = 8, family = "Arial")
    )))
Ordinary.Bulb

ggsave("Ordinary.Bulb.tiff", plot = Ordinary.Bulb, width = 27.49021, height = 20.13479, units = "cm", dpi = 300) #set your working directory with setwd()
```

###abrasion
```{r}
Blanks_Main_lumped$Abrasion.simpl_F <- factor(Blanks_Main_lumped$Abrasion.simpl, levels=c("Yes", "No", "ND")) 
library(RColorBrewer)
# Get unique values in the Platform.Simpl column
Abrasion_values <- unique(Blanks_Main_lumped$Abrasion.simpl_F)

# Use the ColorBrewer Set3 palette
color_palette <- brewer.pal(n = length(Abrasion_values), name = "Set3")

# Create a color dictionary mapping each unique value to a color
Abrasion_pal <- setNames(color_palette, Abrasion_values)
library(dplyr)
library(ggplot2)
library(ggstatsplot)
# Create grouped bar plot
Gen.Abrasion <- grouped_ggbarstats(
  data = filter(Blanks_Main_lumped, Blank.type_F != "Flake", Preservation !="Mes+Dist", Abrasion.simpl_F != "ND"), 
  x = Abrasion.simpl_F,  
  y = Site_F, 
  grouping.var = Blank.type_F,
  xlab="Site",
  results.subtitle = FALSE,
  ggplot.component = list(
    scale_fill_manual(values =  Abrasion_pal),  # Assign colors to values and set a single legend
    theme(
      plot.subtitle = element_text(size = 8, color = "black"),
      plot.caption = element_text(size = 8, color = "black"),
      axis.text = element_text(face = "bold", size = 8, color = "black", family = "Arial"),
      axis.text.y = element_text(face = "bold", size = 8, family = "Arial"),
      legend.title = element_blank(),  
      axis.ticks.x = element_blank(),
      strip.text = element_text(face = "bold", size = 8, family = "Arial")
    )))
Gen.Abrasion

ggsave("Gen.Abrasion.tiff", plot = Gen.Abrasion, width = 27.49021, height = 20.13479, units = "cm", dpi = 300) #set your working directory with setwd()
```

```{r}
Init.Abrasion <- grouped_ggbarstats(
  data = filter(Blanks_Main_lumped, Blank.type_F != "Flake", Preservation !="Mes+Dist", Abrasion.simpl_F != "ND", Technology.Phase_F == "Init" ), 
  x = Abrasion.simpl_F,  
  y = Site_F, 
  grouping.var = Blank.type_F,
  xlab="Site",
  results.subtitle = FALSE,
  ggplot.component = list(
    scale_fill_manual(values =  Abrasion_pal),  # Assign colors to values and set a single legend
    theme(
      plot.subtitle = element_text(size = 8, color = "black"),
      plot.caption = element_text(size = 8, color = "black"),
      axis.text = element_text(face = "bold", size = 8, color = "black", family = "Arial"),
      axis.text.y = element_text(face = "bold", size = 8, family = "Arial"),
      legend.title = element_blank(),  
      axis.ticks.x = element_blank(),
      strip.text = element_text(face = "bold", size = 8, family = "Arial")
    )))
Init.Abrasion

ggsave("Init.Abrasion.tiff", plot = Init.Abrasion, width = 27.49021, height = 20.13479, units = "cm", dpi = 300) #set your working directory with setwd()
```

```{r}
MGMT.Abrasion <- grouped_ggbarstats(
  data = filter(Blanks_Main_lumped, Blank.type_F != "Flake", Preservation !="Mes+Dist", Abrasion.simpl_F != "ND",  Technology.Phase_F == "MGMT" ), 
  x = Abrasion.simpl_F,  
  y = Site_F, 
  grouping.var = Blank.type_F,
  xlab="Site",
  results.subtitle = FALSE,
  ggplot.component = list(
    scale_fill_manual(values =  Abrasion_pal),  # Assign colors to values and set a single legend
    theme(
      plot.subtitle = element_text(size = 8, color = "black"),
      plot.caption = element_text(size = 8, color = "black"),
      axis.text = element_text(face = "bold", size = 8, color = "black", family = "Arial"),
      axis.text.y = element_text(face = "bold", size = 8, family = "Arial"),
      legend.title = element_blank(),  
      axis.ticks.x = element_blank(),
      strip.text = element_text(face = "bold", size = 8, family = "Arial")
    )))
MGMT.Abrasion

ggsave("MGMT.Abrasion.tiff", plot = MGMT.Abrasion, width = 27.49021, height = 20.13479, units = "cm", dpi = 300) #set your working directory with setwd()
```

```{r}
Ordinary.Abrasion <- grouped_ggbarstats(
  data = filter(Blanks_Main_lumped, Blank.type_F != "Flake", Preservation !="Mes+Dist", Abrasion.simpl_F != "ND", Technology.Phase_F == "Ordinary" ), 
  x = Abrasion.simpl_F,  
  y = Site_F, 
  grouping.var = Blank.type_F,
  xlab="Site",
  results.subtitle = FALSE,
  ggplot.component = list(
    scale_fill_manual(values =  Abrasion_pal),  # Assign colors to values and set a single legend
    theme(
      plot.subtitle = element_text(size = 8, color = "black"),
      plot.caption = element_text(size = 8, color = "black"),
      axis.text = element_text(face = "bold", size = 8, color = "black", family = "Arial"),
      axis.text.y = element_text(face = "bold", size = 8, family = "Arial"),
      legend.title = element_blank(),  
      axis.ticks.x = element_blank(),
      strip.text = element_text(face = "bold", size = 8, family = "Arial")
    )))
Ordinary.Abrasion

ggsave("Ordinary.Abrasion.tiff", plot = Ordinary.Abrasion, width = 27.49021, height = 20.13479, units = "cm", dpi = 300) #set your working directory with setwd()
```

###axiality and outline 
```{r}
Blanks_Main_lumped$Axiality.simpl_F <- factor(Blanks_Main_lumped$Axiality.simpl, levels=c("Off axis", "On axis")) 
library(RColorBrewer)
# Get unique values in the Platform.Simpl column
Axiality.simpl_values <- unique(Blanks_Main_lumped$Axiality.simpl_F)

# Use the ColorBrewer Set3 palette
color_palette <- brewer.pal(n = length(Axiality.simpl_values), name = "Set3")

# Create a color dictionary mapping each unique value to a color
Axiality.simpl_pal <- setNames(color_palette, Axiality.simpl_values)

library(dplyr)
library(ggplot2)
library(ggstatsplot)
# Create grouped bar plot
Gen.Ax <- grouped_ggbarstats(
  data = filter(Blanks_Main_lumped, Blank.type_F !="Flake", Preservation != "Prox+Mes", Axiality.simpl_F != "ND" & Axiality.simpl_F != "NA"), 
  x = Axiality.simpl_F,  
  y = Site_F, 
  grouping.var = Blank.type_F,
  xlab="Site",
  results.subtitle = FALSE,
  ggplot.component = list(
    scale_fill_manual(values =  Axiality.simpl_pal),  # Assign colors to values and set a single legend
    theme(
      plot.subtitle = element_text(size = 8, color = "black"),
      plot.caption = element_text(size = 8, color = "black"),
      axis.text = element_text(face = "bold", size = 8, color = "black", family = "Arial"),
      axis.text.y = element_text(face = "bold", size = 8, family = "Arial"),
      legend.title = element_blank(),  
      axis.ticks.x = element_blank(),
      strip.text = element_text(face = "bold", size = 8, family = "Arial")
    )))
Gen.Ax

ggsave("Gen.Axiality.tiff", plot = Gen.Ax, width = 27.49021, height = 20.13479, units = "cm", dpi = 300) #set your working directory with setwd()
```

```{r}
Init.Ax <- grouped_ggbarstats(
  data = filter(Blanks_Main_lumped, Blank.type_F !="Flake", Preservation != "Prox+Mes", Axiality.simpl_F != "ND" & Axiality.simpl_F != "NA", Technology.Phase_F == "Init"), 
  x = Axiality.simpl_F,  
  y = Site_F, 
  grouping.var = Blank.type_F,
  xlab="Site",
  results.subtitle = FALSE,
  ggplot.component = list(
    scale_fill_manual(values =  Axiality.simpl_pal),  # Assign colors to values and set a single legend
    theme(
      plot.subtitle = element_text(size = 8, color = "black"),
      plot.caption = element_text(size = 8, color = "black"),
      axis.text = element_text(face = "bold", size = 8, color = "black", family = "Arial"),
      axis.text.y = element_text(face = "bold", size = 8, family = "Arial"),
      legend.title = element_blank(),  
      axis.ticks.x = element_blank(),
      strip.text = element_text(face = "bold", size = 8, family = "Arial")
    )))
Init.Ax

ggsave("Init.Axiality.tiff", plot = Init.Ax, width = 27.49021, height = 20.13479, units = "cm", dpi = 300) #set your working directory with setwd()
```

```{r}
MGMT.Ax <- grouped_ggbarstats(
  data = filter(Blanks_Main_lumped, Blank.type_F !="Flake", Preservation != "Prox+Mes", Axiality.simpl_F != "ND" & Axiality.simpl_F != "NA", Technology.Phase_F == "MGMT"), 
  x = Axiality.simpl_F,  
  y = Site_F, 
  grouping.var = Blank.type_F,
  xlab="Site",
  results.subtitle = FALSE,
  ggplot.component = list(
    scale_fill_manual(values =  Axiality.simpl_pal),  # Assign colors to values and set a single legend
    theme(
      plot.subtitle = element_text(size = 8, color = "black"),
      plot.caption = element_text(size = 8, color = "black"),
      axis.text = element_text(face = "bold", size = 8, color = "black", family = "Arial"),
      axis.text.y = element_text(face = "bold", size = 8, family = "Arial"),
      legend.title = element_blank(),  
      axis.ticks.x = element_blank(),
      strip.text = element_text(face = "bold", size = 8, family = "Arial")
    )))
MGMT.Ax

ggsave("MGMT.Axiality.tiff", plot = MGMT.Ax, width = 27.49021, height = 20.13479, units = "cm", dpi = 300) #set your working directory with setwd()
```

```{r}
Ordinary.Ax <- grouped_ggbarstats(
  data = filter(Blanks_Main_lumped, Blank.type_F !="Flake", Preservation != "Prox+Mes", Axiality.simpl_F != "ND" & Axiality.simpl_F != "NA", Technology.Phase_F == "Ordinary"), 
  x = Axiality.simpl_F,  
  y = Site_F, 
  grouping.var = Blank.type_F,
  xlab="Site",
  results.subtitle = FALSE,
  ggplot.component = list(
    scale_fill_manual(values =  Axiality.simpl_pal),  # Assign colors to values and set a single legend
    theme(
      plot.subtitle = element_text(size = 8, color = "black"),
      plot.caption = element_text(size = 8, color = "black"),
      axis.text = element_text(face = "bold", size = 8, color = "black", family = "Arial"),
      axis.text.y = element_text(face = "bold", size = 8, family = "Arial"),
      legend.title = element_blank(),  
      axis.ticks.x = element_blank(),
      strip.text = element_text(face = "bold", size = 8, family = "Arial")
    )))
Ordinary.Ax

ggsave("Ordinary.Axiality.tiff", plot = Ordinary.Ax, width = 27.49021, height = 20.13479, units = "cm", dpi = 300) #set your working directory with setwd()

```

```{r}
Blanks_Main_lumped$Outline.morphology_F <- factor(Blanks_Main_lumped$Outline.morphology, levels=c("Subparallel edges", "Convergent", "Déjète", "ND", "Other")) 
library(RColorBrewer)
# Get unique values in the Platform.Simpl column
Out.Morph_values <- unique(Blanks_Main_lumped$Outline.morphology_F)

# Use the ColorBrewer Set3 palette
color_palette <- brewer.pal(n = length(Out.Morph_values), name = "Set3")

# Create a color dictionary mapping each unique value to a color
Out.Morph_pal <- setNames(color_palette, Out.Morph_values)

library(dplyr)
library(ggplot2)
library(ggstatsplot)
# Create grouped bar plot
Gen.Out.Morph <- grouped_ggbarstats(
  data = filter(Blanks_Main_lumped, Blank.type_F !="Flake", Preservation != "Prox+Mes", Outline.morphology_F != "ND" & Outline.morphology_F != "Other"), 
  x = Outline.morphology_F,  
  y = Site_F, 
  grouping.var = Blank.type_F,
  xlab="Site",
  results.subtitle = FALSE,
  ggplot.component = list(
    scale_fill_manual(values =  Out.Morph_pal),  # Assign colors to values and set a single legend
    theme(
      plot.subtitle = element_text(size = 8, color = "black"),
      plot.caption = element_text(size = 8, color = "black"),
      axis.text = element_text(face = "bold", size = 8, color = "black", family = "Arial"),
      axis.text.y = element_text(face = "bold", size = 8, family = "Arial"),
      legend.title = element_blank(),  
      axis.ticks.x = element_blank(),
      strip.text = element_text(face = "bold", size = 8, family = "Arial")
    )))
Gen.Out.Morph

ggsave("Gen.Out.Morph.tiff", plot = Gen.Out.Morph, width = 27.49021, height = 20.13479, units = "cm", dpi = 300) #set your working directory with setwd()
```

```{r}
Init.Out.Morph <- grouped_ggbarstats(
  data = filter(Blanks_Main_lumped, Blank.type_F !="Flake", Preservation != "Prox+Mes", Outline.morphology_F != "ND" & Outline.morphology_F != "Other", Technology.Phase_F == "Init"), 
  x = Outline.morphology_F,  
  y = Site_F, 
  grouping.var = Blank.type_F,
  xlab="Site",
  results.subtitle = FALSE,
  ggplot.component = list(
    scale_fill_manual(values =  Out.Morph_pal),  # Assign colors to values and set a single legend
    theme(
      plot.subtitle = element_text(size = 8, color = "black"),
      plot.caption = element_text(size = 8, color = "black"),
      axis.text = element_text(face = "bold", size = 8, color = "black", family = "Arial"),
      axis.text.y = element_text(face = "bold", size = 8, family = "Arial"),
      legend.title = element_blank(),  
      axis.ticks.x = element_blank(),
      strip.text = element_text(face = "bold", size = 8, family = "Arial")
    )))
Init.Out.Morph

ggsave("Init.Out.Morph.tiff", plot = Init.Out.Morph, width = 27.49021, height = 20.13479, units = "cm", dpi = 300) #set your working directory with setwd()
```

```{r}
MGMT.Out.Morph <- grouped_ggbarstats(
  data = filter(Blanks_Main_lumped, Blank.type_F !="Flake", Preservation != "Prox+Mes", Outline.morphology_F != "ND" & Outline.morphology_F != "Other", Technology.Phase_F == "MGMT"), 
  x = Outline.morphology_F,  
  y = Site_F, 
  grouping.var = Blank.type_F,
  results.subtitle = FALSE,
  xlab="Site",
  ggplot.component = list(
    scale_fill_manual(values =  Out.Morph_pal),  # Assign colors to values and set a single legend
    theme(
      plot.subtitle = element_text(size = 8, color = "black"),
      plot.caption = element_text(size = 8, color = "black"),
      axis.text = element_text(face = "bold", size = 8, color = "black", family = "Arial"),
      axis.text.y = element_text(face = "bold", size = 8, family = "Arial"),
      legend.title = element_blank(),  
      axis.ticks.x = element_blank(),
      strip.text = element_text(face = "bold", size = 8, family = "Arial")
    )))
MGMT.Out.Morph

ggsave("MGMT.Out.Morph.tiff", plot = MGMT.Out.Morph, width = 27.49021, height = 20.13479, units = "cm", dpi = 300) #set your working directory with setwd()
```

```{r}
Ordinary.Out.Morph <- grouped_ggbarstats(
  data = filter(Blanks_Main_lumped, Blank.type_F !="Flake", Preservation != "Prox+Mes", Outline.morphology_F != "ND" & Outline.morphology_F != "Other", Technology.Phase_F == "Ordinary"), 
  x = Outline.morphology_F,  
  y = Site_F, 
  grouping.var = Blank.type_F,
  results.subtitle = FALSE,
  xlab="Site",
  ggplot.component = list(
    scale_fill_manual(values =  Out.Morph_pal),  # Assign colors to values and set a single legend
    theme(
      plot.subtitle = element_text(size = 8, color = "black"),
      plot.caption = element_text(size = 8, color = "black"),
      axis.text = element_text(face = "bold", size = 8, color = "black", family = "Arial"),
      axis.text.y = element_text(face = "bold", size = 8, family = "Arial"),
      legend.title = element_blank(),  
      axis.ticks.x = element_blank(),
      strip.text = element_text(face = "bold", size = 8, family = "Arial")
    )))
Ordinary.Out.Morph

ggsave("Ordinary.Out.Morph.tiff", plot = Ordinary.Out.Morph, width = 27.49021, height = 20.13479, units = "cm", dpi = 300) #set your working directory with setwd()
```

###Symmetry
```{r}
Blanks_Main_lumped$Symmetry_F <- factor(Blanks_Main_lumped$Symmetry, levels=c("symmetric", "asymmetric", "ND"))
library(RColorBrewer)
# Get unique values in the Platform.Simpl column
Symmetry_values <- unique(Blanks_Main_lumped$Symmetry_F)

# Use the ColorBrewer Set3 palette
color_palette <- brewer.pal(n = length(Symmetry_values), name = "Set3")

# Create a color dictionary mapping each unique value to a color
Symmetry_pal <- setNames(color_palette,Symmetry_values)
library(dplyr)
library(ggplot2)
library(ggstatsplot)
# Create grouped bar plot
Gen.Symmetry <- grouped_ggbarstats(
  data = filter(Blanks_Main_lumped, Blank.type_F !="Flake", Symmetry_F != "ND"), 
  x = Symmetry_F,  
  y = Site_F, 
  grouping.var = Blank.type_F,
  xlab="Site",
  results.subtitle = FALSE,
  ggplot.component = list(
    scale_fill_manual(values =  Symmetry_pal),  # Assign colors to values and set a single legend
    theme(
      plot.subtitle = element_text(size = 8, color = "black"),
      plot.caption = element_text(size = 8, color = "black"),
      axis.text = element_text(face = "bold", size = 8, color = "black", family = "Arial"),
      axis.text.y = element_text(face = "bold", size = 8, family = "Arial"),
      legend.title = element_blank(),  
      axis.ticks.x = element_blank(),
      strip.text = element_text(face = "bold", size = 8, family = "Arial")
    )))
Gen.Symmetry

ggsave("Gen.Symmetry.tiff", plot = Gen.Symmetry, width = 27.49021, height = 20.13479, units = "cm", dpi = 300) #set your working directory with setwd()
```


```{r}
Init.Symmetry <- grouped_ggbarstats(
  data = filter(Blanks_Main_lumped, Blank.type_F !="Flake", Symmetry_F != "ND", Technology.Phase_F == "Init"), 
  x = Symmetry_F,  
  y = Site_F, 
  grouping.var = Blank.type_F,
  results.subtitle = FALSE,
  xlab="Site",
  ggplot.component = list(
    scale_fill_manual(values =  Symmetry_pal),  # Assign colors to values and set a single legend
    theme(
      plot.subtitle = element_text(size = 8, color = "black"),
      plot.caption = element_text(size = 8, color = "black"),
      axis.text = element_text(face = "bold", size = 8, color = "black", family = "Arial"),
      axis.text.y = element_text(face = "bold", size = 8, family = "Arial"),
      legend.title = element_blank(),  
      axis.ticks.x = element_blank(),
      strip.text = element_text(face = "bold", size = 8, family = "Arial")
    )))
Init.Symmetry

ggsave("Init.Symmetry.tiff", plot = Init.Symmetry, width = 27.49021, height = 20.13479, units = "cm", dpi = 300) #set your working directory with setwd()
```


```{r}
MGMT.Symmetry <- grouped_ggbarstats(
  data = filter(Blanks_Main_lumped, Blank.type_F !="Flake", Symmetry_F != "ND", Technology.Phase_F == "MGMT"), 
  x = Symmetry_F,  
  y = Site_F, 
  grouping.var = Blank.type_F,
  xlab="Site",
  results.subtitle = FALSE,
  ggplot.component = list(
    scale_fill_manual(values =  Symmetry_pal),  # Assign colors to values and set a single legend
    theme(
      plot.subtitle = element_text(size = 8, color = "black"),
      plot.caption = element_text(size = 8, color = "black"),
      axis.text = element_text(face = "bold", size = 8, color = "black", family = "Arial"),
      axis.text.y = element_text(face = "bold", size = 8, family = "Arial"),
      legend.title = element_blank(),  
      axis.ticks.x = element_blank(),
      strip.text = element_text(face = "bold", size = 8, family = "Arial")
    )))
MGMT.Symmetry

ggsave("MGMT.Symmetry.tiff", plot = MGMT.Symmetry, width = 27.49021, height = 20.13479, units = "cm", dpi = 300) #set your working directory with setwd()
```

```{r}
Ordinary.Symmetry <- grouped_ggbarstats(
  data = filter(Blanks_Main_lumped, Blank.type_F !="Flake", Symmetry_F != "ND", Technology.Phase_F == "Ordinary"), 
  x = Symmetry_F,  
  y = Site_F, 
  grouping.var = Blank.type_F,
  xlab="Site",
  results.subtitle = FALSE,
  ggplot.component = list(
    scale_fill_manual(values =  Symmetry_pal),  # Assign colors to values and set a single legend
    theme(
      plot.subtitle = element_text(size = 8, color = "black"),
      plot.caption = element_text(size = 8, color = "black"),
      axis.text = element_text(face = "bold", size = 8, color = "black", family = "Arial"),
      axis.text.y = element_text(face = "bold", size = 8, family = "Arial"),
      legend.title = element_blank(),  
      axis.ticks.x = element_blank(),
      strip.text = element_text(face = "bold", size = 8, family = "Arial")
    )))
Ordinary.Symmetry

ggsave("Ordinary.Symmetry.tiff", plot = Ordinary.Symmetry, width = 27.49021, height = 20.13479, units = "cm", dpi = 300) #set your working directory with setwd()
```
###crosssection shape
```{r}
Blanks_Main_lumped$Cross.section_F <- factor(Blanks_Main_lumped$Cross.section, levels=c("Triangular", "Polyhedric" ,"Flat", "ND"))

library(RColorBrewer)
# Get unique values in the Platform.Simpl column
Cross.Section_values <- unique(Blanks_Main_lumped$Cross.section_F)

# Use the ColorBrewer Set3 palette
color_palette <- brewer.pal(n = length(Cross.Section_values), name = "Set3")

# Create a color dictionary mapping each unique value to a color
Cross.Section_pal <- setNames(color_palette,Cross.Section_values)

library(dplyr)
library(ggplot2)
library(ggstatsplot)
# Create grouped bar plot
Gen.Cross.Section <- grouped_ggbarstats(
  data = filter(Blanks_Main_lumped, Blank.type_F !="Flake", Cross.section_F !="ND"), 
  x = Cross.section_F,  
  y = Site_F, 
  grouping.var = Blank.type_F,
  xlab="Site",
  results.subtitle = FALSE,
  ggplot.component = list(
    scale_fill_manual(values =  Cross.Section_pal),  # Assign colors to values and set a single legend
    theme(
      plot.subtitle = element_text(size = 8, color = "black"),
      plot.caption = element_text(size = 8, color = "black"),
      axis.text = element_text(face = "bold", size = 8, color = "black", family = "Arial"),
      axis.text.y = element_text(face = "bold", size = 8, family = "Arial"),
      legend.title = element_blank(),  
      axis.ticks.x = element_blank(),
      strip.text = element_text(face = "bold", size = 8, family = "Arial")
    )))
Gen.Cross.Section

ggsave("Gen.Cross.Section.tiff", plot = Gen.Cross.Section, width = 27.49021, height = 20.13479, units = "cm", dpi = 300) #set your working directory with setwd()
```

```{r}
Init.Cross.Section <- grouped_ggbarstats(
  data = filter(Blanks_Main_lumped, Blank.type_F !="Flake", Cross.section_F !="ND", Technology.Phase_F == "Init" ), 
  x = Cross.section_F,  
  y = Site_F, 
  grouping.var = Blank.type_F,
  xlab="Site",
  results.subtitle = FALSE,
  ggplot.component = list(
    scale_fill_manual(values =  Cross.Section_pal),  # Assign colors to values and set a single legend
    theme(
      plot.subtitle = element_text(size = 8, color = "black"),
      plot.caption = element_text(size = 8, color = "black"),
      axis.text = element_text(face = "bold", size = 8, color = "black", family = "Arial"),
      axis.text.y = element_text(face = "bold", size = 8, family = "Arial"),
      legend.title = element_blank(),  
      axis.ticks.x = element_blank(),
      strip.text = element_text(face = "bold", size = 8, family = "Arial")
    )))
Init.Cross.Section

ggsave("Init.Cross.Section.tiff", plot = Init.Cross.Section, width = 27.49021, height = 20.13479, units = "cm", dpi = 300) #set your working directory with setwd()
```

```{r}
MGMT.Cross.Section <- grouped_ggbarstats(
  data = filter(Blanks_Main_lumped, Blank.type_F !="Flake", Cross.section_F !="ND", Technology.Phase_F == "MGMT" ), 
  x = Cross.section_F,  
  y = Site_F, 
  grouping.var = Blank.type_F,
  xlab="Site",
  results.subtitle = FALSE,
  ggplot.component = list(
    scale_fill_manual(values =  Cross.Section_pal),  # Assign colors to values and set a single legend
    theme(
      plot.subtitle = element_text(size = 8, color = "black"),
      plot.caption = element_text(size = 8, color = "black"),
      axis.text = element_text(face = "bold", size = 8, color = "black", family = "Arial"),
      axis.text.y = element_text(face = "bold", size = 8, family = "Arial"),
      legend.title = element_blank(),  
      axis.ticks.x = element_blank(),
      strip.text = element_text(face = "bold", size = 8, family = "Arial")
    )))
MGMT.Cross.Section

ggsave("MGMT.Cross.Section.tiff", plot = MGMT.Cross.Section, width = 27.49021, height = 20.13479, units = "cm", dpi = 300) #set your working directory with setwd()
```


```{r}
Ordinary.Cross.Section <- grouped_ggbarstats(
  data = filter(Blanks_Main_lumped, Blank.type_F !="Flake", Cross.section_F !="ND", Technology.Phase_F == "Ordinary" ), 
  x = Cross.section_F,  
  y = Site_F, 
  grouping.var = Blank.type_F,
  xlab="Site",
  results.subtitle = FALSE,
  ggplot.component = list(
    scale_fill_manual(values =  Cross.Section_pal),  # Assign colors to values and set a single legend
    theme(
      plot.subtitle = element_text(size = 8, color = "black"),
      plot.caption = element_text(size = 8, color = "black"),
      axis.text = element_text(face = "bold", size = 8, color = "black", family = "Arial"),
      axis.text.y = element_text(face = "bold", size = 8, family = "Arial"),
      legend.title = element_blank(),  
      axis.ticks.x = element_blank(),
      strip.text = element_text(face = "bold", size = 8, family = "Arial")
    )))
Ordinary.Cross.Section

ggsave("Ordinary.Cross.Section.tiff", plot = Ordinary.Cross.Section, width = 27.49021, height = 20.13479, units = "cm", dpi = 300) #set your working directory with setwd()
```
###profile
```{r}
Blanks_Main_lumped$Profile_F <- factor(Blanks_Main_lumped$Profile, levels=c("Straight", "Slightly Curved","Curved","Very Curved","Twisted","ND"))
library(RColorBrewer)
# Get unique values in the Platform.Simpl column
Profile_values <- unique(Blanks_Main_lumped$Profile_F)

# Use the ColorBrewer Set3 palette
color_palette <- brewer.pal(n = length(Profile_values), name = "Set3")

# Create a color dictionary mapping each unique value to a color
Profile_pal <- setNames(color_palette,Profile_values)
library(dplyr)
library(ggplot2)
library(ggstatsplot)
# Create grouped bar plot
Gen.Profile <- grouped_ggbarstats(
  data = filter(Blanks_Main_lumped, Blank.type_F !="Flake", Profile_F !="ND"), 
  x = Profile_F,  
  y = Site_F, 
  grouping.var = Blank.type_F,
  results.subtitle = FALSE,
  ggplot.component = list(
    scale_fill_manual(values =  Profile_pal),  # Assign colors to values and set a single legend
    theme(
      plot.subtitle = element_text(size = 8, color = "black"),
      plot.caption = element_text(size = 8, color = "black"),
      axis.text = element_text(face = "bold", size = 8, color = "black", family = "Arial"),
      axis.text.y = element_text(face = "bold", size = 8, family = "Arial"),
      legend.title = element_blank(),  
      axis.ticks.x = element_blank(),
      strip.text = element_text(face = "bold", size = 8, family = "Arial")
    )))
Gen.Profile

ggsave("Gen.Profile.tiff", plot = Gen.Profile, width = 27.49021, height = 20.13479, units = "cm", dpi = 300) #set your working directory with setwd()
```

```{r}
Init.Profile <- grouped_ggbarstats(
  data = filter(Blanks_Main_lumped, Blank.type_F !="Flake", Profile_F !="ND", Technology.Phase_F == "Init"), 
  x = Profile_F,  
  y = Site_F, 
  grouping.var = Blank.type_F,
  results.subtitle = FALSE,
  ggplot.component = list(
    scale_fill_manual(values =  Profile_pal),  # Assign colors to values and set a single legend
    theme(
      plot.subtitle = element_text(size = 8, color = "black"),
      plot.caption = element_text(size = 8, color = "black"),
      axis.text = element_text(face = "bold", size = 8, color = "black", family = "Arial"),
      axis.text.y = element_text(face = "bold", size = 8, family = "Arial"),
      legend.title = element_blank(),  
      axis.ticks.x = element_blank(),
      strip.text = element_text(face = "bold", size = 8, family = "Arial")
    )))
Init.Profile

ggsave("Init.Profile.tiff", plot = Init.Profile, width = 27.49021, height = 20.13479, units = "cm", dpi = 300) #set your working directory with setwd()
```

```{r}
MGMT.Profile <- grouped_ggbarstats(
  data = filter(Blanks_Main_lumped, Blank.type_F !="Flake", Profile_F !="ND", Technology.Phase_F == "MGMT"), 
  x = Profile_F,  
  y = Site_F, 
  grouping.var = Blank.type_F,
  results.subtitle = FALSE,
  ggplot.component = list(
    scale_fill_manual(values =  Profile_pal),  # Assign colors to values and set a single legend
    theme(
      plot.subtitle = element_text(size = 8, color = "black"),
      plot.caption = element_text(size = 8, color = "black"),
      axis.text = element_text(face = "bold", size = 8, color = "black", family = "Arial"),
      axis.text.y = element_text(face = "bold", size = 8, family = "Arial"),
      legend.title = element_blank(),  
      axis.ticks.x = element_blank(),
      strip.text = element_text(face = "bold", size = 8, family = "Arial")
    )))
MGMT.Profile

ggsave("MGMT.Profile.tiff", plot = MGMT.Profile, width = 27.49021, height = 20.13479, units = "cm", dpi = 300) #set your working directory with setwd()
```

```{r}
Ordinary.Profile <- grouped_ggbarstats(
  data = filter(Blanks_Main_lumped, Blank.type_F !="Flake", Profile_F !="ND", Technology.Phase_F == "Ordinary"), 
  x = Profile_F,  
  y = Site_F, 
  grouping.var = Blank.type_F,
  results.subtitle = FALSE,
  ggplot.component = list(
    scale_fill_manual(values =  Profile_pal),  # Assign colors to values and set a single legend
    theme(
      plot.subtitle = element_text(size = 8, color = "black"),
      plot.caption = element_text(size = 8, color = "black"),
      axis.text = element_text(face = "bold", size = 8, color = "black", family = "Arial"),
      axis.text.y = element_text(face = "bold", size = 8, family = "Arial"),
      legend.title = element_blank(),  
      axis.ticks.x = element_blank(),
      strip.text = element_text(face = "bold", size = 8, family = "Arial")
    )))
Ordinary.Profile

ggsave("Ordinary.Profile.tiff", plot = Ordinary.Profile, width = 27.49021, height = 20.13479, units = "cm", dpi = 300) #set your working directory with setwd()
```

### distal end morphology
```{r}
Blanks_Main_lumped$Distal.end.morpho_F <- factor(Blanks_Main_lumped$Distal.end.morpho, levels=c("Feathered","Stepped", "Hinged", "Plunging", "ND"))
library(RColorBrewer)
# Get unique values in the Platform.Simpl column
Distal.end.morpho_values <- unique(Blanks_Main_lumped$Distal.end.morpho_F)

# Use the ColorBrewer Set3 palette
color_palette <- brewer.pal(n = length(Distal.end.morpho_values), name = "Set3")

# Create a color dictionary mapping each unique value to a color
Distal.end.morpho_pal <- setNames(color_palette,Distal.end.morpho_values)

library(dplyr)
library(ggplot2)
library(ggstatsplot)
# Create grouped bar plot
Gen.Distal.end.morpho <- grouped_ggbarstats(
  data = filter(Blanks_Main_lumped, Blank.type_F !="Flake",Distal.end.morpho_F != "ND", Preservation != "Prox+Mes"), 
  x = Distal.end.morpho_F,  
  y = Site_F, 
  grouping.var = Blank.type_F,
  results.subtitle = FALSE,
  ggplot.component = list(
    scale_fill_manual(values =  Distal.end.morpho_pal),  # Assign colors to values and set a single legend
    theme(
      plot.subtitle = element_text(size = 8, color = "black"),
      plot.caption = element_text(size = 8, color = "black"),
      axis.text = element_text(face = "bold", size = 8, color = "black", family = "Arial"),
      axis.text.y = element_text(face = "bold", size = 8, family = "Arial"),
      legend.title = element_blank(),  
      axis.ticks.x = element_blank(),
      strip.text = element_text(face = "bold", size = 8, family = "Arial")
    )))
Gen.Distal.end.morpho

ggsave("Gen.Distal.end.morpho.tiff", plot = Gen.Distal.end.morpho, width = 27.49021, height = 20.13479, units = "cm", dpi = 300) #set your working directory with setwd()
```

```{r}
Init.Distal.end.morpho <- grouped_ggbarstats(
  data = filter(Blanks_Main_lumped, Blank.type_F !="Flake",Distal.end.morpho_F != "ND", Preservation != "Prox+Mes", Technology.Phase_F =="Init"), 
  x = Distal.end.morpho_F,  
  y = Site_F, 
  grouping.var = Blank.type_F,
  results.subtitle = FALSE,
  ggplot.component = list(
    scale_fill_manual(values =  Distal.end.morpho_pal),  # Assign colors to values and set a single legend
    theme(
      plot.subtitle = element_text(size = 8, color = "black"),
      plot.caption = element_text(size = 8, color = "black"),
      axis.text = element_text(face = "bold", size = 8, color = "black", family = "Arial"),
      axis.text.y = element_text(face = "bold", size = 8, family = "Arial"),
      legend.title = element_blank(),  
      axis.ticks.x = element_blank(),
      strip.text = element_text(face = "bold", size = 8, family = "Arial")
    )))
Init.Distal.end.morpho

ggsave("Init.Distal.end.morpho.tiff", plot = Init.Distal.end.morpho, width = 27.49021, height = 20.13479, units = "cm", dpi = 300) #set your working directory with setwd()
```

```{r}
MGMT.Distal.end.morpho <- grouped_ggbarstats(
  data = filter(Blanks_Main_lumped, Blank.type_F !="Flake",Distal.end.morpho_F != "ND", Preservation != "Prox+Mes", Technology.Phase_F =="MGMT"), 
  x = Distal.end.morpho_F,  
  y = Site_F, 
  grouping.var = Blank.type_F,
  results.subtitle = FALSE,
  ggplot.component = list(
    scale_fill_manual(values =  Distal.end.morpho_pal),  # Assign colors to values and set a single legend
    theme(
      plot.subtitle = element_text(size = 8, color = "black"),
      plot.caption = element_text(size = 8, color = "black"),
      axis.text = element_text(face = "bold", size = 8, color = "black", family = "Arial"),
      axis.text.y = element_text(face = "bold", size = 8, family = "Arial"),
      legend.title = element_blank(),  
      axis.ticks.x = element_blank(),
      strip.text = element_text(face = "bold", size = 8, family = "Arial")
    )))
MGMT.Distal.end.morpho

ggsave("MGMT.Distal.end.morpho.tiff", plot = MGMT.Distal.end.morpho, width = 27.49021, height = 20.13479, units = "cm", dpi = 300) #set your working directory with setwd()
```

```{r}
Ordinary.Distal.end.morpho <- grouped_ggbarstats(
  data = filter(Blanks_Main_lumped, Blank.type_F !="Flake",Distal.end.morpho_F != "ND", Preservation != "Prox+Mes", Technology.Phase_F =="Ordinary"), 
  x = Distal.end.morpho_F,  
  y = Site_F, 
  grouping.var = Blank.type_F,
  results.subtitle = FALSE,
  ggplot.component = list(
    scale_fill_manual(values =  Distal.end.morpho_pal),  # Assign colors to values and set a single legend
    theme(
      plot.subtitle = element_text(size = 8, color = "black"),
      plot.caption = element_text(size = 8, color = "black"),
      axis.text = element_text(face = "bold", size = 8, color = "black", family = "Arial"),
      axis.text.y = element_text(face = "bold", size = 8, family = "Arial"),
      legend.title = element_blank(),  
      axis.ticks.x = element_blank(),
      strip.text = element_text(face = "bold", size = 8, family = "Arial")
    )))
Ordinary.Distal.end.morpho

ggsave("Ordinary.Distal.end.morpho.tiff", plot = Ordinary.Distal.end.morpho, width = 27.49021, height = 20.13479, units = "cm", dpi = 300) #set your working directory with setwd()
```
###torsion
```{r}
library(RColorBrewer)
# Get unique values in the Torsion column
Torsion_values <- unique(Blanks_Main_lumped$Torsion)

# Use the ColorBrewer Set3 palette
color_palette <- brewer.pal(n = length(Torsion_values), name = "Set3")

# Create a color dictionary mapping each unique value to a color
Torsion_pal <- setNames(color_palette, Torsion_values)

library(dplyr)
library(ggplot2)
library(ggstatsplot)
Gen.Torsion <- grouped_ggbarstats(
  data = filter(Blanks_Main_lumped, Blank.type_F !="Flake", Torsion !="ND"), 
  x = Torsion,  
  y = Site_F, 
  grouping.var = Blank.type_F,
  results.subtitle = TRUE,
  ggplot.component = list(
    scale_fill_manual(values =  Torsion_pal),  # Assign colors to values and set a single legend
    theme(
      plot.subtitle = element_text(size = 8, color = "black"),
      plot.caption = element_text(size = 8, color = "black"),
      axis.text = element_text(face = "bold", size = 8, color = "black", family = "Arial"),
      axis.text.y = element_text(face = "bold", size = 8, family = "Arial"),
      legend.title = element_blank(),  
      axis.ticks.x = element_blank(),
      strip.text = element_text(face = "bold", size = 8, family = "Arial")
    )))
Gen.Torsion

ggsave("Gen.Torsion.tiff", plot = Gen.Torsion, width = 27.49021, height = 20.13479, units = "cm", dpi = 300) #set your working directory with setwd()
```

###dorsal scar pattern
```{r}


Blanks_Main_lumped$Dorsal.scar.1_F <- factor(Blanks_Main_lumped$Dorsal.scar.1, levels=c( "Unidirectional", "Crossed","Bidirectional","Centripetal","Other", "ND"))
library(RColorBrewer)
# Get unique values in the Platform.Simpl column
Dorsal.scar.1_values <- unique(Blanks_Main_lumped$Dorsal.scar.1_F)

# Use the ColorBrewer Set3 palette
color_palette <- brewer.pal(n = length(Dorsal.scar.1_values), name = "Set3")

# Create a color dictionary mapping each unique value to a color
Dorsal.scar.1_pal <- setNames(color_palette, Dorsal.scar.1_values)
library(dplyr)
library(ggplot2)
library(ggstatsplot)
# Create grouped bar plot
Gen.Dorsal.scar.1 <- grouped_ggbarstats(
  data = filter(Blanks_Main_lumped, Dorsal.scar.1_F != "ND", Dorsal.scar.1_F != "No negatives", Dorsal.scar.1_F != "Other"), 
  x = Dorsal.scar.1_F,  
  y = Site_F, 
  grouping.var = Blank.type_F,
  results.subtitle = FALSE,
  ggplot.component = list(
    scale_fill_manual(values = Dorsal.scar.1_pal),  # Assign colors to values and set a single legend
    theme(
      plot.subtitle = element_text(size = 8, color = "black"),
      plot.caption = element_text(size = 8, color = "black"),
      axis.text = element_text(face = "bold", size = 8, color = "black", family = "Arial"),
      axis.text.y = element_text(face = "bold", size = 8, family = "Arial"),
      legend.title = element_blank(),  
      axis.ticks.x = element_blank(),
      strip.text = element_text(face = "bold", size = 8, family = "Arial")
    )))
Gen.Dorsal.scar.1

ggsave("Gen.Dorsal.scar.1.tiff", plot = Gen.Dorsal.scar.1, width = 27.49021, height = 20.13479, units = "cm", dpi = 300) #set your working directory with setwd()
```


```{r}


Init.Dorsal.scar.1 <- grouped_ggbarstats(
  data = filter(Blanks_Main_lumped, Dorsal.scar.1_F != "ND", Dorsal.scar.1_F != "No negatives", Dorsal.scar.1_F != "Other", Technology.Phase_F == "Init"),
  x = Dorsal.scar.1_F,  
  y = Site_F, 
  grouping.var = Blank.type_F,
  xlab="Site",
  results.subtitle = FALSE,
  ggplot.component = list(
    scale_fill_manual(values =  Dorsal.scar.1_pal),  # Assign colors to values and set a single legend
    theme(
      plot.subtitle = element_text(size = 8, color = "black"),
      plot.caption = element_text(size = 8, color = "black"),
      axis.text = element_text(face = "bold", size = 8, color = "black", family = "Arial"),
      axis.text.y = element_text(face = "bold", size = 8, family = "Arial"),
      legend.title = element_blank(),  
      axis.ticks.x = element_blank(),
      strip.text = element_text(face = "bold", size = 8, family = "Arial")
    )))
Init.Dorsal.scar.1

ggsave("Init.Dorsal.scar.1.tiff", plot = Init.Dorsal.scar.1, width = 27.49021, height = 20.13479, units = "cm", dpi = 300) #set your working directory with setwd()
```

```{r}


MGMT.Dorsal.scar.1 <- grouped_ggbarstats(
  data = filter(Blanks_Main_lumped, Dorsal.scar.1_F != "ND", Dorsal.scar.1_F != "No negatives", Dorsal.scar.1_F != "Other", Technology.Phase_F == "MGMT"), 
  x = Dorsal.scar.1_F,  
  y = Site_F, 
  grouping.var = Blank.type_F,
  xlab="Site", 
  results.subtitle = FALSE,
  ggplot.component = list(
    scale_fill_manual(values =  Dorsal.scar.1_pal),  # Assign colors to values and set a single legend
    theme(
      plot.subtitle = element_text(size = 8, color = "black"),
      plot.caption = element_text(size = 8, color = "black"),
      axis.text = element_text(face = "bold", size = 8, color = "black", family = "Arial"),
      axis.text.y = element_text(face = "bold", size = 8, family = "Arial"),
      legend.title = element_blank(),  
      axis.ticks.x = element_blank(),
      strip.text = element_text(face = "bold", size = 8, family = "Arial")
    )))
MGMT.Dorsal.scar.1

ggsave("MGMT.Dorsal.scar.1.tiff", plot = MGMT.Dorsal.scar.1, width = 27.49021, height = 20.13479, units = "cm", dpi = 300) #set your working directory with setwd()
```

```{r}


Ordinary.Dorsal.scar.1 <- grouped_ggbarstats(
  data = filter(Blanks_Main_lumped, Dorsal.scar.1_F != "ND", Dorsal.scar.1_F != "No negatives", Dorsal.scar.1_F != "Other", Technology.Phase_F == "Ordinary"), 
  x = Dorsal.scar.1_F,  
  y = Site_F, 
  grouping.var = Blank.type_F,
  xlab="Site",
  results.subtitle = FALSE,
  ggplot.component = list(
    scale_fill_manual(values =  Dorsal.scar.1_pal),  # Assign colors to values and set a single legend
    theme(
      plot.subtitle = element_text(size = 8, color = "black"),
      plot.caption = element_text(size = 8, color = "black"),
      axis.text = element_text(face = "bold", size = 8, color = "black", family = "Arial"),
      axis.text.y = element_text(face = "bold", size = 8, family = "Arial"),
      legend.title = element_blank(),  
      axis.ticks.x = element_blank(),
      strip.text = element_text(face = "bold", size = 8, family = "Arial")
    )))
Ordinary.Dorsal.scar.1

ggsave("ordinary.Dorsal.scar.1.tiff", plot = Ordinary.Dorsal.scar.1, width = 27.49021, height = 20.13479, units = "cm", dpi = 300) #set your working directory with setwd()
```

###retouch position
```{r}


Blanks_Main_lumped$Retouch.Position_F <- factor(Blanks_Main_lumped$Retouch.Position, levels=c( "Direct", "Inverse", "Alternate", "Crossed"))
library(RColorBrewer)
# Get unique values in the Platform.Simpl column
Retouch.Position_values <- unique(Blanks_Main_lumped$Retouch.Position_F)

# Use the ColorBrewer Set3 palette
color_palette <- brewer.pal(n = length(Retouch.Position_values), name = "Set3")

# Create a color dictionary mapping each unique value to a color
Retouch.Position_pal <- setNames(color_palette, Retouch.Position_values)
library(dplyr)
library(ggplot2)
library(ggstatsplot)
# Create grouped bar plot
Retouch.Position <- grouped_ggbarstats(
  data = filter(Blanks_Main_lumped, Blank.type_F != "Flake", Tool == "Yes"), 
  x = Retouch.Position_F,  
  y = Site_F, 
  grouping.var = Blank.type_F,
  results.subtitle = FALSE,
  ggplot.component = list(
    scale_fill_manual(values =  Retouch.Position_pal),  # Assign colors to values and set a single legend
    theme(
      plot.subtitle = element_text(size = 8, color = "black"),
      plot.caption = element_text(size = 8, color = "black"),
      axis.text = element_text(face = "bold", size = 8, color = "black", family = "Arial"),
      axis.text.y = element_text(face = "bold", size = 8, family = "Arial"),
      legend.title = element_blank(),  
      axis.ticks.x = element_blank(),
      strip.text = element_text(face = "bold", size = 8, family = "Arial")
    )))
Retouch.Position

ggsave("Retouch.Position.tiff", plot = Retouch.Position, width = 27.49021, height = 20.13479, units = "cm", dpi = 300) #set your working directory with setwd()
```


## Plotting and analyising widths
```{r}
Blank_Main_reshaped1$Site_F <- factor(Blank_Main_reshaped1$Site, levels= c("AN", "ROM", "FUM", "CTS"))
Blank_Main_reshaped1$Blank.type_F <- factor(Blank_Main_reshaped1$Blank.type, levels= c("Flake", "Blade", "Bladelet"))
Blank_Main_reshaped1$Technology.Phase_F <- factor(Blank_Main_reshaped1$Technology.Phase, levels= c("Init", "MGMT", "Tablet", "Ordinary", "Spall")) #reorder earlier to later
```


```{r}
histowidthLaminar <- ggplot(filter(Blank_Main_reshaped1, Blank.type_F %in% c("Blade", "Bladelet")), aes(Width)) +
  geom_histogram(aes(y = ..density..), color = "grey", fill = "grey", binwidth = 1) +
  geom_density() +
  facet_wrap(~Site_F, ncol = 2) +
  scale_y_continuous(labels = scales::percent) +
  geom_vline(aes(xintercept = 12, color = "Blade and Bladelet Threshold"), linetype = "dashed", size = 1) +
  scale_x_continuous(breaks = seq(0, max(Blank_Main_reshaped1$Width, na.rm = TRUE), by = 2)) +
  theme(axis.title.y = element_blank(),
        axis.text.x = element_text(size = 4),
        legend.position = "top",
        legend.title = element_text(size = 6, face = "bold"),
        legend.text = element_text(size = 4)) +
  labs(x = "Width (mm)") +
  guides(color = guide_legend(title = "Medians and\nThreshold")) +
  scale_color_manual(values = c("Blade and Bladelet Threshold" = "red"),
                     name = "Medians and Threshold",
                     labels = c("Blade and Bladelet Threshold"))
histowidthLaminar
  

histowidthLaminarO <- ggplot(filter(Blank_Main_reshaped1, Blank.type_F %in% c("Blade", "Bladelet"), Technology.Phase_F == "Ordinary"), aes(Width)) +
  geom_histogram(aes(y = ..density..), color = "grey", fill = "grey", binwidth = 1) +
  geom_density() +
  facet_wrap(~Site_F, ncol = 2) +
  scale_y_continuous(labels = scales::percent) +
  geom_vline(xintercept = 12, linetype = "dashed", color = "red", size = 1) +
  scale_x_continuous(breaks = seq(0, max(Blank_Main_reshaped1$Width, na.rm = TRUE), by = 2)) +
  
  theme(axis.title.y = element_blank(),
        axis.text.x = element_text(size = 4),
        legend.position = "top",
        legend.title = element_text(size = 6, face = "bold"),
        legend.text = element_text(size = 4)) +
  
  labs(x = "Width (mm)") +
  
  guides(color = guide_legend(title = "Medians and\nThreshold")) +
  
  scale_color_manual(values = c("Blade and Bladelet Threshold" = "red"),
                     name = "Medians and Threshold",
                     labels = c("Blade and Bladelet Threshold"))
  
histowidthLaminarO

library(dplyr)

# Assuming your data frame is named Blank_Main_reshaped1
median_blade <- Blank_Main_reshaped1 %>%
  filter(Blank.type_F == "Blade") %>%
  group_by(Site_F) %>%
  summarise(median_width = median(Width, na.rm = TRUE))

print(median_blade)

# Group by site and calculate median width for Bladelet
median_bladelet <- Blank_Main_reshaped1 %>%
  filter(Blank.type_F == "Bladelet") %>%
  group_by(Site_F) %>%
  summarise(median_width = median(Width, na.rm = TRUE))

print(median_bladelet)

# Group by site and calculate median width excluding Blade and Bladelet
median_laminar<- Blank_Main_reshaped1 %>%
  filter(Blank.type_F %in% c("Blade", "Bladelet")) %>%
  group_by(Site_F) %>%
  summarise(median_width = median(Width, na.rm = TRUE))

print(median_laminar)

median_bladeO <- Blank_Main_reshaped1 %>%
  filter(Blank.type_F == "Blade", Technology.Phase_F == "Ordinary") %>%
  group_by(Site_F) %>%
  summarise(median_width = median(Width, na.rm = TRUE))

print(median_bladeO)

# Group by site and calculate median width for Bladelet
median_bladeletO <- Blank_Main_reshaped1 %>%
  filter(Blank.type_F == "Bladelet", Technology.Phase_F == "Ordinary") %>%
  group_by(Site_F) %>%
  summarise(median_width = median(Width, na.rm = TRUE))

print(median_bladeletO)

# Group by site and calculate median width excluding Blade and Bladelet
median_laminarO <- Blank_Main_reshaped1 %>%
  filter(Blank.type_F %in% c("Blade", "Bladelet"), Technology.Phase_F == "Ordinary") %>%
  group_by(Site_F) %>%
  summarise(median_width = median(Width, na.rm = TRUE))

print(median_laminarO)
histolaminarwidth <- histowidthLaminar + 
  geom_vline(data = median_blade, aes(xintercept = median_width, color = "Blade"), linetype = "dashed") +
  
  # Add vertical lines for median Bladelet widths
  geom_vline(data = median_bladelet, aes(xintercept = median_width, color = "Bladelet"), linetype = "dashed") +
  
  # Add vertical lines for median widths excluding Blade and Bladelet
  geom_vline(data = median_laminar, aes(xintercept = median_width, color = "Blade and Bladelet"), linetype = "dashed") +
  
  geom_vline(aes(xintercept = 12, color = "Blade and Bladelet Threshold"), linetype = "dashed", size = 1) +
  
  theme(legend.title = element_text(size = 6, face = "bold"),
        legend.text = element_text(size = 4)) +
  
  scale_color_manual(values = c("Blade" = "blue", "Bladelet" = "green", "Blade and Bladelet" = "#FFA500", "Blade and Bladelet Threshold" = "red"),
                     name = "Medians and Threshold",
                     labels = c("Blade", "Bladelet",  "Blade and\nBladelet Threshold", "Blade and\nBladelet")) +
  
  guides(color = guide_legend(title = "Medians and\nThreshold"))


histolaminarwidthO <- histowidthLaminarO + 
  geom_vline(data = median_bladeO, aes(xintercept = median_width, color = "Blade"), linetype = "dashed") +
  
  # Add vertical lines for median Bladelet widths
  geom_vline(data = median_bladeletO, aes(xintercept = median_width, color = "Bladelet"), linetype = "dashed") +
  
  # Add vertical lines for median widths excluding Blade and Bladelet
  geom_vline(data = median_laminarO, aes(xintercept = median_width, color = "Blade and Bladelet"), linetype = "dashed")+
   geom_vline(aes(xintercept = 12, color = "Blade and Bladelet Threshold"), linetype = "dashed", size = 1) +
  
  theme(legend.title = element_text(size = 6, face = "bold"),
        legend.text = element_text(size = 4)) +
  
  scale_color_manual(values = c("Blade" = "blue", "Bladelet" = "green", "Blade and Bladelet" = "#FFA500", "Blade and Bladelet Threshold" = "red"),
                     name = "Medians and Threshold",
                     labels = c("Blade", "Bladelet",  "Blade and\nBladelet Threshold", "Blade and\nBladelet")) +
  
  guides(color = guide_legend(title = "Medians and\nThreshold"))

ggsave("histolaminarwidth.tiff", plot = histolaminarwidth, width = 15, height = 10, units = "cm", dpi = 300) #set your working directory with setwd()
ggsave("histolaminarwidthO.tiff", plot = histolaminarwidthO, width = 15, height = 10, units = "cm", dpi = 300) #directory with setwd() 
```

The Width values distribution is unimodal both for all laminar blanks (histolaminarwidth, Blade and Bladelets, all phases) and for the Ordinary laminar blanks. Nonetheless, the unimodality of the distributions can be interpreted in the face of the overwhelming abundance of bladelets over blades, especially in the Ordinary technological phase. In fact highest frequency peaks are behind the 12 mm threshold (wide red dashed line). when calculating median values, the Blade and Bladelet one falls next to the threshold, except in Fumane. This is clearly influenced by the bladelets median. Thus, the unimodality in Width values do not refute the Tixier's (1963) threshold between blades and bladelets and should not be interpreted necessarily as a continuous reduction from blades to bladelets, especially when no refitting is available. 

### dimensions 
####width
```{r}
#violin plot
library(ggstatsplot)
library(ggplot2)
Gen.width <- grouped_ggbetweenstats(
  data = filter(Blank_Main_reshaped1, Blank.type_F %in% c("Blade", "Bladelet"), Tool == "No"),
  x = Site_F,
  y = Width,
  grouping.var = Blank.type_F,
  type = "non-parametric",
  results.subtitle = FALSE,
  combine = TRUE,
  ggtheme = theme_classic()
) 
Gen.width

ggsave("Gen.width.tiff", plot = Gen.width, width = 27.49021 , height =20.29354, units = "cm", dpi = 300) #set your working directory with setwd()
```

```{r}
MGMT.width <- grouped_ggbetweenstats(
  data = filter(Blank_Main_reshaped1, Blank.type_F %in% c("Blade", "Bladelet"), Tool == "No", Technology.Phase_F == "MGMT"),
  x = Site_F,
  y = Width,
  grouping.var = Blank.type_F,
  type = "non-parametric",
  results.subtitle = FALSE,
  combine = TRUE,
  ggtheme = theme_minimal(),
) 
MGMT.width

ggsave("MGMT.width.tiff", plot = MGMT.width, width = 27.49021 , height =20.29354, units = "cm", dpi = 300) #set your working directory with setwd()
```

```{r}
Ordinary.width <- grouped_ggbetweenstats(
  data = filter(Blank_Main_reshaped1, Blank.type_F %in% c("Blade", "Bladelet"), Tool == "No", Technology.Phase_F == "Ordinary"),
  x = Site_F,
  y = Width,
  grouping.var = Blank.type_F,
  type = "non-parametric",
  results.subtitle = TRUE,
  combine = TRUE,
  ggtheme = theme_minimal(),
) 
Ordinary.width

ggsave("Ordinary.width.tiff", plot = Ordinary.width,width = 27.49021 , height =20.29354, units = "cm", dpi = 300) #set your working directory with setwd()
```
the width are statistically significant across sites, but the effect size is weak or negligible.
####elongation
```{r}
Gen.elon <- grouped_ggbetweenstats(
  data = filter(Blank_Main_reshaped1, Preservation == "Complete", Tool == "No", Blank.type_F %in% c("Blade", "Bladelet")),
  x = Site_F,
  y = Elongation,
  grouping.var = Blank.type_F,
  type = "non-parametric",
  results.subtitle = FALSE,
  combine = TRUE,
  ggtheme = theme_minimal(),
  ) 
Gen.elon

ggsave("Gen.elon.tiff", plot = Gen.elon, width = 27.49021 , height =20.29354, units = "cm", dpi = 300) #set your working directory with setwd()
```


```{r}
MGMT.elon <- grouped_ggbetweenstats(
  data = filter(Blank_Main_reshaped1, Preservation == "Complete", Tool == "No", Blank.type_F %in% c("Blade", "Bladelet"), Technology.Phase_F == "MGMT"),
  x = Site_F,
  y = Elongation,
  grouping.var = Blank.type_F,
  type = "non-parametric",
  results.subtitle = FALSE,
  combine = TRUE,
  ggtheme = theme_minimal(),
) 
MGMT.elon

ggsave("MGMT.elon.tiff", plot = MGMT.elon, width = 27.49021 , height =20.29354, units = "cm", dpi = 300) #set your working directory with setwd()
```


```{r}
Ordinary.elon <- grouped_ggbetweenstats(
  data = filter(Blank_Main_reshaped1, Preservation == "Complete", Tool == "No", Blank.type_F %in% c("Blade", "Bladelet"), Technology.Phase_F == "Ordinary"),
  x = Site_F,
  y = Elongation,
  grouping.var = Blank.type_F,
  type = "non-parametric",
  results.subtitle = TRUE,
  combine = TRUE,
  ggtheme = theme_minimal(),
)
Ordinary.elon

ggsave("Ordinary.elon.tiff", plot = Ordinary.elon, width = 27.49021 , height =20.29354, units = "cm", dpi = 300) #set your working directory with setwd()

```
the elongation are statistically significant across sites, the effect size is moderate.

```{r}
Ordinary.elon <- grouped_ggbetweenstats(
  data = filter(Blank_Main_reshaped1, Preservation == "Complete", Tool == "No", Blank.type_F %in% c("Blade", "Bladelet"), Technology.Phase_F == "Ordinary"),
  x = Blank.type_F,
  y = Elongation,
  grouping.var = Site_F,
  type = "non-parametric",
  results.subtitle = TRUE,
  combine = TRUE,
  ggtheme = theme_minimal(),
)
Ordinary.elon
```


##Flaking intensity
```{r}
library(dplyr)
Flaking.Int <- Blank_Main_reshaped1 %>%
  mutate(Area = Width * Length) %>%
  select(Site_F, Cortex_F, Number.negatives, Area) %>% 
  group_by(Site_F, Cortex_F) %>% 
  summarise(ModeScar = as.numeric(which.max(table(Number.negatives))),
            MeanArea = mean(Area, na.rm = TRUE)) %>%
  as.data.frame()
Flaking.Int


#plotting it
library(ggplot2)
Int <- ggplot(filter(Flaking.Int, !is.na(Cortex_F)), aes(x = Cortex_F, y = MeanArea, group = Site_F)) +
  geom_bar(stat = "identity", aes(fill = "Area")) +
  geom_line(aes(y = ModeScar * 200, color = "ModeScar"), size = 1) +
  scale_y_continuous(name = "Area", sec.axis = sec_axis(~./200, name = "Scar Number")) +
  facet_wrap(~Site_F, ncol = 2) +
  theme_classic()+
  xlab("Cortex") +
  scale_fill_manual(name = NULL, values = c("Area" = "grey")) +
  scale_color_manual(name = NULL, values = c("ModeScar" = "#E69F00")) +
  theme(legend.position = "top")

ggsave("Flaking.Int.tiff", plot = Int, width = 15, height = 10, units = "cm", dpi = 300)
```

The decreasing trend in blank size along the Cortex axis suggests a linear reduction process at Ansab and Romanesti. In Fumane, the reduction is still notably linear, even though fully cortical blanks are smaller than extensively cortical ones. In Les Cottés, there is no clear linear reduction, possibly indicating that reduction starts with semi-cortical. Notably, non-cortical blanks are consistently smaller in each assemblage. Additionally, the number of scars increases with the reduction of cortical surfaces. This provides evidence of a similar reduction pattern across all four sites, accounting for differences in raw material acquisition and decortication practices.

##MCA & ANOVA testing coordinates

we will use Multiple correspondence analysis (MCA) for summarizing and visualizing a data table containing more than two categorical variables.The goal is to identify: 
- A group of individuals with similar profile 
- The associations between variable categories

first of all we create two Supplementary qualitative variables one that sums up the Site and the Blank Type, and one that sums up Site, Blank Type and Technological Phase (Ordinary or Management)
```{r}
library(dplyr)
Blank_Main_reshaped2 <- Blank_Main_reshaped1 %>%
  mutate(SiteBlank.type = Site, .after = Site) %>%
  mutate(SiteBlank.type = case_when(
    Site == "AN" & Blank.type == "Blade" ~ "A.B",
    Site == "CTS" & Blank.type == "Blade" ~ "C.B",
    Site == "FUM" & Blank.type == "Blade" ~ "F.B",
    Site == "ROM" & Blank.type == "Blade" ~ "R.B",
    Site == "AN" & Blank.type == "Bladelet" ~ "A.b",
    Site == "CTS" & Blank.type == "Bladelet" ~ "C.b",
    Site == "FUM" & Blank.type == "Bladelet" ~ "F.b",
    Site == "ROM" & Blank.type == "Bladelet" ~ "R.b",
    Site == "AN" & Blank.type == "Flake" ~ "A.F",
    Site == "CTS" & Blank.type == "Flake" ~ "C.F",
    Site == "FUM" & Blank.type == "Flake" ~ "F.F",
    Site == "ROM" & Blank.type == "Flake" ~ "R.F"
  )) %>%
mutate(SiteBlank.typeTech = SiteBlank.type, .after = SiteBlank.type) %>%
mutate(SiteBlank.typeTech = case_when(
    Site == "AN" & Blank.type == "Blade" & Technology.Phase == "Ordinary" ~ "A.B.O",
    Site == "CTS" & Blank.type == "Blade" & Technology.Phase == "Ordinary" ~ "C.B.O",
    Site == "FUM" & Blank.type == "Blade" & Technology.Phase == "Ordinary"~ "F.B.O",
    Site == "ROM" & Blank.type == "Blade" & Technology.Phase == "Ordinary"~ "R.B.O",
    Site == "AN" & Blank.type == "Bladelet" & Technology.Phase == "Ordinary"~ "A.b.O",
    Site == "CTS" & Blank.type == "Bladelet" & Technology.Phase == "Ordinary"~ "C.b.O",
    Site == "FUM" & Blank.type == "Bladelet" & Technology.Phase == "Ordinary" ~ "F.b.O",
    Site == "ROM" & Blank.type == "Bladelet" & Technology.Phase == "Ordinary"~ "R.b.O",
    Site == "AN" & Blank.type == "Flake" & Technology.Phase == "Ordinary"~ "A.F.O",
    Site == "CTS" & Blank.type == "Flake" & Technology.Phase == "Ordinary"~ "C.F.O",
    Site == "FUM" & Blank.type == "Flake" & Technology.Phase == "Ordinary" ~ "F.F.O",
    Site == "ROM" & Blank.type == "Flake" & Technology.Phase == "Ordinary"~ "R.F.O",
    Site == "AN" & Blank.type == "Blade" & Technology.Phase == "MGMT" ~ "A.B.M",
    Site == "CTS" & Blank.type == "Blade" & Technology.Phase == "MGMT" ~ "C.B.M",
    Site == "FUM" & Blank.type == "Blade" & Technology.Phase == "MGMT"~ "F.B.M",
    Site == "ROM" & Blank.type == "Blade" & Technology.Phase == "MGMT"~ "R.B.M",
    Site == "AN" & Blank.type == "Bladelet" & Technology.Phase == "MGMT"~ "A.b.M",
    Site == "CTS" & Blank.type == "Bladelet" & Technology.Phase == "MGMT"~ "C.b.M",
    Site == "FUM" & Blank.type == "Bladelet" & Technology.Phase == "MGMT" ~ "F.b.M",
    Site == "ROM" & Blank.type == "Bladelet" & Technology.Phase == "MGMT"~ "R.b.M",
    Site == "AN" & Blank.type == "Flake" & Technology.Phase == "MGMT"~ "A.F.M",
    Site == "CTS" & Blank.type == "Flake" & Technology.Phase == "MGMT"~ "C.F.M",
    Site == "FUM" & Blank.type == "Flake" & Technology.Phase == "MGMT" ~ "F.F.M",
    Site == "ROM" & Blank.type == "Flake" & Technology.Phase == "MGMT"~ "R.F.M",
    Site == "AN" & Blank.type == "Flake" & Technology.Phase == "Init"~ "A.F.I",
    Site == "CTS" & Blank.type == "Flake" & Technology.Phase == "Init"~ "C.F.I",
    Site == "FUM" & Blank.type == "Flake" & Technology.Phase == "Init" ~ "F.F.I",
    Site == "ROM" & Blank.type == "Flake" & Technology.Phase == "Init"~ "R.F.I",
    Site == "AN" & Blank.type == "Blade" & Technology.Phase == "Init"~ "A.B.I",
    Site == "CTS" & Blank.type == "Blade" & Technology.Phase == "Init"~ "C.B.I",
    Site == "FUM" & Blank.type == "Blade" & Technology.Phase == "Init" ~ "F.B.I",
    Site == "ROM" & Blank.type == "Blade" & Technology.Phase == "Init"~ "R.B.I",
    Site == "AN" & Blank.type == "Bladelet" & Technology.Phase == "Init"~ "A.b.I",
    Site == "CTS" & Blank.type == "Bladelet" & Technology.Phase == "Init"~ "C.b.I",
    Site == "FUM" & Blank.type == "Bladelet" & Technology.Phase == "Init" ~ "F.b.I",
    Site == "ROM" & Blank.type == "Bladelet" & Technology.Phase == "Init"~ "R.b.I"
    ))
str(Blank_Main_reshaped2)
```
What we want t check is the association of categorical variables in three domains of the knapping process across the site

-Platform domain
-Convexity domain
-Reduction domain 


###Platform

The Platform domain is comprising the Variables Platform, Abrasion.simpl, Blank.type and Cortex.y.n to check if there's variation in platform preparation during the knapping sequence.
####Ordinary
```{r}


library(FactoMineR)
library(factoextra)
library(dplyr)
library(ggplot2)



# Select relevant columns and remove missing values
platform_maintenanceGO <- Blank_Main_reshaped2 %>%
  filter(Blank.type != "Flake") %>% #check only laminar
  filter(Preservation != "Mes+Dist") %>% #only blanks with a Proximal part
  filter(!Platform %in% c("No butt", "ND", "NA", "Crushed", "Concave")) %>% #removing blanks without clear info
  filter(!Abrasion.simpl %in% c("NA", "ND")) %>% #removing blanks without clear info
  filter(Technology.Phase %in% c("Ordinary")) %>% #getting only Ordinary
  select(SiteBlank.typeTech, Blank.type, Abrasion.simpl, Platform, Cortex.y.n) %>%
  na.omit()
  
summary(platform_maintenanceGO)

# Run MCA
res.mca_PlatformO <- MCA(platform_maintenanceGO, graph = FALSE, quali.sup =1:2, method = "Burt") #Site, SiteBlank.type, SiteBlank.typeTech are not part of the active variables used to compute the MCA but is considered as supplementary information. The MCA analysis is performed based on the active variables in platform_maintenanceG, and the supplementary variables are used to provide additional information or context to the analysis. Their coordinates are predicted using only the information provided by the performed multiple correspondence analysis on active variables/individuals.

print(res.mca_PlatformO)
fviz_screeplot(res.mca_PlatformO, addlabels = TRUE, ylim = c(0, 45)) #To visualize the percentages of inertia explained by each MCA dimensions. Dim1 and Dim2 explain 43.162% of the variance
summary(res.mca_PlatformO)


fviz_mca_var(res.mca_PlatformO, choice = "mca.cor", 
            repel = TRUE, 
            ggtheme = theme_minimal()) #checking to which dimensions the variable are correlated
fviz_mca_var(res.mca_PlatformO, 
             repel = TRUE, # 
             ggtheme = theme_minimal()) #Variable categories with a similar profile are grouped together. Negatively correlated variable categories are positioned on opposite sides of the plot origin (opposed quadrants).The distance between category points and the origin measures the quality of the variable category on the factor map. Category points that are away from the origin are well represented on the factor map.

var <- get_mca_var(res.mca_PlatformO)
head(var$cos2, 20) #If a variable category is well represented by two dimensions, the sum of the cos2 is closed to one. For some of the row items, more than 2 dimensions are required to perfectly represent the data.


fviz_cos2(res.mca_PlatformO, choice = "var", axes = 1:2) #visualising

fviz_contrib(res.mca_PlatformO, choice = "var", axes = 1, top = 15) #contribution to Dim 1. above the threshold are  Abrasion.simpl_No, Cortex.y.n_Yes, Natural

fviz_contrib(res.mca_PlatformO, choice = "var", axes = 2, top = 15) #contribution to Dim 2. above the threshold is only Punctiform

MCA_PlatformO <- fviz_mca_var(
  res.mca_PlatformO,
  col.var = "contrib",
  label = "all",
  invisible = "none",
  gradient.cols = c("#00AFBB", "#E7B800", "#FC4E07"),
  repel = TRUE,
  max.overlaps=Inf,
  ggtheme = theme_classic()
)
MCA_PlatformO
ggsave("MCAPlatformOrdinary.tiff", plot = MCA_PlatformO, width = 43.656255, height = 20.29354, units = "cm", dpi = 300)
ggsave("MCAPlatformOrdinary.png", plot = MCA_PlatformO, width = 43.656255, height = 20.29354, units = "cm", dpi = 300)    


fviz_mca_ind(
  res.mca_PlatformO, 
  label = "none",                   # hide individual labels
  habillage = "SiteBlank.typeTech", # color by groups
  addEllipses = TRUE,               # add confidence ellipses
  ellipse.type = "confidence",      # type of ellipse
  ggtheme = theme_minimal(),        # set the ggplot theme
  geom = "point",                   # use points for symbols
  ) # set custom colors              # use grouping variable for shapes

```
####Management
```{r}


library(FactoMineR)
library(factoextra)
library(dplyr)
library(ggplot2)



# Select relevant columns and remove missing values
platform_maintenanceGM <- Blank_Main_reshaped2 %>%
  filter(Blank.type != "Flake") %>% #check only laminar
  filter(Preservation != "Mes+Dist") %>% #only blanks with a Proximal part
  filter(!Platform %in% c("No butt", "ND", "NA", "Crushed", "Concave")) %>% #removing blanks without clear info
  filter(!Abrasion.simpl %in% c("NA", "ND")) %>% #removing blanks without clear info
  filter(Technology.Phase %in% c("MGMT")) %>% #getting only Ordinary
  select(SiteBlank.typeTech, Blank.type, Abrasion.simpl, Platform, Cortex.y.n) %>%
  na.omit()
  
summary(platform_maintenanceGM)

# Run MCA
res.mca_PlatformM <- MCA(platform_maintenanceGM, graph = FALSE, quali.sup =1:2, method = "Burt") #Site, SiteBlank.type, SiteBlank.typeTech are not part of the active variables used to compute the MCA but is considered as supplementary information. The MCA analysis is performed based on the active variables in platform_maintenanceG, and the supplementary variables are used to provide additional information or context to the analysis. Their coordinates are predicted using only the information provided by the performed multiple correspondence analysis on active variables/individuals.

print(res.mca_PlatformM)
fviz_screeplot(res.mca_PlatformM, addlabels = TRUE, ylim = c(0, 45)) #To visualize the percentages of inertia explained by each MCA dimensions. Dim1 and Dim2 explain 43.310% of the variance
summary(res.mca_PlatformM)


fviz_mca_var(res.mca_PlatformM, choice = "mca.cor", 
            repel = TRUE, 
            ggtheme = theme_minimal()) #checking to which dimensions the variable are correlated
fviz_mca_var(res.mca_PlatformM, 
             repel = TRUE, # 
             ggtheme = theme_minimal()) #Variable categories with a similar profile are grouped together. Negatively correlated variable categories are positioned on opposite sides of the plot origin (opposed quadrants).The distance between category points and the origin measures the quality of the variable category on the factor map. Category points that are away from the origin are well represented on the factor map.

var <- get_mca_var(res.mca_PlatformM)
head(var$cos2, 20) #If a variable category is well represented by two dimensions, the sum of the cos2 is closed to one. For some of the row items, more than 2 dimensions are required to perfectly represent the data.


fviz_cos2(res.mca_PlatformM, choice = "var", axes = 1:2) #visualising

fviz_contrib(res.mca_PlatformM, choice = "var", axes = 1, top = 15) #contribution to Dim 1. above the threshold are  Abrasion.simpl_No, Cortex.y.n_Yes, Natural

fviz_contrib(res.mca_PlatformM, choice = "var", axes = 2, top = 15) #contribution to Dim 2. above the threshold is only Punctiform

MCA_PlatformM <- fviz_mca_var(
  res.mca_PlatformM,
  col.var = "contrib",
  label = "all",
  invisible = "none",
  gradient.cols = c("#00AFBB", "#E7B800", "#FC4E07"),
  repel = TRUE,
  max.overlaps=Inf,
  ggtheme = theme_classic()
)
MCA_PlatformM
ggsave("MCAPlatformMGMT.tiff", plot = MCA_PlatformM, width = 43.656255, height = 20.29354, units = "cm", dpi = 300)
ggsave("MCAPlatformMGMT.png", plot = MCA_PlatformM, width = 43.656255, height = 20.29354, units = "cm", dpi = 300)    


fviz_mca_ind(
  res.mca_PlatformM, 
  label = "none",                   # hide individual labels
  habillage = "SiteBlank.typeTech", # color by groups
  addEllipses = TRUE,               # add confidence ellipses
  ellipse.type = "confidence",      # type of ellipse
  ggtheme = theme_minimal(),        # set the ggplot theme
  geom = "point",                   # use points for symbols
  )  # set custom colors              # use grouping variable for shapes
```
###ANOVA testing Platform domain

#####Ordinary
```{r}
#preparing the data
library(dplyr)
MCA_PlatformO <- as.data.frame(res.mca_PlatformO$ind)
SiteTypeTech <- as.data.frame(platform_maintenanceGO$SiteBlank.typeTech)

mca.PlatformO <- MCA_PlatformO %>%
  select(1:2)

Mca.PlatformO <- bind_cols(SiteTypeTech, mca.PlatformO)

Mca.PlatformO <- Mca.PlatformO %>%
  mutate(SiteTypeTech = platform_maintenanceGO$SiteBlank.typeTech, "dim1" = coord.Dim.1, "dim2" =  coord.Dim.2)%>%
  select(4:6) #creating a dataframe with the Dim1 and Dim2 coordinates obtained with MCA_Reduction of each individual (blank)

###create unique comparisons
unique(Mca.PlatformO$SiteTypeTech)

#setting the unique comparisons 
assemblages <- c("A.b.O", "A.B.O", "R.b.O", "R.B.O", "C.b.O", "C.B.O", "F.B.O", "F.b.O")

# Generate all possible unique combinations of size 2
all_combinations <- combn(assemblages, 2)

# Convert the result to a data frame for better readability
combinations_df <- data.frame(t(all_combinations))

# Print the result
print(combinations_df)

comparisons_PlatformO <- c(
  "A.b.O-A.B.O", "A.b.O-R.b.O", "A.b.O-R.B.O","A.b.O-C.b.O",
  "A.b.O-C.B.O", "A.b.O-F.B.O", "A.b.O-F.b.O", "A.B.O-R.b.O",
  "A.B.O-R.B.O", "A.B.O-C.b.O", "A.B.O-C.B.O", "A.B.O-F.B.O",
  "A.B.O-F.b.O", "R.b.O-R.B.O", "R.b.O-C.b.O", "R.b.O-C.B.O",
  "R.b.O-F.B.O", "R.b.O-F.b.O", "R.B.O-C.b.O", "R.B.O-C.B.O",
  "R.B.O-F.B.O", "R.B.O-F.b.O", "C.b.O-C.B.O", "C.b.O-F.B.O",
  "C.b.O-F.b.O", "C.B.O-F.B.O", "C.B.O-F.b.O", "F.B.O-F.b.O"
)


```

####Bootstrapping

```{r}
# Multi-comparison bootstrap
install.packages("WRS2")
library(WRS2)
# Multi-comparison bootstrap


boot_dim1 <- mcppb20(dim1 ~ SiteTypeTech, data = Mca.PlatformO, nboot = 5000)
boot_dim2 <- mcppb20(dim2 ~ SiteTypeTech, data = Mca.PlatformO, nboot = 5000)

# Convert results to data frames
multi_comp_dim1 <- as.data.frame(boot_dim1$comp)
multi_comp_dim2 <- as.data.frame(boot_dim2$comp)

# Add SiteTypeTech names and transform to column "SiteTypeTech"
multi_comp_dim1$SiteTypeTech <- comparisons_PlatformO
multi_comp_dim1 <- multi_comp_dim1[!duplicated(names(multi_comp_dim1))]

multi_comp_dim2$SiteTypeTech <- comparisons_PlatformO
multi_comp_dim2 <- multi_comp_dim2[!duplicated(names(multi_comp_dim2))]

# Join the results
multi_comp <- full_join(multi_comp_dim1, multi_comp_dim2, by = "SiteTypeTech", suffix = c("dim1", "dim2"))

# Select relevant columns
multi_comp <- select(multi_comp, SiteTypeTech, `p-valuedim1`, `p-valuedim2`)

# Build a list with pairwise p-values
labels_dim1 <- setNames(multi_comp$`p-valuedim1`, multi_comp_dim1$SiteTypeTech)
labels_dim2 <- setNames(multi_comp$`p-valuedim2`, multi_comp_dim2$SiteTypeTech)

# Attribute letters to each grouping based on alpha = .05
install.packages("multcompView")
library(multcompView)
library(tibble)
grouping_dim1 <- data.frame(multcompLetters(labels_dim1)["Letters"])
grouping_dim1 <- rownames_to_column(grouping_dim1, "SiteTypeTech")

grouping_dim2 <- data.frame(multcompLetters(labels_dim2)["Letters"])
grouping_dim2 <- rownames_to_column(grouping_dim2, "SiteTypeTech")

# Join the grouping results
grouping <- full_join(grouping_dim1, grouping_dim2, by = "SiteTypeTech", suffix = c("dim1", "dim2"))


# Print or use the 'grouping' dataframe for further analysis or visualization
print(grouping)

```
####Plotting
```{r}
library(RcmdrMisc)
library(gridExtra)
library(DescTools)

mca_summary <- Mca.PlatformO %>% 
  group_by(SiteTypeTech) %>% 
  summarise(meandim1 = mean(dim1, trim = 0.2), meandim2 = mean(dim2, trim = 0.2), 
            LCIdim1 = MeanCI(dim1, trim = 0.2)[2], MCIdim1 = MeanCI(dim1, trim = 0.2)[3],
            LCIdim2 = MeanCI(dim2, trim = 0.2)[2], MCIdim2 = MeanCI(dim2, trim = 0.2)[3]) 

m1 <- max(mca_summary$MCIdim1)
m2 <- max(mca_summary$MCIdim2)

dim1 <- ggplot(mca_summary) +
  geom_point(stat = "identity", aes(x = SiteTypeTech, y = meandim1), size = 3) +
  geom_errorbar(stat = "identity", aes(x = SiteTypeTech, ymin = LCIdim1, ymax = MCIdim1), width = 0) +
  geom_hline(aes(yintercept = 0), color = "red", linetype = "dashed", show.legend = FALSE) +
  geom_text(data = grouping, aes(x = SiteTypeTech, y = m1 + 0.08, label = Lettersdim1, size = 15), show.legend = FALSE) +
  xlab("") +
  ylab("Dimension 1") +
  scale_colour_discrete(l = 40) +
  theme(text = element_text(size = 18)) +
  coord_flip()


dim2 <- ggplot(mca_summary) +
  geom_point(stat = "identity", aes(x = SiteTypeTech, y = meandim2), size = 3) +
  geom_errorbar(stat = "identity", aes(x = SiteTypeTech, ymin = LCIdim2, ymax = MCIdim2), width = 0) +
  geom_hline(aes(yintercept = 0), color = "red", linetype = "dashed", show.legend = FALSE) +
  geom_text(data = grouping, aes(x = SiteTypeTech, y = m2 + 0.08, label = Lettersdim2, size = 15), show.legend = FALSE) +
  xlab("") +
  ylab("Dimension 2") +
  scale_colour_discrete(l = 40) +
  theme(text = element_text(size = 18)) +
  coord_flip()


ANOVAPlatformO <- grid.arrange(dim1, dim2, ncol = 1)

ggsave("ANOVAPlatformOrdinary.tiff", plot = ANOVAPlatformO, width = 43.656255, height = 20.29354, units = "cm", dpi = 300) 
ggsave("ANOVAPlatformOrdinary.png", plot = ANOVAPlatformO, width = 43.656255, height = 20.29354, units = "cm", dpi = 300)

```
Interpretation ANOVA

According to the p-values of the single comparison between different categories and the resulting letters assigned the following categories are statistically similar on the Dim1:

Ansab bladelets, Ansab blades, and Fumane blades (letter a)
Ansab bladelets, Les Cottés bladelets, and Fumane blades (letter b)
Romanesti bladelets, Les Cottés blades and Fumane bladelets (letter c)


Dimension 1 is mostly defined by Natural platforms, presence of Cortex and no Overhang Abrasion. which are all occuring on the positive part of the biplot, all categories are showing negative lodgings, meaning they are characterised by non-cortical platforms, non cortical blanks and prepared overhangs. Only Les Cottés blades are showing positive lodging. 

on Dim2

Ansab bladelets and Fumane blades (letter a)
Ansab blades, Romanesti bladelets, Romanesti blades, Les Cottés blades (letter b)
Ansab blades, Romanesti blades, Les Cottés bladelets, Fumane bladelets (letter c)
Fumane blades and Fumane bladelets (letter d)

Dimension 2 is mostly defined by Punctiform platforms and no Overhang Abrasion. which are all occuring on the positive part of the biplot, all categories are showing negative lodgings, meaning they are characterised by non punctiform platforms and prepared overhangs. Only Ansab bladelets are showing positive lodging. 

#####MGMT
```{r}
#preparing the data
library(dplyr)
MCA_PlatformM <- as.data.frame(res.mca_PlatformM$ind)
SiteTypeTech <- as.data.frame(platform_maintenanceGM$SiteBlank.typeTech)

mca.PlatformM <- MCA_PlatformM %>%
  select(1:2)

Mca.PlatformM <- bind_cols(SiteTypeTech, mca.PlatformM)

Mca.PlatformM <- Mca.PlatformM %>%
  mutate(SiteTypeTech = platform_maintenanceGM$SiteBlank.typeTech, "dim1" = coord.Dim.1, "dim2" =  coord.Dim.2)%>%
  select(4:6) #creating a dataframe with the Dim1 and Dim2 coordinates obtained with MCA_Reduction of each individual (blank)

###create unique comparisons
unique(Mca.PlatformM$SiteTypeTech)

#setting the unique comparisons 
assemblages <- c("A.b.M", "A.B.M", "R.b.M", "R.B.M", "C.b.M", "C.B.M", "F.B.M", "F.b.M")

# Generate all possible unique combinations of size 2
all_combinations <- combn(assemblages, 2)

# Convert the result to a data frame for better readability
combinations_df <- data.frame(t(all_combinations))

# Print the result
print(combinations_df)

comparisons_PlatformM <- c(
  "A.b.M-A.B.M", "A.b.M-R.b.M", "A.b.M-R.B.M", "A.b.M-C.b.M",
  "A.b.M-C.B.M", "A.b.M-F.B.M" ,"A.b.M-F.b.M", "A.B.M-R.b.M",
  "A.B.M-R.B.M", "A.B.M-C.b.M", "A.B.M-C.B.M", "A.B.M-F.B.M",
  "A.B.M-F.b.M", "R.b.M-R.B.M","R.b.M-C.b.M", "R.b.M-C.B.M", 
  "R.b.M-F.B.M", "R.b.M-F.b.M", "R.B.M-C.b.M", "R.B.M-C.B.M",
  "R.B.M-F.B.M", "R.B.M-F.b.M", "C.b.M-C.B.M", "C.b.M-F.B.M", 
  "C.b.M-F.b.M", "C.B.M-F.B.M", "C.B.M-F.b.M", "F.B.M-F.b.M"
)


```

####Bootstrapping

```{r}
# Multi-comparison bootstrap
install.packages("WRS2")
library(WRS2)
# Multi-comparison bootstrap


boot_dim1 <- mcppb20(dim1 ~ SiteTypeTech, data = Mca.PlatformM, nboot = 5000)
boot_dim2 <- mcppb20(dim2 ~ SiteTypeTech, data = Mca.PlatformM, nboot = 5000)

# Convert results to data frames
multi_comp_dim1 <- as.data.frame(boot_dim1$comp)
multi_comp_dim2 <- as.data.frame(boot_dim2$comp)

# Add SiteTypeTech names and transform to column "SiteTypeTech"
multi_comp_dim1$SiteTypeTech <- comparisons_PlatformM
multi_comp_dim1 <- multi_comp_dim1[!duplicated(names(multi_comp_dim1))]

multi_comp_dim2$SiteTypeTech <- comparisons_PlatformM
multi_comp_dim2 <- multi_comp_dim2[!duplicated(names(multi_comp_dim2))]

# Join the results
multi_comp <- full_join(multi_comp_dim1, multi_comp_dim2, by = "SiteTypeTech", suffix = c("dim1", "dim2"))

# Select relevant columns
multi_comp <- select(multi_comp, SiteTypeTech, `p-valuedim1`, `p-valuedim2`)

# Build a list with pairwise p-values
labels_dim1 <- setNames(multi_comp$`p-valuedim1`, multi_comp_dim1$SiteTypeTech)
labels_dim2 <- setNames(multi_comp$`p-valuedim2`, multi_comp_dim2$SiteTypeTech)

# Attribute letters to each grouping based on alpha = .05
install.packages("multcompView")
library(multcompView)
library(tibble)
grouping_dim1 <- data.frame(multcompLetters(labels_dim1)["Letters"])
grouping_dim1 <- rownames_to_column(grouping_dim1, "SiteTypeTech")

grouping_dim2 <- data.frame(multcompLetters(labels_dim2)["Letters"])
grouping_dim2 <- rownames_to_column(grouping_dim2, "SiteTypeTech")

# Join the grouping results
grouping <- full_join(grouping_dim1, grouping_dim2, by = "SiteTypeTech", suffix = c("dim1", "dim2"))


# Print or use the 'grouping' dataframe for further analysis or visualization
print(grouping)

```
####Plotting
```{r}
library(RcmdrMisc)
library(gridExtra)
library(DescTools)

mca_summary <- Mca.PlatformM %>% 
  group_by(SiteTypeTech) %>% 
  summarise(meandim1 = mean(dim1, trim = 0.2), meandim2 = mean(dim2, trim = 0.2), 
            LCIdim1 = MeanCI(dim1, trim = 0.2)[2], MCIdim1 = MeanCI(dim1, trim = 0.2)[3],
            LCIdim2 = MeanCI(dim2, trim = 0.2)[2], MCIdim2 = MeanCI(dim2, trim = 0.2)[3]) 

m1 <- max(mca_summary$MCIdim1)
m2 <- max(mca_summary$MCIdim2)

dim1 <- ggplot(mca_summary) +
  geom_point(stat = "identity", aes(x = SiteTypeTech, y = meandim1), size = 3) +
  geom_errorbar(stat = "identity", aes(x = SiteTypeTech, ymin = LCIdim1, ymax = MCIdim1), width = 0) +
  geom_hline(aes(yintercept = 0), color = "red", linetype = "dashed", show.legend = FALSE) +
  geom_text(data = grouping, aes(x = SiteTypeTech, y = m1 + 0.08, label = Lettersdim1, size = 15), show.legend = FALSE) +
  xlab("") +
  ylab("Dimension 1") +
  scale_colour_discrete(l = 40) +
  theme(text = element_text(size = 18)) +
  coord_flip()


dim2 <- ggplot(mca_summary) +
  geom_point(stat = "identity", aes(x = SiteTypeTech, y = meandim2), size = 3) +
  geom_errorbar(stat = "identity", aes(x = SiteTypeTech, ymin = LCIdim2, ymax = MCIdim2), width = 0) +
  geom_hline(aes(yintercept = 0), color = "red", linetype = "dashed", show.legend = FALSE) +
  geom_text(data = grouping, aes(x = SiteTypeTech, y = m2 + 0.08, label = Lettersdim2, size = 15), show.legend = FALSE) +
  xlab("") +
  ylab("Dimension 2") +
  scale_colour_discrete(l = 40) +
  theme(text = element_text(size = 18)) +
  coord_flip()


ANOVAPlatformM <- grid.arrange(dim1, dim2, ncol = 1)

ggsave("ANOVAPlatformMGMT.tiff", plot = ANOVAPlatformM, width = 43.656255, height = 20.29354, units = "cm", dpi = 300) 
ggsave("ANOVAPlatformMGMT.png", plot = ANOVAPlatformM, width = 43.656255, height = 20.29354, units = "cm", dpi = 300)

```
Interpretation ANOVA

According to the p-values of the single comparison between different categories and the resulting letters assigned the following categories are statistically similar on the Dim1:

Ansab bladelets, Ansab blades, Romanesti blades, Les Cottés bladelets, Les Cottés blades (letter a)
Ansab bladelets, Romanesti blades, Les Cottés bladelets, and Fumane bladelets (letter b)
Ansab blades, Romanesti bladelets, Romanesti blades (letter c)
Fumane blades and bladelets (letter d)


Dimension 1 is mostly defined by Natural platforms and no Overhang Abrasion. which are all occuring on the positive part of the biplot, most of the categories are showing negative lodgings, meaning they are characterised by non-cortical platforms and prepared overhangs. Romanesti blades and bladelets are showing positive lodging. 

on Dim2

Ansab bladelets and Fumane blades (letter a)
Ansab blades, Romanesti blades,Les Cottés bladelets, and Les Cottés blades (letter b)
Romanesti bladelets and Fumane bladelets (letter c)
Les Cottés bladelets Fumane bladelets (letter d)

Dimension 2 is mostly defined by Punctiform platforms, presence of Cortex, absence of cortex and Linear platforms. Linear platforms and Cortex presence are present on the negative part of the biplot, while Punctiform platforms and Cortex absence on the positive part. Fumane blades and bladelets, Les Cottés blades and Ansab blades are showing negative lodging, meaning they are mostly associated with cortical blanks and linear platforms. Romanesti blades and bladelets, Les Cottés bladelets and Ansab bladelets positive lodgings, meaning they are characterised by punctiform platforms and cortex absence. 


###Convexity

The Convexity domain is comprising the Variables Axiality.simpl, Outline.morphology, Symmetry, Cross.section, Profile, Torsion, Distal.end.morpho, Cortex.position.simpl, Cortex to check if there's association between morphological attributes attributed to a particular position on the core volume.

####Ordinary

```{r}
library(FactoMineR)
library(factoextra)
library(dplyr)
library(ggplot2)



# Select relevant columns and remove missing values
convexity_maintenanceGO <- Blank_Main_reshaped2 %>%
  filter(Blank.type != "Flake") %>% #check only laminar
  filter(!Axiality.simpl %in% c("NA", "ND")) %>% #removing blanks without clear info
  filter(!Symmetry %in% c("NA", "ND")) %>% #removing blanks without clear info
  filter(!Outline.morphology %in% c("NA", "ND")) %>% #removing blanks without clear info
  filter(!Profile %in% c("NA", "ND")) %>% #removing blanks without clear info
  filter(!Torsion %in% c("NA", "ND")) %>% #removing blanks without clear info
  filter(!Distal.end.morpho %in% c("NA", "ND")) %>% #removing blanks without clear info
  filter(!Cortex.position.simpl %in% c("NA", "ND")) %>% #removing blanks without clear info
  filter(Technology.Phase == "Ordinary") %>% #only ordinary
  filter(!Cortex %in% c("NA", "ND")) %>% #removing blanks without clear info
  select(SiteBlank.typeTech, Blank.type, Axiality.simpl, Outline.morphology, Symmetry, Cross.section, Profile, Torsion, Distal.end.morpho, Cortex.position.simpl, Cortex) %>%
  na.omit()
  
summary(convexity_maintenanceGO)

# Run MCA
res.mca_ConvexityO <- MCA(convexity_maintenanceGO, graph = FALSE, quali.sup =1:2, method = "Burt") #Site, SiteBlank.type, SiteBlank.typeTech are not part of the active variables used to compute the MCA but is considered as supplementary information. The MCA analysis is performed based on the active variables in platform_maintenanceG, and the supplementary variables are used to provide additional information or context to the analysis. Their coordinates are predicted using only the information provided by the performed multiple correspondence analysis on active variables/individuals.

print(res.mca_ConvexityO)
fviz_screeplot(res.mca_ConvexityO, addlabels = TRUE, ylim = c(0, 45)) #To visualize the percentages of inertia explained by each MCA dimensions. Dim1 and Dim2 explain 33.314% of the variance
summary(res.mca_ConvexityO)

fviz_mca_var(res.mca_ConvexityO, choice = "mca.cor", 
            repel = TRUE, 
            ggtheme = theme_minimal()) #checking to which dimensions the variable are correlated
fviz_mca_var(res.mca_ConvexityO, 
             repel = TRUE, # 
             ggtheme = theme_minimal()) #Variable categories with a similar profile are grouped together. Negatively correlated variable categories are positioned on opposite sides of the plot origin (opposed quadrants).The distance between category points and the origin measures the quality of the variable category on the factor map. Category points that are away from the origin are well represented on the factor map.

var <- get_mca_var(res.mca_ConvexityO)
head(var$cos2, 50) #If a variable category is well represented by two dimensions, the sum of the cos2 is closed to one. For some of the row items, more than 2 dimensions are required to perfectly represent the data.

fviz_cos2(res.mca_ConvexityO, choice = "var", axes = 1:2) #visualising

fviz_contrib(res.mca_ConvexityO, choice = "var", axes = 1, top = 15) #contribution to Dim 1. 

fviz_contrib(res.mca_ConvexityO, choice = "var", axes = 2, top = 15) #contribution to Dim 2. 

MCA_ConvexityO <- fviz_mca_var(res.mca_ConvexityO, col.var = "contrib",
             gradient.cols = c("#00AFBB", "#E7B800", "#FC4E07"), 
             repel = TRUE, # avoid text overlapping (slow)
             ggtheme = theme_classic()
             )
MCA_ConvexityO
ggsave("MCAConvexityOrdinary.tiff", plot = MCA_ConvexityO, width = 43.656255, height = 20.29354, units = "cm", dpi = 300)   
ggsave("MCAConvexityOrdinary.png", plot = MCA_ConvexityO, width = 43.656255, height = 20.29354, units = "cm", dpi = 300) 


fviz_mca_ind(res.mca_ConvexityO, 
             label = "none", # hide individual labels
             habillage = "SiteBlank.typeTech", # color by groups
             addEllipses = TRUE, 
             ellipse.type = "confidence",
             ggtheme = theme_minimal(),
             geom = "point",  # set custom colors              
) #clustering of type of blanks for each site 
```
####Management
```{r}
library(FactoMineR)
library(factoextra)
library(dplyr)
library(ggplot2)



# Select relevant columns and remove missing values
convexity_maintenanceGM <- Blank_Main_reshaped2 %>%
  filter(Blank.type != "Flake") %>% #check only laminar
  filter(!Axiality.simpl %in% c("NA", "ND")) %>% #removing blanks without clear info
  filter(!Symmetry %in% c("NA", "ND")) %>% #removing blanks without clear info
  filter(!Outline.morphology %in% c("NA", "ND")) %>% #removing blanks without clear info
  filter(!Profile %in% c("NA", "ND")) %>% #removing blanks without clear info
  filter(!Torsion %in% c("NA", "ND")) %>% #removing blanks without clear info
  filter(!Distal.end.morpho %in% c("NA", "ND")) %>% #removing blanks without clear info
  filter(!Cortex.position.simpl %in% c("NA", "ND")) %>% #removing blanks without clear info
  filter(Technology.Phase == "MGMT") %>% #only ordinary
  filter(!Cortex %in% c("NA", "ND")) %>% #removing blanks without clear info
  select(SiteBlank.typeTech, Blank.type, Axiality.simpl, Outline.morphology, Symmetry, Cross.section, Profile, Torsion, Distal.end.morpho, Cortex.position.simpl, Cortex) %>%
  na.omit()
  
summary(convexity_maintenanceGM)

# Run MCA
res.mca_ConvexityM <- MCA(convexity_maintenanceGM, graph = FALSE, quali.sup =1:2, method = "Burt") #Site, SiteBlank.type, SiteBlank.typeTech are not part of the active variables used to compute the MCA but is considered as supplementary information. The MCA analysis is performed based on the active variables in platform_maintenanceG, and the supplementary variables are used to provide additional information or context to the analysis. Their coordinates are predicted using only the information provided by the performed multiple correspondence analysis on active variables/individuals.

print(res.mca_ConvexityM)
fviz_screeplot(res.mca_ConvexityM, addlabels = TRUE, ylim = c(0, 45)) #To visualize the percentages of inertia explained by each MCA dimensions. Dim1 and Dim2 explain 31.908% of the variance
summary(res.mca_ConvexityM)

fviz_mca_var(res.mca_ConvexityM, choice = "mca.cor", 
            repel = TRUE, 
            ggtheme = theme_minimal()) #checking to which dimensions the variable are correlated
fviz_mca_var(res.mca_ConvexityM, 
             repel = TRUE, # 
             ggtheme = theme_minimal()) #Variable categories with a similar profile are grouped together. Negatively correlated variable categories are positioned on opposite sides of the plot origin (opposed quadrants).The distance between category points and the origin measures the quality of the variable category on the factor map. Category points that are away from the origin are well represented on the factor map.

var <- get_mca_var(res.mca_ConvexityM)
head(var$cos2, 50) #If a variable category is well represented by two dimensions, the sum of the cos2 is closed to one. For some of the row items, more than 2 dimensions are required to perfectly represent the data.

fviz_cos2(res.mca_ConvexityM, choice = "var", axes = 1:2) #visualising

fviz_contrib(res.mca_ConvexityM, choice = "var", axes = 1, top = 15) #contribution to Dim 1. 

fviz_contrib(res.mca_ConvexityM, choice = "var", axes = 2, top = 15) #contribution to Dim 2. 

MCA_ConvexityM <- fviz_mca_var(res.mca_ConvexityM, col.var = "contrib",
             gradient.cols = c("#00AFBB", "#E7B800", "#FC4E07"), 
             repel = TRUE, # avoid text overlapping (slow)
             ggtheme = theme_classic()
             )
MCA_ConvexityM
ggsave("MCAConvexityMGMT.tiff", plot = MCA_ConvexityM, width = 43.656255, height = 20.29354, units = "cm", dpi = 300)   
ggsave("MCAConvexityMGMT.png", plot = MCA_ConvexityM, width = 43.656255, height = 20.29354, units = "cm", dpi = 300) 


fviz_mca_ind(res.mca_ConvexityM, 
             label = "none", # hide individual labels
             habillage = "SiteBlank.typeTech", # color by groups
             addEllipses = TRUE, 
             ellipse.type = "confidence",
             ggtheme = theme_minimal(),
             geom = "point",  # set custom colors              
) #clustering of type of blanks for each site 
```
###ANOVA testing Convexity domain

#####Ordinary
```{r}
#preparing the data
library(dplyr)
MCA_ConvexityO <- as.data.frame(res.mca_ConvexityO$ind)
SiteTypeTech <- as.data.frame(convexity_maintenanceGO$SiteBlank.typeTech)

mca.ConvexityO <- MCA_ConvexityO %>%
  select(1:2)

Mca.ConvexityO <- bind_cols(SiteTypeTech, mca.ConvexityO)

Mca.ConvexityO <- Mca.ConvexityO %>%
  mutate(SiteTypeTech = convexity_maintenanceGO$SiteBlank.typeTech, "dim1" = coord.Dim.1, "dim2" =  coord.Dim.2)%>%
  select(4:6) #creating a dataframe with the Dim1 and Dim2 coordinates obtained with MCA_Reduction of each individual (blank)

###create unique comparisons
unique(Mca.ConvexityO$SiteTypeTech)

#setting the unique comparisons 
assemblages <- c("A.b.O", "A.B.O", "R.b.O", "R.B.O", "C.b.O", "C.B.O", "F.B.O", "F.b.O")

# Generate all possible unique combinations of size 2
all_combinations <- combn(assemblages, 2)

# Convert the result to a data frame for better readability
combinations_df <- data.frame(t(all_combinations))

# Print the result
print(combinations_df)

comparisons_ConvexityO <- c(
  "A.b.O-A.B.O", "A.b.O-R.b.O", "A.b.O-R.B.O","A.b.O-C.b.O",
  "A.b.O-C.B.O", "A.b.O-F.B.O", "A.b.O-F.b.O", "A.B.O-R.b.O",
  "A.B.O-R.B.O", "A.B.O-C.b.O", "A.B.O-C.B.O", "A.B.O-F.B.O",
  "A.B.O-F.b.O", "R.b.O-R.B.O", "R.b.O-C.b.O", "R.b.O-C.B.O",
  "R.b.O-F.B.O", "R.b.O-F.b.O", "R.B.O-C.b.O", "R.B.O-C.B.O",
  "R.B.O-F.B.O", "R.B.O-F.b.O", "C.b.O-C.B.O", "C.b.O-F.B.O",
  "C.b.O-F.b.O", "C.B.O-F.B.O", "C.B.O-F.b.O", "F.B.O-F.b.O"
)


```

####Bootstrapping

```{r}
# Multi-comparison bootstrap
install.packages("WRS2")
library(WRS2)
# Multi-comparison bootstrap


boot_dim1 <- mcppb20(dim1 ~ SiteTypeTech, data = Mca.ConvexityO, nboot = 5000)
boot_dim2 <- mcppb20(dim2 ~ SiteTypeTech, data = Mca.ConvexityO, nboot = 5000)

# Convert results to data frames
multi_comp_dim1 <- as.data.frame(boot_dim1$comp)
multi_comp_dim2 <- as.data.frame(boot_dim2$comp)

# Add SiteTypeTech names and transform to column "SiteTypeTech"
multi_comp_dim1$SiteTypeTech <- comparisons_ConvexityO
multi_comp_dim1 <- multi_comp_dim1[!duplicated(names(multi_comp_dim1))]

multi_comp_dim2$SiteTypeTech <- comparisons_ConvexityO
multi_comp_dim2 <- multi_comp_dim2[!duplicated(names(multi_comp_dim2))]

# Join the results
multi_comp <- full_join(multi_comp_dim1, multi_comp_dim2, by = "SiteTypeTech", suffix = c("dim1", "dim2"))

# Select relevant columns
multi_comp <- select(multi_comp, SiteTypeTech, `p-valuedim1`, `p-valuedim2`)

# Build a list with pairwise p-values
labels_dim1 <- setNames(multi_comp$`p-valuedim1`, multi_comp_dim1$SiteTypeTech)
labels_dim2 <- setNames(multi_comp$`p-valuedim2`, multi_comp_dim2$SiteTypeTech)

# Attribute letters to each grouping based on alpha = .05
install.packages("multcompView")
library(multcompView)
library(tibble)
grouping_dim1 <- data.frame(multcompLetters(labels_dim1)["Letters"])
grouping_dim1 <- rownames_to_column(grouping_dim1, "SiteTypeTech")

grouping_dim2 <- data.frame(multcompLetters(labels_dim2)["Letters"])
grouping_dim2 <- rownames_to_column(grouping_dim2, "SiteTypeTech")

# Join the grouping results
grouping <- full_join(grouping_dim1, grouping_dim2, by = "SiteTypeTech", suffix = c("dim1", "dim2"))


# Print or use the 'grouping' dataframe for further analysis or visualization
print(grouping)

```
####Plotting
```{r}
library(RcmdrMisc)
library(gridExtra)
library(DescTools)

mca_summary <- Mca.ConvexityO %>% 
  group_by(SiteTypeTech) %>% 
  summarise(meandim1 = mean(dim1, trim = 0.2), meandim2 = mean(dim2, trim = 0.2), 
            LCIdim1 = MeanCI(dim1, trim = 0.2)[2], MCIdim1 = MeanCI(dim1, trim = 0.2)[3],
            LCIdim2 = MeanCI(dim2, trim = 0.2)[2], MCIdim2 = MeanCI(dim2, trim = 0.2)[3]) 

m1 <- max(mca_summary$MCIdim1)
m2 <- max(mca_summary$MCIdim2)

dim1 <- ggplot(mca_summary) +
  geom_point(stat = "identity", aes(x = SiteTypeTech, y = meandim1), size = 3) +
  geom_errorbar(stat = "identity", aes(x = SiteTypeTech, ymin = LCIdim1, ymax = MCIdim1), width = 0) +
  geom_hline(aes(yintercept = 0), color = "red", linetype = "dashed", show.legend = FALSE) +
  geom_text(data = grouping, aes(x = SiteTypeTech, y = m1 + 0.08, label = Lettersdim1, size = 15), show.legend = FALSE) +
  xlab("") +
  ylab("Dimension 1") +
  scale_colour_discrete(l = 40) +
  theme(text = element_text(size = 18)) +
  coord_flip()


dim2 <- ggplot(mca_summary) +
  geom_point(stat = "identity", aes(x = SiteTypeTech, y = meandim2), size = 3) +
  geom_errorbar(stat = "identity", aes(x = SiteTypeTech, ymin = LCIdim2, ymax = MCIdim2), width = 0) +
  geom_hline(aes(yintercept = 0), color = "red", linetype = "dashed", show.legend = FALSE) +
  geom_text(data = grouping, aes(x = SiteTypeTech, y = m2 + 0.08, label = Lettersdim2, size = 15), show.legend = FALSE) +
  xlab("") +
  ylab("Dimension 2") +
  scale_colour_discrete(l = 40) +
  theme(text = element_text(size = 18)) +
  coord_flip()


ANOVAConvexityO <- grid.arrange(dim1, dim2, ncol = 1)

ggsave("ANOVAConvexityOrdinary.tiff", plot = ANOVAConvexityO, width = 43.656255, height = 20.29354, units = "cm", dpi = 300) 
ggsave("ANOVAConvexityOrdinary.png", plot = ANOVAConvexityO, width = 43.656255, height = 20.29354, units = "cm", dpi = 300)

```
Interpretation ANOVA

According to the p-values of the single comparison between different categories and the resulting letters assigned the following categories are statistically similar on the Dim1:

Ansab bladelets, Les Cottés blades, Fumane bladelets, and Fumane blades (letter a)
Ansab blades, Fumane bladelets, and Fumane blades (letter b)



Dimension 1 is mostly defined by Semicortical blanks, Twisting in profile, presence of Torsion, lateral cortex, being off-axis, with a déjetè outline.  which are all occuring on the positive part of the biplot, except for Les Cottés blanks, all categories are showing negative lodgings, meaning they are characterised by non-cortical blanks, non-Twisted, on axis outlines 

on Dim2

Ansab bladelets and Fumane blades (letter a)
Ansab blades, Fumane bladelets (letter b)
Les Cottés blades and Les Cottés bladelets (letter e)

Dimension 2 is mostly defined by the déjetè outline, being off-axis, semi-cortical blanks. lateral cortex. the attributes linked with outline (dejete and off-axis) are on the negative part of the biplot, while cortex attributes on the positive part. Ansab and Romanesti blanks are showing negative lodging, meaning they are much more characterised by off-axis outlines, Fumane is positive close to 0, instead Les Cottés blanks are influenced by cortical blanks. 

#####MGMT
```{r}
#preparing the data
library(dplyr)
MCA_ConvexityM <- as.data.frame(res.mca_ConvexityM$ind)
SiteTypeTech <- as.data.frame(convexity_maintenanceGM$SiteBlank.typeTech)

mca.ConvexityM <- MCA_ConvexityM %>%
  select(1:2)

Mca.ConvexityM <- bind_cols(SiteTypeTech, mca.ConvexityM)

Mca.ConvexityM <- Mca.ConvexityM %>%
  mutate(SiteTypeTech = convexity_maintenanceGM$SiteBlank.typeTech, "dim1" = coord.Dim.1, "dim2" =  coord.Dim.2)%>%
  select(4:6) #creating a dataframe with the Dim1 and Dim2 coordinates obtained with MCA_Reduction of each individual (blank)

###create unique comparisons
unique(Mca.ConvexityM$SiteTypeTech)

#setting the unique comparisons 
assemblages <- c("A.b.M", "A.B.M", "R.b.M", "R.B.M", "C.b.M", "C.B.M", "F.B.M", "F.b.M")

# Generate all possible unique combinations of size 2
all_combinations <- combn(assemblages, 2)

# Convert the result to a data frame for better readability
combinations_df <- data.frame(t(all_combinations))

# Print the result
print(combinations_df)

comparisons_ConvexityM <- c(
  "A.b.M-A.B.M", "A.b.M-R.b.M", "A.b.M-R.B.M", "A.b.M-C.b.M",
  "A.b.M-C.B.M", "A.b.M-F.B.M" ,"A.b.M-F.b.M", "A.B.M-R.b.M",
  "A.B.M-R.B.M", "A.B.M-C.b.M", "A.B.M-C.B.M", "A.B.M-F.B.M",
  "A.B.M-F.b.M", "R.b.M-R.B.M","R.b.M-C.b.M", "R.b.M-C.B.M", 
  "R.b.M-F.B.M", "R.b.M-F.b.M", "R.B.M-C.b.M", "R.B.M-C.B.M",
  "R.B.M-F.B.M", "R.B.M-F.b.M", "C.b.M-C.B.M", "C.b.M-F.B.M", 
  "C.b.M-F.b.M", "C.B.M-F.B.M", "C.B.M-F.b.M", "F.B.M-F.b.M"
)


```

####Bootstrapping

```{r}
# Multi-comparison bootstrap
install.packages("WRS2")
library(WRS2)
# Multi-comparison bootstrap


boot_dim1 <- mcppb20(dim1 ~ SiteTypeTech, data = Mca.ConvexityM, nboot = 5000)
boot_dim2 <- mcppb20(dim2 ~ SiteTypeTech, data = Mca.ConvexityM, nboot = 5000)

# Convert results to data frames
multi_comp_dim1 <- as.data.frame(boot_dim1$comp)
multi_comp_dim2 <- as.data.frame(boot_dim2$comp)

# Add SiteTypeTech names and transform to column "SiteTypeTech"
multi_comp_dim1$SiteTypeTech <- comparisons_ConvexityM
multi_comp_dim1 <- multi_comp_dim1[!duplicated(names(multi_comp_dim1))]

multi_comp_dim2$SiteTypeTech <- comparisons_ConvexityM
multi_comp_dim2 <- multi_comp_dim2[!duplicated(names(multi_comp_dim2))]

# Join the results
multi_comp <- full_join(multi_comp_dim1, multi_comp_dim2, by = "SiteTypeTech", suffix = c("dim1", "dim2"))

# Select relevant columns
multi_comp <- select(multi_comp, SiteTypeTech, `p-valuedim1`, `p-valuedim2`)

# Build a list with pairwise p-values
labels_dim1 <- setNames(multi_comp$`p-valuedim1`, multi_comp_dim1$SiteTypeTech)
labels_dim2 <- setNames(multi_comp$`p-valuedim2`, multi_comp_dim2$SiteTypeTech)

# Attribute letters to each grouping based on alpha = .05
install.packages("multcompView")
library(multcompView)
library(tibble)
grouping_dim1 <- data.frame(multcompLetters(labels_dim1)["Letters"])
grouping_dim1 <- rownames_to_column(grouping_dim1, "SiteTypeTech")

grouping_dim2 <- data.frame(multcompLetters(labels_dim2)["Letters"])
grouping_dim2 <- rownames_to_column(grouping_dim2, "SiteTypeTech")

# Join the grouping results
grouping <- full_join(grouping_dim1, grouping_dim2, by = "SiteTypeTech", suffix = c("dim1", "dim2"))


# Print or use the 'grouping' dataframe for further analysis or visualization
print(grouping)

```
####Plotting
```{r}
library(RcmdrMisc)
library(gridExtra)
library(DescTools)

mca_summary <- Mca.ConvexityM %>% 
  group_by(SiteTypeTech) %>% 
  summarise(meandim1 = mean(dim1, trim = 0.2), meandim2 = mean(dim2, trim = 0.2), 
            LCIdim1 = MeanCI(dim1, trim = 0.2)[2], MCIdim1 = MeanCI(dim1, trim = 0.2)[3],
            LCIdim2 = MeanCI(dim2, trim = 0.2)[2], MCIdim2 = MeanCI(dim2, trim = 0.2)[3]) 

m1 <- max(mca_summary$MCIdim1)
m2 <- max(mca_summary$MCIdim2)

dim1 <- ggplot(mca_summary) +
  geom_point(stat = "identity", aes(x = SiteTypeTech, y = meandim1), size = 3) +
  geom_errorbar(stat = "identity", aes(x = SiteTypeTech, ymin = LCIdim1, ymax = MCIdim1), width = 0) +
  geom_hline(aes(yintercept = 0), color = "red", linetype = "dashed", show.legend = FALSE) +
  geom_text(data = grouping, aes(x = SiteTypeTech, y = m1 + 0.08, label = Lettersdim1, size = 15), show.legend = FALSE) +
  xlab("") +
  ylab("Dimension 1") +
  scale_colour_discrete(l = 40) +
  theme(text = element_text(size = 18)) +
  coord_flip()


dim2 <- ggplot(mca_summary) +
  geom_point(stat = "identity", aes(x = SiteTypeTech, y = meandim2), size = 3) +
  geom_errorbar(stat = "identity", aes(x = SiteTypeTech, ymin = LCIdim2, ymax = MCIdim2), width = 0) +
  geom_hline(aes(yintercept = 0), color = "red", linetype = "dashed", show.legend = FALSE) +
  geom_text(data = grouping, aes(x = SiteTypeTech, y = m2 + 0.08, label = Lettersdim2, size = 15), show.legend = FALSE) +
  xlab("") +
  ylab("Dimension 2") +
  scale_colour_discrete(l = 40) +
  theme(text = element_text(size = 18)) +
  coord_flip()


ANOVAConvexityM <- grid.arrange(dim1, dim2, ncol = 1)

ggsave("ANOVAConvexityMGMT.tiff", plot = ANOVAConvexityM, width = 43.656255, height = 20.29354, units = "cm", dpi = 300) 
ggsave("ANOVAConvexityMGMT.png", plot = ANOVAConvexityM, width = 43.656255, height = 20.29354, units = "cm", dpi = 300)

```
Interpretation ANOVA

According to the p-values of the single comparison between different categories and the resulting letters assigned the following categories are statistically similar on the Dim1:

Ansab bladelets and Fumane blades (letter a)
Ansab blades, Romanesti blades, Fumane bladelets, and Fumane blades (letter b)
Romnaesti bladelets and Fumane blades (letter c)

Dimension 1 is mostly defined by Déjetè, off axis outlines and presence of Torsion and parallel, on axis outlines and no Torsion.  The the first ones are in the negative part of the biplot, the second in the positive part. except for Les Cottés blanks, all categories are showing negative lodgings, meaning they are characterised by non-cortical blanks, non-Twisted, on axis outlines. Ansab and Romanesti blanks are showing negative lodgings, so associated more with Torsion and being off-axis, Fumane positive lodging, therefore mostly parallel and no Torsion, Les Cottés positive lodging close to O.

on Dim2

Ansab blanks and Les Cottés bladelets (letter a)
Ansab bladelets, Les Cottés bladelets, and Fumane bladelets (letter b)
Ansab bladelets, Fumane blades, and Fumane bladelets (letter c)
Romnesti blades and Les Cottés blades (letter e)
Les Cottés blanks (letter f)

Dimension 2 is mostly defined by the absence or the presence of cortex (semi). No cortex is on the negative part of the biplot, while cortex (semi) is on the positive part. Fumane and Les Cottés blades are the only categories showing positive lodging therefore, mostly associated with semi-cortical blanks. Les Cottés bladelets are the less associated with cortical blanks.
###Reduction domain

The Reduction domain is comprising the Variables Dorsal.scar.1, Negatives.type, Negatives.number, Cortex.position.simpl, Cortex to check if there's association between negatives and negatives flaking direction during the reduction process

####Ordinary

```{r}
library(FactoMineR)
library(factoextra)
library(dplyr)
library(ggplot2)



# Select relevant columns and remove missing values
ReductionO <- Blank_Main_reshaped2 %>%
  filter(Blank.type != "Flake") %>% #check only laminar
  filter(Technology.Phase == "Ordinary") %>% #check only Ordinary
  filter(!Dorsal.scar.1 %in% c("NA", "ND")) %>% #removing blanks without clear info
  filter(!Negatives.type %in% c("NA")) %>% #removing blanks without clear info, Fumane bladelets are only ND
  filter(!Number.negatives %in% c("NA", "ND")) %>% #removing blanks without clear info
  filter(!Cortex.position.simpl %in% c("NA", "ND")) %>% #removing blanks without clear info
  filter(!Cortex %in% c("NA", "ND")) %>% #removing blanks without clear info
  select(SiteBlank.typeTech, Blank.type, Dorsal.scar.1, Negatives.type, Number.negatives, Cortex.position.simpl, Cortex) %>%
  na.omit()
  
summary(ReductionO)

# Run MCA
res.mca_ReductionO <- MCA(ReductionO, graph = FALSE, quali.sup =1:2, method = "Burt") #Site, SiteBlank.type, SiteBlank.typeTech are not part of the active variables used to compute the MCA but is considered as supplementary information. The MCA analysis is performed based on the active variables in Reduction, and the supplementary variables are used to provide additional information or context to the analysis. Their coordinates are predicted using only the information provided by the performed multiple correspondence analysis on active variables/individuals.

print(res.mca_ReductionO)
fviz_screeplot(res.mca_ReductionO, addlabels = TRUE, ylim = c(0, 45)) #To visualize the percentages of inertia explained by each MCA dimensions. Dim1 and Dim2 explain 31.520% of the variance
summary(res.mca_ReductionO)

fviz_mca_var(res.mca_ReductionO, choice = "mca.cor", 
            repel = TRUE, 
            ggtheme = theme_minimal()) #checking to which dimensions the variable are correlated
fviz_mca_var(res.mca_ReductionO, 
             repel = TRUE, # 
             ggtheme = theme_classic()) #Variable categories with a similar profile are grouped together. Negatively correlated variable categories are positioned on opposite sides of the plot origin (opposed quadrants).The distance between category points and the origin measures the quality of the variable category on the factor map. Category points that are away from the origin are well represented on the factor map.

var <- get_mca_var(res.mca_ReductionO)
head(var$cos2, 50) #If a variable category is well represented by two dimensions, the sum of the cos2 is closed to one. For some of the row items, more than 2 dimensions are required to perfectly represent the data.

fviz_cos2(res.mca_ReductionO, choice = "var", axes = 1:2) #visualising

fviz_contrib(res.mca_ReductionO, choice = "var", axes = 1, top = 15) #contribution to Dim 1. 

fviz_contrib(res.mca_ReductionO, choice = "var", axes = 2, top = 15) #contribution to Dim 2.
MCA_ReductionO <- fviz_mca_var(res.mca_ReductionO, col.var = "contrib",
             gradient.cols = c("#00AFBB", "#E7B800", "#FC4E07"), 
             repel = TRUE, # avoid text overlapping (slow)
             ggtheme = theme_classic()
             )#
MCA_ReductionO
ggsave("MCAReductionOrdinary.tiff", plot = MCA_ReductionO, width = 43.656255, height = 20.29354, units = "cm", dpi = 300) 
ggsave("MCAReductionOrdinary.png", plot = MCA_ReductionO, width = 43.656255, height = 20.29354, units = "cm", dpi = 300)


fviz_mca_ind(res.mca_ReductionO, 
             label = "none", # hide individual labels
             habillage = "SiteBlank.typeTech", # color by groups
             addEllipses = TRUE, ellipse.type = "confidence",
             ggtheme = theme_minimal(),
             geom = "point",  # set custom colors              
) #clustering of type of blanks for each site 
            
```

library(FactoMineR)
library(factoextra)
library(dplyr)
library(ggplot2)

####MGMT

```{r}
# Select relevant columns and remove missing values
ReductionM <- Blank_Main_reshaped2 %>%
  filter(Blank.type != "Flake") %>% #check only laminar
  filter(Technology.Phase == "MGMT") %>% #check only MGMT
  filter(!Dorsal.scar.1 %in% c("NA", "ND")) %>% #removing blanks without clear info
  filter(!Negatives.type %in% c("NA")) %>% #removing blanks without clear info, Fumane bladelets are only ND
  filter(!Number.negatives %in% c("NA", "ND")) %>% #removing blanks without clear info
  filter(!Cortex.position.simpl %in% c("NA", "ND")) %>% #removing blanks without clear info
  filter(!Cortex %in% c("NA", "ND")) %>% #removing blanks without clear info
  select(SiteBlank.typeTech, Blank.type, Dorsal.scar.1, Negatives.type, Number.negatives, Cortex.position.simpl, Cortex) %>%
  na.omit()
  
summary(ReductionM)

# Run MCA
res.mca_ReductionM <- MCA(ReductionM, graph = FALSE, quali.sup =1:2, method = "Burt") #Site, SiteBlank.type, SiteBlank.typeTech are not part of the active variables used to compute the MCA but is considered as supplementary information. The MCA analysis is performed based on the active variables in Reduction, and the supplementary variables are used to provide additional information or context to the analysis. Their coordinates are predicted using only the information provided by the performed multiple correspondence analysis on active variables/individuals.

print(res.mca_ReductionM)
fviz_screeplot(res.mca_ReductionM, addlabels = TRUE, ylim = c(0, 45)) #To visualize the percentages of inertia explained by each MCA dimensions. Dim1 and Dim2 explain 35.114% of the variance
summary(res.mca_ReductionM)

fviz_mca_var(res.mca_ReductionM, choice = "mca.cor", 
            repel = TRUE, 
            ggtheme = theme_minimal()) #checking to which dimensions the variable are correlated
fviz_mca_var(res.mca_ReductionM, 
             repel = TRUE, # 
             ggtheme = theme_classic()) #Variable categories with a similar profile are grouped together. Negatively correlated variable categories are positioned on opposite sides of the plot origin (opposed quadrants).The distance between category points and the origin measures the quality of the variable category on the factor map. Category points that are away from the origin are well represented on the factor map.

var <- get_mca_var(res.mca_ReductionM)
head(var$cos2, 50) #If a variable category is well represented by two dimensions, the sum of the cos2 is closed to one. For some of the row items, more than 2 dimensions are required to perfectly represent the data.

fviz_cos2(res.mca_ReductionM, choice = "var", axes = 1:2) #visualising

fviz_contrib(res.mca_ReductionM, choice = "var", axes = 1, top = 15) #contribution to Dim 1. 

fviz_contrib(res.mca_ReductionM, choice = "var", axes = 2, top = 15) #contribution to Dim 2.
MCA_ReductionM <- fviz_mca_var(res.mca_ReductionM, col.var = "contrib",
             gradient.cols = c("#00AFBB", "#E7B800", "#FC4E07"), 
             repel = TRUE, # avoid text overlapping (slow)
             ggtheme = theme_classic()
             )#
MCA_ReductionM
ggsave("MCAReductionMGMT.tiff", plot = MCA_ReductionM, width = 43.656255, height = 20.29354, units = "cm", dpi = 300) 
ggsave("MCAReductionMGMT.png", plot = MCA_ReductionM, width = 43.656255, height = 20.29354, units = "cm", dpi = 300)


fviz_mca_ind(res.mca_ReductionM, 
             label = "none", # hide individual labels
             habillage = "SiteBlank.typeTech", # color by groups
             addEllipses = TRUE, ellipse.type = "confidence",
             ggtheme = theme_minimal(),
             geom = "point",  # set custom colors              
) #clustering of type of blanks for each site 
            
```

###ANOVA testing Reduction domain

#####Ordinary
```{r}
#preparing the data
library(dplyr)
MCA_ReductionO <- as.data.frame(res.mca_ReductionO$ind)
SiteTypeTech <- as.data.frame(ReductionO$SiteBlank.typeTech)

mca.ReductionO <- MCA_ReductionO %>%
  select(1:2)

Mca.ReductionO <- bind_cols(SiteTypeTech, mca.ReductionO)

Mca.ReductionO <- Mca.ReductionO %>%
  mutate(SiteTypeTech = ReductionO$SiteBlank.typeTech, "dim1" = coord.Dim.1, "dim2" =  coord.Dim.2)%>%
  select(4:6) #creating a dataframe with the Dim1 and Dim2 coordinates obtained with MCA_Reduction of each individual (blank)

###create unique comparisons
unique(Mca.ReductionO$SiteTypeTech)

#setting the unique comparisons 
assemblages <- c("A.b.O", "A.B.O", "R.b.O", "R.B.O", "C.b.O", "C.B.O", "F.B.O", "F.b.O")

# Generate all possible unique combinations of size 2
all_combinations <- combn(assemblages, 2)

# Convert the result to a data frame for better readability
combinations_df <- data.frame(t(all_combinations))

# Print the result
print(combinations_df)

comparisons_ReductionO <- c(
  "A.b.O-A.B.O", "A.b.O-R.b.O", "A.b.O-R.B.O","A.b.O-C.b.O",
  "A.b.O-C.B.O", "A.b.O-F.B.O", "A.b.O-F.b.O", "A.B.O-R.b.O",
  "A.B.O-R.B.O", "A.B.O-C.b.O", "A.B.O-C.B.O", "A.B.O-F.B.O",
  "A.B.O-F.b.O", "R.b.O-R.B.O", "R.b.O-C.b.O", "R.b.O-C.B.O",
  "R.b.O-F.B.O", "R.b.O-F.b.O", "R.B.O-C.b.O", "R.B.O-C.B.O",
  "R.B.O-F.B.O", "R.B.O-F.b.O", "C.b.O-C.B.O", "C.b.O-F.B.O",
  "C.b.O-F.b.O", "C.B.O-F.B.O", "C.B.O-F.b.O", "F.B.O-F.b.O"
)


```

####Bootstrapping

```{r}
# Multi-comparison bootstrap
install.packages("WRS2")
library(WRS2)
# Multi-comparison bootstrap


boot_dim1 <- mcppb20(dim1 ~ SiteTypeTech, data = Mca.ReductionO, nboot = 5000)
boot_dim2 <- mcppb20(dim2 ~ SiteTypeTech, data = Mca.ReductionO, nboot = 5000)

# Convert results to data frames
multi_comp_dim1 <- as.data.frame(boot_dim1$comp)
multi_comp_dim2 <- as.data.frame(boot_dim2$comp)

# Add SiteTypeTech names and transform to column "SiteTypeTech"
multi_comp_dim1$SiteTypeTech <- comparisons_ReductionO
multi_comp_dim1 <- multi_comp_dim1[!duplicated(names(multi_comp_dim1))]

multi_comp_dim2$SiteTypeTech <- comparisons_ReductionO
multi_comp_dim2 <- multi_comp_dim2[!duplicated(names(multi_comp_dim2))]

# Join the results
multi_comp <- full_join(multi_comp_dim1, multi_comp_dim2, by = "SiteTypeTech", suffix = c("dim1", "dim2"))

# Select relevant columns
multi_comp <- select(multi_comp, SiteTypeTech, `p-valuedim1`, `p-valuedim2`)

# Build a list with pairwise p-values
labels_dim1 <- setNames(multi_comp$`p-valuedim1`, multi_comp_dim1$SiteTypeTech)
labels_dim2 <- setNames(multi_comp$`p-valuedim2`, multi_comp_dim2$SiteTypeTech)

# Attribute letters to each grouping based on alpha = .05
install.packages("multcompView")
library(multcompView)
library(tibble)
grouping_dim1 <- data.frame(multcompLetters(labels_dim1)["Letters"])
grouping_dim1 <- rownames_to_column(grouping_dim1, "SiteTypeTech")

grouping_dim2 <- data.frame(multcompLetters(labels_dim2)["Letters"])
grouping_dim2 <- rownames_to_column(grouping_dim2, "SiteTypeTech")

# Join the grouping results
grouping <- full_join(grouping_dim1, grouping_dim2, by = "SiteTypeTech", suffix = c("dim1", "dim2"))


# Print or use the 'grouping' dataframe for further analysis or visualization
print(grouping)

```
####Plotting
```{r}
library(RcmdrMisc)
library(gridExtra)
library(DescTools)

mca_summary <- Mca.ReductionO %>% 
  group_by(SiteTypeTech) %>% 
  summarise(meandim1 = mean(dim1, trim = 0.2), meandim2 = mean(dim2, trim = 0.2), 
            LCIdim1 = MeanCI(dim1, trim = 0.2)[2], MCIdim1 = MeanCI(dim1, trim = 0.2)[3],
            LCIdim2 = MeanCI(dim2, trim = 0.2)[2], MCIdim2 = MeanCI(dim2, trim = 0.2)[3]) 

m1 <- max(mca_summary$MCIdim1)
m2 <- max(mca_summary$MCIdim2)

dim1 <- ggplot(mca_summary) +
  geom_point(stat = "identity", aes(x = SiteTypeTech, y = meandim1), size = 3) +
  geom_errorbar(stat = "identity", aes(x = SiteTypeTech, ymin = LCIdim1, ymax = MCIdim1), width = 0) +
  geom_hline(aes(yintercept = 0), color = "red", linetype = "dashed", show.legend = FALSE) +
  geom_text(data = grouping, aes(x = SiteTypeTech, y = m1 + 0.08, label = Lettersdim1, size = 15), show.legend = FALSE) +
  xlab("") +
  ylab("Dimension 1") +
  scale_colour_discrete(l = 40) +
  theme(text = element_text(size = 18)) +
  coord_flip()


dim2 <- ggplot(mca_summary) +
  geom_point(stat = "identity", aes(x = SiteTypeTech, y = meandim2), size = 3) +
  geom_errorbar(stat = "identity", aes(x = SiteTypeTech, ymin = LCIdim2, ymax = MCIdim2), width = 0) +
  geom_hline(aes(yintercept = 0), color = "red", linetype = "dashed", show.legend = FALSE) +
  geom_text(data = grouping, aes(x = SiteTypeTech, y = m2 + 0.08, label = Lettersdim2, size = 15), show.legend = FALSE) +
  xlab("") +
  ylab("Dimension 2") +
  scale_colour_discrete(l = 40) +
  theme(text = element_text(size = 18)) +
  coord_flip()


ANOVAReductionO <- grid.arrange(dim1, dim2, ncol = 1)

ggsave("ANOVAReductionOrdinary.tiff", plot = ANOVAReductionO, width = 43.656255, height = 20.29354, units = "cm", dpi = 300) 
ggsave("ANOVAReductionOrdinary.png", plot = ANOVAReductionO, width = 43.656255, height = 20.29354, units = "cm", dpi = 300)

```
Interpretation ANOVA

According to the p-values of the single comparison between different categories and the resulting letters assigned the following categories are statistically similar on the Dim1:

Ansab bladelets and Fumane bladelets (letter a)
Ansab blades, Romanesti bladelets(letter b)
Romanesti bladelets and Fumane blades (letter c)
Les Cottés blades and Fumane blades 

Dimension 1 the absence of negatives. The absence of negatives is in the positive part of the biplot. most of the categories categories are showing negative lodgings, meaning they are characterised having one or more negatives. 

on Dim2

Ansab bladelets and Fumane bladelets (letter a)
Ansab blades, Romanesti bladelets (letter b)
Ansab blades and Fumane bladelets (letter c)
Romnesti blades and Les Cottés blades (letter e)
Les Cottés blades and Fumane blades (letter f)

Dimension 2 is mostly defined by the presence of cortex (semi). No cortex is on the negative part of the biplot, while cortex (semi) is on the positive part. Les Cottés blades is the only categories showing positive lodging therefore, mostly associated with semi-cortical blanks.


#####MGMT
```{r}
#preparing the data
library(dplyr)
MCA_ReductionM <- as.data.frame(res.mca_ReductionM$ind)
SiteTypeTech <- as.data.frame(ReductionM$SiteBlank.typeTech)

mca.ReductionM <- MCA_ReductionM %>%
  select(1:2)

Mca.ReductionM <- bind_cols(SiteTypeTech, mca.ReductionM)

Mca.ReductionM <- Mca.ReductionM %>%
  mutate(SiteTypeTech = ReductionM$SiteBlank.typeTech, "dim1" = coord.Dim.1, "dim2" =  coord.Dim.2)%>%
  select(4:6) #creating a dataframe with the Dim1 and Dim2 coordinates obtained with MCA_Reduction of each individual (blank)

###create unique comparisons
unique(Mca.ReductionM$SiteTypeTech)

#setting the unique comparisons 
assemblages <- c("A.b.M", "A.B.M", "R.b.M", "R.B.M", "C.b.M", "C.B.M", "F.B.M", "F.b.M")

# Generate all possible unique combinations of size 2
all_combinations <- combn(assemblages, 2)

# Convert the result to a data frame for better readability
combinations_df <- data.frame(t(all_combinations))

# Print the result
print(combinations_df)

comparisons_ReductionM <- c(
  "A.b.M-A.B.M", "A.b.M-R.b.M", "A.b.M-R.B.M", "A.b.M-C.b.M",
  "A.b.M-C.B.M", "A.b.M-F.B.M" ,"A.b.M-F.b.M", "A.B.M-R.b.M",
  "A.B.M-R.B.M", "A.B.M-C.b.M", "A.B.M-C.B.M", "A.B.M-F.B.M",
  "A.B.M-F.b.M", "R.b.M-R.B.M","R.b.M-C.b.M", "R.b.M-C.B.M", 
  "R.b.M-F.B.M", "R.b.M-F.b.M", "R.B.M-C.b.M", "R.B.M-C.B.M",
  "R.B.M-F.B.M", "R.B.M-F.b.M", "C.b.M-C.B.M", "C.b.M-F.B.M", 
  "C.b.M-F.b.M", "C.B.M-F.B.M", "C.B.M-F.b.M", "F.B.M-F.b.M"
)


```

####Bootstrapping

```{r}
# Multi-comparison bootstrap
install.packages("WRS2")
library(WRS2)
# Multi-comparison bootstrap


boot_dim1 <- mcppb20(dim1 ~ SiteTypeTech, data = Mca.ReductionM, nboot = 5000)
boot_dim2 <- mcppb20(dim2 ~ SiteTypeTech, data = Mca.ReductionM, nboot = 5000)

# Convert results to data frames
multi_comp_dim1 <- as.data.frame(boot_dim1$comp)
multi_comp_dim2 <- as.data.frame(boot_dim2$comp)

# Add SiteTypeTech names and transform to column "SiteTypeTech"
multi_comp_dim1$SiteTypeTech <- comparisons_ReductionM
multi_comp_dim1 <- multi_comp_dim1[!duplicated(names(multi_comp_dim1))]

multi_comp_dim2$SiteTypeTech <- comparisons_ReductionM
multi_comp_dim2 <- multi_comp_dim2[!duplicated(names(multi_comp_dim2))]

# Join the results
multi_comp <- full_join(multi_comp_dim1, multi_comp_dim2, by = "SiteTypeTech", suffix = c("dim1", "dim2"))

# Select relevant columns
multi_comp <- select(multi_comp, SiteTypeTech, `p-valuedim1`, `p-valuedim2`)

# Build a list with pairwise p-values
labels_dim1 <- setNames(multi_comp$`p-valuedim1`, multi_comp_dim1$SiteTypeTech)
labels_dim2 <- setNames(multi_comp$`p-valuedim2`, multi_comp_dim2$SiteTypeTech)

# Attribute letters to each grouping based on alpha = .05
install.packages("multcompView")
library(multcompView)
library(tibble)
grouping_dim1 <- data.frame(multcompLetters(labels_dim1)["Letters"])
grouping_dim1 <- rownames_to_column(grouping_dim1, "SiteTypeTech")

grouping_dim2 <- data.frame(multcompLetters(labels_dim2)["Letters"])
grouping_dim2 <- rownames_to_column(grouping_dim2, "SiteTypeTech")

# Join the grouping results
grouping <- full_join(grouping_dim1, grouping_dim2, by = "SiteTypeTech", suffix = c("dim1", "dim2"))


# Print or use the 'grouping' dataframe for further analysis or visualization
print(grouping)

```
####Plotting
```{r}
library(RcmdrMisc)
library(gridExtra)
library(DescTools)

mca_summary <- Mca.ReductionM %>% 
  group_by(SiteTypeTech) %>% 
  summarise(meandim1 = mean(dim1, trim = 0.2), meandim2 = mean(dim2, trim = 0.2), 
            LCIdim1 = MeanCI(dim1, trim = 0.2)[2], MCIdim1 = MeanCI(dim1, trim = 0.2)[3],
            LCIdim2 = MeanCI(dim2, trim = 0.2)[2], MCIdim2 = MeanCI(dim2, trim = 0.2)[3]) 

m1 <- max(mca_summary$MCIdim1)
m2 <- max(mca_summary$MCIdim2)

dim1 <- ggplot(mca_summary) +
  geom_point(stat = "identity", aes(x = SiteTypeTech, y = meandim1), size = 3) +
  geom_errorbar(stat = "identity", aes(x = SiteTypeTech, ymin = LCIdim1, ymax = MCIdim1), width = 0) +
  geom_hline(aes(yintercept = 0), color = "red", linetype = "dashed", show.legend = FALSE) +
  geom_text(data = grouping, aes(x = SiteTypeTech, y = m1 + 0.08, label = Lettersdim1, size = 15), show.legend = FALSE) +
  xlab("") +
  ylab("Dimension 1") +
  scale_colour_discrete(l = 40) +
  theme(text = element_text(size = 18)) +
  coord_flip()


dim2 <- ggplot(mca_summary) +
  geom_point(stat = "identity", aes(x = SiteTypeTech, y = meandim2), size = 3) +
  geom_errorbar(stat = "identity", aes(x = SiteTypeTech, ymin = LCIdim2, ymax = MCIdim2), width = 0) +
  geom_hline(aes(yintercept = 0), color = "red", linetype = "dashed", show.legend = FALSE) +
  geom_text(data = grouping, aes(x = SiteTypeTech, y = m2 + 0.08, label = Lettersdim2, size = 15), show.legend = FALSE) +
  xlab("") +
  ylab("Dimension 2") +
  scale_colour_discrete(l = 40) +
  theme(text = element_text(size = 18)) +
  coord_flip()


ANOVAReductionM <- grid.arrange(dim1, dim2, ncol = 1)

ggsave("ANOVAReductionMGMT.tiff", plot = ANOVAReductionM, width = 43.656255, height = 20.29354, units = "cm", dpi = 300) 
ggsave("ANOVAReductionMGMT.png", plot = ANOVAReductionM, width = 43.656255, height = 20.29354, units = "cm", dpi = 300)

```
Interpretation ANOVA

According to the p-values of the single comparison between different categories and the resulting letters assigned the following categories are statistically similar on the Dim1:

Ansab blanks and Romanesti bladelets (letter a)
Les Cottés blanks and Fumane blades (letter c)
Fumane blanks (letter d)


Dimension 1 the absence of negatives. The absence of negatives is in the positive part of the biplot. most of the categories categories are showing negative lodgings, meaning they are characterised having one or more negatives. 

on Dim2

Ansab bladelets and Fumane blades (letter a)
Ansab blades, Fumane bladelets, Romanesti blades (letter b)
Les Cottés bladelets and Romanesti bladelets (letter d)
Les Cottés blanks (letter e)

Dimension 2 is mostly defined by the presence of cortex (semi). No cortex is on the negative part of the biplot, while cortex (semi) is on the positive part. Les Cottés blades and the Fumane blanks are the only categories showing positive lodging therefore, mostly associated with semi-cortical blanks.
